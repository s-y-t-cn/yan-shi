import{d as G,r as s,o as H,D as J,g as o,c as K,e as Q,k as W,C as t,ag as C,w as n,aa as I,bS as X,c0 as Y,aj as _,bZ as ee,bR as ae,c1 as te,c2 as le,ai as oe}from"./index-g37XHkO7.js";import{v as re}from"./el-loading-C_jW1pKp.js";/* empty css                   *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                       *//* empty css                    *//* empty css                      */import{E as se}from"./el-popover-tSKsVJ3k.js";/* empty css                  *//* empty css                 */import{h}from"./index-DIjjrsno.js";import{S as ne}from"./SytTable-BQFAgx-u.js";import{E as ie}from"./index-CWjOxhQe.js";import{E as de}from"./index-7XQ89VVv.js";import{E as me}from"./index-DBqnoAV3.js";import{E as pe,a as ue}from"./index-ekn85pdJ.js";import{a as ce}from"./index-9xp24Tp6.js";import{b as fe}from"./index-CBwcHNbb.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-ClVUFy22.js";import"./error-C6KkHRRa.js";import"./_commonjsHelpers-BosuxZz1.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./index-Di-CCxpl.js";import"./index-Cq1NGWuE.js";import"./index-Ct0d8tij.js";import"./castArray-D6nup7xA.js";import"./isEqual-sIzh-_wJ.js";import"./index-B--V0hz4.js";import"./_baseClone-YGkPyP1V.js";import"./index-vz8m2Jyi.js";import"./vnode-DwFJRcHj.js";const _e={"element-loading-text":"加载中..."},ve={class:"tools"},we=G({__name:"Users",setup(be){let P=s([{title:"用户名",dataIndex:"username"},{title:"角色",dataIndex:"rolesNames"},{title:"昵称",dataIndex:"nickname"},{title:"部门",dataIndex:"department"},{title:"职位",dataIndex:"position"}]),p=s(""),w=s([]),b=s(!0),y=s(1),V=s(10),U=s(0),d=s(!1),x=s(null),f=s("");const R=s({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],roles:[{required:!0,message:"请输入角色",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],department:[{required:!0,message:"请输入部门",trigger:"blur"}],position:[{required:!0,message:"请输入职位",trigger:"blur"}]}),k=s([]),E=s([]),z=async()=>{await ee().then(a=>{a.code==200&&(k.value=a.data,E.value=ae(a.data))})};let D=()=>({username:"",password:"",nickname:"",roles:[],department:"软件部",position:"职员"}),r=s(D());const B=async()=>{const a={currentPage:y.value,pageSize:V.value};p.value&&(a.username=p.value),await te(a).then(e=>{e.code===200&&(U.value=e.data.total,w.value=e.data.data.map(i=>(i.encrypedPassword=i.password,i.rolesNames=i.roles.map(c=>{var g;return(g=k.value.find(v=>v.id==c))==null?void 0:g.name}),i)))})},u=async()=>{await z(),await B(),b.value=!1},F=()=>{f.value="添加账号",d.value=!0,r.value=D()},T=a=>{f.value="编辑账号",d.value=!0,r.value=X(a)},q=async()=>{let a=Object.assign({},r.value);a.password=await h(a.password),le(a).then(e=>{e.code==200&&(_({type:"success",message:"添加成功"}),u())})},S=async()=>{let a=Object.assign({},r.value);a.password!=a.encrypedPassword&&(a.password=await h(a.password)),Reflect.deleteProperty(a,"encrypedPassword"),oe(a).then(e=>{e.code==200&&(u(),_({type:"success",message:"编辑成功"}))})},N=a=>{a.id?Y({id:a.id}).then(e=>{e.code==200&&(u(),_({type:"success",message:"删除成功"}))}):_({type:"error",message:"不存在的id"})},j=a=>{a&&a.validate(e=>{e?(f.value==="添加账号"?q():S(),d.value=!1):console.log("验证失败!")})},O=(a,e)=>{y.value=a,V.value=e,u()};return H(()=>{u()}),(a,e)=>{const i=ie,c=de,g=se,v=me,m=pe,M=ce,$=ue,L=fe,Z=re;return J((K(),Q("div",_e,[W("div",ve,[t(i,{modelValue:o(p),"onUpdate:modelValue":e[0]||(e[0]=l=>C(p)?p.value=l:p=l),placeholder:"输入用户名查询",class:"search",clearable:"",onBlur:u},null,8,["modelValue"]),t(c,{onClick:F},{default:n(()=>[I("添加账号")]),_:1})]),t(ne,{columns:o(P),data:o(w)},{operations:n(l=>[t(c,{size:"small",type:"primary",icon:"Edit",circle:"",onClick:A=>T(l.row)},null,8,["onClick"]),t(g,{title:`确定删除 ${l.row.username} 账号?`,"confirm-button-text":"确定","cancel-button-text":"取消",icon:"InfoFilled","icon-color":"var(--el-color-warning)",onConfirm:A=>N(l.row)},{reference:n(()=>[t(c,{size:"small",type:"danger",icon:"Delete",circle:""})]),_:2},1032,["title","onConfirm"])]),_:1},8,["columns","data"]),t(v,{layout:"total, sizes, prev, pager, next, jumper",total:o(U),"page-sizes":[10,20,30,40,50,100],class:"pagination",small:"",background:"",onChange:O},null,8,["total"]),t(L,{modelValue:o(d),"onUpdate:modelValue":e[8]||(e[8]=l=>C(d)?d.value=l:d=l),title:o(f),width:"350px"},{default:n(()=>[t($,{ref_key:"ruleFormRef",ref:x,model:o(r),rules:R.value,size:"large",class:"w-full"},{default:n(()=>[t(m,{label:"账号",prop:"username"},{default:n(()=>[t(i,{modelValue:o(r).username,"onUpdate:modelValue":e[1]||(e[1]=l=>o(r).username=l),placeholder:"用户名","prefix-icon":"user",disabled:o(f)=="编辑账号"},null,8,["modelValue","disabled"])]),_:1}),t(m,{label:"密码",prop:"password"},{default:n(()=>[t(i,{modelValue:o(r).password,"onUpdate:modelValue":e[2]||(e[2]=l=>o(r).password=l),placeholder:"密码","prefix-icon":"lock",type:"password"},null,8,["modelValue"])]),_:1}),t(m,{label:"角色",prop:"roles"},{default:n(()=>[t(M,{modelValue:o(r).roles,"onUpdate:modelValue":e[3]||(e[3]=l=>o(r).roles=l),data:E.value,props:{label:"name",value:"id"},"check-strictly":"",multiple:"","render-after-expand":!1,style:{width:"240px"}},null,8,["modelValue","data"])]),_:1}),t(m,{label:"昵称",prop:"nickname"},{default:n(()=>[t(i,{modelValue:o(r).nickname,"onUpdate:modelValue":e[4]||(e[4]=l=>o(r).nickname=l),placeholder:"昵称"},null,8,["modelValue"])]),_:1}),t(m,{label:"部门",prop:"department"},{default:n(()=>[t(i,{modelValue:o(r).department,"onUpdate:modelValue":e[5]||(e[5]=l=>o(r).department=l),placeholder:"部门"},null,8,["modelValue"])]),_:1}),t(m,{label:"职位",prop:"position"},{default:n(()=>[t(i,{modelValue:o(r).position,"onUpdate:modelValue":e[6]||(e[6]=l=>o(r).position=l),placeholder:"职位"},null,8,["modelValue"])]),_:1}),t(m,null,{default:n(()=>[t(c,{class:"w-full",type:"primary",onClick:e[7]||(e[7]=l=>j(o(x)))},{default:n(()=>[I(" 保存 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])),[[Z,o(b)]])}}}),aa=ge(we,[["__scopeId","data-v-6a38896f"]]);export{aa as default};
