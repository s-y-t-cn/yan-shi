import{d as A,af as R,r as b,L as U,y as $,c as w,l as S,w as d,B as h,k as y,t as E,g,e as q,ac as z,W as G,aa as H,ak as K,al as M}from"./index-CVJ82-Av.js";import{E as P}from"./el-space-B0ccT0gL.js";/* empty css                  */import{E as Q,a as X}from"./el-timeline-item-BGbVsP1d.js";/* empty css                */import{h as Y}from"./examples-Cp56W1zS.js";import{E as Z}from"./index-D8ujHjMb.js";import{E as ee}from"./index-DUKCJt5F.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vnode-CnQ3vlOL.js";const ae=c=>(K("data-v-e8132cc9"),c=c(),M(),c),oe=ae(()=>y("span",null,"流程",-1)),le=A({__name:"EditSubmit",props:{data:{type:Object,default(){return{name:"",formData:[],flowData:{nodesData:[],linesData:[]}}}}},emits:["submit"],setup(c,{emit:F}){const k=R(),B=c,N=F;let f=b({name:"",formData:[],flowData:{nodesData:[],linesData:[]}});U(()=>JSON.parse(JSON.stringify(B.data)),a=>{f.value=a},{deep:!0,immediate:!0});const O=a=>{for(let o of f.value.formData)if(o.type==="layout"){for(let l of o.cols)for(let t of l.children)if(a===t.field)return t}else if(a===o.field)return o};let x=$(()=>C(f.value)),J=b({label:"部门主管",value:"部门主管"});const C=a=>{var u;let o=[],l={id:"",type:""},{nodesData:t,linesData:n}=a.flowData,r=l=t.find(e=>e.type==="start");if(!r)return[];for(r.color="#00aabb",o.push(r);n.find(e=>e.fromId===l.id);){let e={id:""},s=n.filter(i=>i.fromId===l.id);if(l.type=="condition"){let i=s.findIndex(_=>_.text==="是"),m=s.findIndex(_=>_.text==="否"),p=i,{field:W,comparison:j,value:v}=l.properties,D=O(W);if(D)switch(j){case"小于":D.value<v?p=i:p=m;break;case"等于":D.value===v?p=i:p=m;break;case"大于":D.value>v?p=i:p=m;break}e=t.find(_=>{var I;return _.id===((I=s[p])==null?void 0:I.toId)})}else e=t.find(i=>{var m;return i.id===((m=s[0])==null?void 0:m.toId)}),(e==null?void 0:e.type)=="handle"&&((u=e.properties)==null?void 0:u.value)=="部门主管"&&(e.properties=J.value);(e==null?void 0:e.type)!="condition"&&o.push(e),l=e}return o},T=b(),L=()=>{let a=new FormData;a.append("name",f.value.name),a.append("submitter",JSON.stringify({username:k.username,nickname:k.nickname}));let o={};f.value.formData.forEach(t=>{t.type==="img-upload"?t.value.forEach(n=>a.append(t.field,n)):t.type==="layout"?t.cols.forEach(n=>{n.children.forEach(r=>{r.type==="img-upload"?r.value.forEach(u=>a.append(r.field,u)):o[r.field]=r.value})}):o[t.field]=t.value}),a.append("formData",JSON.stringify(o));let l=x.value.filter(t=>t.type==="handle").map(t=>({id:t.id,type:t.text,label:t.properties.label,username:t.properties.value,status:"未处理"}));return a.append("flowData",JSON.stringify(l)),a},V=a=>{if(!a)return!1;a.validate(o=>{if(o)Y(L()).then(()=>N("submit"));else return!1})};return(a,o)=>{const l=Z,t=X,n=Q,r=ee,u=P;return w(),S(u,{direction:"vertical",fill:"",class:"submit-container"},{default:d(()=>[h(l,null,{header:d(()=>[y("h1",null,E(g(f).name),1)]),_:1}),h(l,null,{header:d(()=>[oe]),default:d(()=>[h(n,null,{default:d(()=>[(w(!0),q(G,null,z(g(x),e=>(w(),S(t,{key:e.id,icon:e.icon,color:e.color,timestamp:e.timestamp},{default:d(()=>{var s;return[y("div",null,E(e.text),1),y("div",null,E((s=e.properties)==null?void 0:s.label),1)]}),_:2},1032,["icon","color","timestamp"]))),128))]),_:1}),h(r,{type:"primary",onClick:o[0]||(o[0]=e=>V(T.value))},{default:d(()=>[H("提交")]),_:1})]),_:1})]),_:1})}}}),_e=te(le,[["__scopeId","data-v-e8132cc9"]]);export{_e as default};
