import{c as g}from"./index-BWwQj9eg.js";import{a3 as p,bz as d}from"./index-wChoSQeH.js";import{E as o}from"./index-C26DhIRX.js";const u=()=>({_id:"",token:"",username:"",role:[],nickname:"",department:"",position:""}),b=localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")):u(),h=p({id:"user",state:()=>Object.assign({},b),actions:{login(a){Object.assign(this,a),localStorage.setItem("userInfo",JSON.stringify(a))},logout(){Object.assign(this,u()),localStorage.removeItem("userInfo")}}});async function S({url:a,method:f,header:l,data:c}){const n={method:f??"GET",headers:{},mode:"cors",credentials:"same-origin"},m=/^http/;l?n.headers=l:c instanceof FormData?n.body=c:(n.headers={"Content-Type":"application/json"},n.body=JSON.stringify(c)),n.headers.Authorization=`Bearer ${h().token}`;function i(e,t){switch(e){case 500:{o({type:"error",message:t??"服务器系统内部错误"});break}case 204:{o({type:"error",message:t??"无内容"});break}case 400:{o({type:"error",message:t??"请求错误"});break}case 401:{o({type:"error",message:t??"请登录"}),d.push("/login");break}case 403:{o({type:"error",message:t??"无权限执行此操作"});break}case 404:{o({type:"error",message:t??"地址错误"});break}default:{o({type:"error",message:t??"请求失败"});break}}}let r;try{r=await fetch(m.test(a)?a:g.baseUrl+a,n)}catch(e){return i(0,e.message),e}const s=r.headers.get("Content-Type");if(r.ok)if(s!=null&&s.includes("application/json")){const e=await r.json();return e.code!=200&&i(e.code,e.message),e}else return s!=null&&s.includes("text/html")?r.text():r.blob();else{if(s!=null&&s.includes("application/json")){const e=await r.json();return i(e.code,e.message),e}return i(r.status,r.statusText),r}}export{S as r,h as u};
