import{s as De,E as ce,a as be,e as Pe}from"./index-C4DnY8Sm.js";import{bx as he,a0 as te,a8 as je,bu as Ve,_ as se,d as W,a as Y,j as F,a1 as J,f as xe,p as Z,r as A,Y as re,X as Re,E as He,b_ as Ue,L as w,R as z,ch as We,N as B,C as ue,I as fe,c as O,e as H,k as ye,l as R,w as ie,m as Ye,n as T,F as M,G as Q,B as le,z as Ge,W as we,ac as Se,q as ve,bf as Ae,a2 as Qe,an as Ke,o as Oe,ba as Xe,M as _e,Q as L,i as Je,u as Ze,y as $,t as et,s as Te,be as Ie,a9 as tt,by as nt,b6 as ot}from"./index-DS8UErgR.js";import{E as dt}from"./index-B6GQWuVu.js";import{a as st}from"./index-CQ3JoZQm.js";import{h as at}from"./index-B0AkaYQm.js";import{p as de,U as X}from"./index-DfvYIogZ.js";import{i as rt}from"./isEqual-C2wmjFZs.js";const U="$treeNodeId",Ee=function(e,t){!t||t[U]||Object.defineProperty(t,U,{value:e.id,enumerable:!1,configurable:!1,writable:!1})},Ce=function(e,t){return e?t[e]:t[U]},pe=(e,t,n)=>{const d=e.value.currentNode;n();const o=e.value.currentNode;d!==o&&t("current-change",o?o.data:null,o)},ge=e=>{let t=!0,n=!0,d=!0;for(let o=0,s=e.length;o<s;o++){const i=e[o];(i.checked!==!0||i.indeterminate)&&(t=!1,i.disabled||(d=!1)),(i.checked!==!1||i.indeterminate)&&(n=!1)}return{all:t,none:n,allWithoutDisable:d,half:!t&&!n}},_=function(e){if(e.childNodes.length===0||e.loading)return;const{all:t,none:n,half:d}=ge(e.childNodes);t?(e.checked=!0,e.indeterminate=!1):d?(e.checked=!1,e.indeterminate=!0):n&&(e.checked=!1,e.indeterminate=!1);const o=e.parent;!o||o.level===0||e.store.checkStrictly||_(o)},ee=function(e,t){const n=e.store.props,d=e.data||{},o=n[t];if(typeof o=="function")return o(d,e);if(typeof o=="string")return d[o];if(typeof o>"u"){const s=d[t];return s===void 0?"":s}};let it=0;class q{constructor(t){this.id=it++,this.text=null,this.checked=!1,this.indeterminate=!1,this.data=null,this.expanded=!1,this.parent=null,this.visible=!0,this.isCurrent=!1,this.canFocus=!1;for(const n in t)he(t,n)&&(this[n]=t[n]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1)}initialize(){const t=this.store;if(!t)throw new Error("[Node]store is required!");t.registerNode(this);const n=t.props;if(n&&typeof n.isLeaf<"u"){const s=ee(this,"isLeaf");typeof s=="boolean"&&(this.isLeafByUser=s)}if(t.lazy!==!0&&this.data?(this.setData(this.data),t.defaultExpandAll&&(this.expanded=!0,this.canFocus=!0)):this.level>0&&t.lazy&&t.defaultExpandAll&&!this.isLeafByUser&&this.expand(),Array.isArray(this.data)||Ee(this,this.data),!this.data)return;const d=t.defaultExpandedKeys,o=t.key;o&&d&&d.includes(this.key)&&this.expand(null,t.autoExpandParent),o&&t.currentNodeKey!==void 0&&this.key===t.currentNodeKey&&(t.currentNode=this,t.currentNode.isCurrent=!0),t.lazy&&t._initDefaultCheckedNode(this),this.updateLeafState(),this.parent&&(this.level===1||this.parent.expanded===!0)&&(this.canFocus=!0)}setData(t){Array.isArray(t)||Ee(this,t),this.data=t,this.childNodes=[];let n;this.level===0&&Array.isArray(this.data)?n=this.data:n=ee(this,"children")||[];for(let d=0,o=n.length;d<o;d++)this.insertChild({data:n[d]})}get label(){return ee(this,"label")}get key(){const t=this.store.key;return this.data?this.data[t]:null}get disabled(){return ee(this,"disabled")}get nextSibling(){const t=this.parent;if(t){const n=t.childNodes.indexOf(this);if(n>-1)return t.childNodes[n+1]}return null}get previousSibling(){const t=this.parent;if(t){const n=t.childNodes.indexOf(this);if(n>-1)return n>0?t.childNodes[n-1]:null}return null}contains(t,n=!0){return(this.childNodes||[]).some(d=>d===t||n&&d.contains(t))}remove(){const t=this.parent;t&&t.removeChild(this)}insertChild(t,n,d){if(!t)throw new Error("InsertChild error: child is required.");if(!(t instanceof q)){if(!d){const o=this.getChildren(!0);o.includes(t.data)||(typeof n>"u"||n<0?o.push(t.data):o.splice(n,0,t.data))}Object.assign(t,{parent:this,store:this.store}),t=te(new q(t)),t instanceof q&&t.initialize()}t.level=this.level+1,typeof n>"u"||n<0?this.childNodes.push(t):this.childNodes.splice(n,0,t),this.updateLeafState()}insertBefore(t,n){let d;n&&(d=this.childNodes.indexOf(n)),this.insertChild(t,d)}insertAfter(t,n){let d;n&&(d=this.childNodes.indexOf(n),d!==-1&&(d+=1)),this.insertChild(t,d)}removeChild(t){const n=this.getChildren()||[],d=n.indexOf(t.data);d>-1&&n.splice(d,1);const o=this.childNodes.indexOf(t);o>-1&&(this.store&&this.store.deregisterNode(t),t.parent=null,this.childNodes.splice(o,1)),this.updateLeafState()}removeChildByData(t){let n=null;for(let d=0;d<this.childNodes.length;d++)if(this.childNodes[d].data===t){n=this.childNodes[d];break}n&&this.removeChild(n)}expand(t,n){const d=()=>{if(n){let o=this.parent;for(;o.level>0;)o.expanded=!0,o=o.parent}this.expanded=!0,t&&t(),this.childNodes.forEach(o=>{o.canFocus=!0})};this.shouldLoadData()?this.loadData(o=>{Array.isArray(o)&&(this.checked?this.setChecked(!0,!0):this.store.checkStrictly||_(this),d())}):d()}doCreateChildren(t,n={}){t.forEach(d=>{this.insertChild(Object.assign({data:d},n),void 0,!0)})}collapse(){this.expanded=!1,this.childNodes.forEach(t=>{t.canFocus=!1})}shouldLoadData(){return this.store.lazy===!0&&this.store.load&&!this.loaded}updateLeafState(){if(this.store.lazy===!0&&this.loaded!==!0&&typeof this.isLeafByUser<"u"){this.isLeaf=this.isLeafByUser;return}const t=this.childNodes;if(!this.store.lazy||this.store.lazy===!0&&this.loaded===!0){this.isLeaf=!t||t.length===0;return}this.isLeaf=!1}setChecked(t,n,d,o){if(this.indeterminate=t==="half",this.checked=t===!0,this.store.checkStrictly)return;if(!(this.shouldLoadData()&&!this.store.checkDescendants)){const{all:i,allWithoutDisable:c}=ge(this.childNodes);!this.isLeaf&&!i&&c&&(this.checked=!1,t=!1);const r=()=>{if(n){const N=this.childNodes;for(let a=0,l=N.length;a<l;a++){const y=N[a];o=o||t!==!1;const p=y.disabled?y.checked:o;y.setChecked(p,n,!0,o)}const{half:u,all:h}=ge(N);h||(this.checked=h,this.indeterminate=u)}};if(this.shouldLoadData()){this.loadData(()=>{r(),_(this)},{checked:t!==!1});return}else r()}const s=this.parent;!s||s.level===0||d||_(s)}getChildren(t=!1){if(this.level===0)return this.data;const n=this.data;if(!n)return null;const d=this.store.props;let o="children";return d&&(o=d.children||"children"),n[o]===void 0&&(n[o]=null),t&&!n[o]&&(n[o]=[]),n[o]}updateChildren(){const t=this.getChildren()||[],n=this.childNodes.map(s=>s.data),d={},o=[];t.forEach((s,i)=>{const c=s[U];!!c&&n.findIndex(N=>N[U]===c)>=0?d[c]={index:i,data:s}:o.push({index:i,data:s})}),this.store.lazy||n.forEach(s=>{d[s[U]]||this.removeChildByData(s)}),o.forEach(({index:s,data:i})=>{this.insertChild({data:i},s)}),this.updateLeafState()}loadData(t,n={}){if(this.store.lazy===!0&&this.store.load&&!this.loaded&&(!this.loading||Object.keys(n).length)){this.loading=!0;const d=s=>{this.childNodes=[],this.doCreateChildren(s,n),this.loaded=!0,this.loading=!1,this.updateLeafState(),t&&t.call(this,s)},o=()=>{this.loading=!1};this.store.load(this,d,o)}else t&&t.call(this)}eachNode(t){const n=[this];for(;n.length;){const d=n.shift();n.unshift(...d.childNodes),t(d)}}reInitChecked(){this.store.checkStrictly||_(this)}}class lt{constructor(t){this.currentNode=null,this.currentNodeKey=null;for(const n in t)he(t,n)&&(this[n]=t[n]);this.nodesMap={}}initialize(){if(this.root=new q({data:this.data,store:this}),this.root.initialize(),this.lazy&&this.load){const t=this.load;t(this.root,n=>{this.root.doCreateChildren(n),this._initDefaultCheckedNodes()})}else this._initDefaultCheckedNodes()}filter(t){const n=this.filterNodeMethod,d=this.lazy,o=function(s){const i=s.root?s.root.childNodes:s.childNodes;if(i.forEach(c=>{c.visible=n.call(c,t,c.data,c),o(c)}),!s.visible&&i.length){let c=!0;c=!i.some(r=>r.visible),s.root?s.root.visible=c===!1:s.visible=c===!1}t&&s.visible&&!s.isLeaf&&(!d||s.loaded)&&s.expand()};o(this)}setData(t){t!==this.root.data?(this.nodesMap={},this.root.setData(t),this._initDefaultCheckedNodes()):this.root.updateChildren()}getNode(t){if(t instanceof q)return t;const n=je(t)?Ce(this.key,t):t;return this.nodesMap[n]||null}insertBefore(t,n){const d=this.getNode(n);d.parent.insertBefore({data:t},d)}insertAfter(t,n){const d=this.getNode(n);d.parent.insertAfter({data:t},d)}remove(t){const n=this.getNode(t);n&&n.parent&&(n===this.currentNode&&(this.currentNode=null),n.parent.removeChild(n))}append(t,n){const d=Ve(n)?this.root:this.getNode(n);d&&d.insertChild({data:t})}_initDefaultCheckedNodes(){const t=this.defaultCheckedKeys||[],n=this.nodesMap;t.forEach(d=>{const o=n[d];o&&o.setChecked(!0,!this.checkStrictly)})}_initDefaultCheckedNode(t){(this.defaultCheckedKeys||[]).includes(t.key)&&t.setChecked(!0,!this.checkStrictly)}setDefaultCheckedKey(t){t!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=t,this._initDefaultCheckedNodes())}registerNode(t){const n=this.key;!t||!t.data||(n?t.key!==void 0&&(this.nodesMap[t.key]=t):this.nodesMap[t.id]=t)}deregisterNode(t){!this.key||!t||!t.data||(t.childNodes.forEach(d=>{this.deregisterNode(d)}),delete this.nodesMap[t.key])}getCheckedNodes(t=!1,n=!1){const d=[],o=function(s){(s.root?s.root.childNodes:s.childNodes).forEach(c=>{(c.checked||n&&c.indeterminate)&&(!t||t&&c.isLeaf)&&d.push(c.data),o(c)})};return o(this),d}getCheckedKeys(t=!1){return this.getCheckedNodes(t).map(n=>(n||{})[this.key])}getHalfCheckedNodes(){const t=[],n=function(d){(d.root?d.root.childNodes:d.childNodes).forEach(s=>{s.indeterminate&&t.push(s.data),n(s)})};return n(this),t}getHalfCheckedKeys(){return this.getHalfCheckedNodes().map(t=>(t||{})[this.key])}_getAllNodes(){const t=[],n=this.nodesMap;for(const d in n)he(n,d)&&t.push(n[d]);return t}updateChildren(t,n){const d=this.nodesMap[t];if(!d)return;const o=d.childNodes;for(let s=o.length-1;s>=0;s--){const i=o[s];this.remove(i.data)}for(let s=0,i=n.length;s<i;s++){const c=n[s];this.append(c,d.data)}}_setCheckedKeys(t,n=!1,d){const o=this._getAllNodes().sort((r,N)=>r.level-N.level),s=Object.create(null),i=Object.keys(d);o.forEach(r=>r.setChecked(!1,!1));const c=r=>{r.childNodes.forEach(N=>{var u;s[N.data[t]]=!0,(u=N.childNodes)!=null&&u.length&&c(N)})};for(let r=0,N=o.length;r<N;r++){const u=o[r],h=u.data[t].toString();if(!i.includes(h)){u.checked&&!s[h]&&u.setChecked(!1,!1);continue}if(u.childNodes.length&&c(u),u.isLeaf||this.checkStrictly){u.setChecked(!0,!1);continue}if(u.setChecked(!0,!0),n){u.setChecked(!1,!1);const l=function(y){y.childNodes.forEach(k=>{k.isLeaf||k.setChecked(!1,!1),l(k)})};l(u)}}}setCheckedNodes(t,n=!1){const d=this.key,o={};t.forEach(s=>{o[(s||{})[d]]=!0}),this._setCheckedKeys(d,n,o)}setCheckedKeys(t,n=!1){this.defaultCheckedKeys=t;const d=this.key,o={};t.forEach(s=>{o[s]=!0}),this._setCheckedKeys(d,n,o)}setDefaultExpandedKeys(t){t=t||[],this.defaultExpandedKeys=t,t.forEach(n=>{const d=this.getNode(n);d&&d.expand(null,this.autoExpandParent)})}setChecked(t,n,d){const o=this.getNode(t);o&&o.setChecked(!!n,d)}getCurrentNode(){return this.currentNode}setCurrentNode(t){const n=this.currentNode;n&&(n.isCurrent=!1),this.currentNode=t,this.currentNode.isCurrent=!0}setUserCurrentNode(t,n=!0){const d=t[this.key],o=this.nodesMap[d];this.setCurrentNode(o),n&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0)}setCurrentNodeKey(t,n=!0){if(t==null){this.currentNode&&(this.currentNode.isCurrent=!1),this.currentNode=null;return}const d=this.getNode(t);d&&(this.setCurrentNode(d),n&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0))}}const ct=W({name:"ElTreeNodeContent",props:{node:{type:Object,required:!0},renderContent:Function},setup(e){const t=Y("tree"),n=F("NodeInstance"),d=F("RootTree");return()=>{const o=e.node,{data:s,store:i}=o;return e.renderContent?e.renderContent(J,{_self:n,node:o,data:s,store:i}):xe(d.ctx.slots,"default",{node:o,data:s},()=>[J("span",{class:t.be("node","label")},[o.label])])}}});var ht=se(ct,[["__file","tree-node-content.vue"]]);function Me(e){const t=F("TreeNodeMap",null),n={treeNodeExpand:d=>{e.node!==d&&e.node.collapse()},children:[]};return t&&t.children.push(n),Z("TreeNodeMap",n),{broadcastExpanded:d=>{if(e.accordion)for(const o of n.children)o.treeNodeExpand(d)}}}const Le=Symbol("dragEvents");function ut({props:e,ctx:t,el$:n,dropIndicator$:d,store:o}){const s=Y("tree"),i=A({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null});return Z(Le,{treeNodeDragStart:({event:u,treeNode:h})=>{if(typeof e.allowDrag=="function"&&!e.allowDrag(h.node))return u.preventDefault(),!1;u.dataTransfer.effectAllowed="move";try{u.dataTransfer.setData("text/plain","")}catch{}i.value.draggingNode=h,t.emit("node-drag-start",h.node,u)},treeNodeDragOver:({event:u,treeNode:h})=>{const a=h,l=i.value.dropNode;l&&l.node.id!==a.node.id&&re(l.$el,s.is("drop-inner"));const y=i.value.draggingNode;if(!y||!a)return;let p=!0,k=!0,m=!0,D=!0;typeof e.allowDrop=="function"&&(p=e.allowDrop(y.node,a.node,"prev"),D=k=e.allowDrop(y.node,a.node,"inner"),m=e.allowDrop(y.node,a.node,"next")),u.dataTransfer.dropEffect=k||p||m?"move":"none",(p||k||m)&&(l==null?void 0:l.node.id)!==a.node.id&&(l&&t.emit("node-drag-leave",y.node,l.node,u),t.emit("node-drag-enter",y.node,a.node,u)),p||k||m?i.value.dropNode=a:i.value.dropNode=null,a.node.nextSibling===y.node&&(m=!1),a.node.previousSibling===y.node&&(p=!1),a.node.contains(y.node,!1)&&(k=!1),(y.node===a.node||y.node.contains(a.node))&&(p=!1,k=!1,m=!1);const x=a.$el.querySelector(`.${s.be("node","content")}`).getBoundingClientRect(),v=n.value.getBoundingClientRect();let K;const P=p?k?.25:m?.45:1:-1,S=m?k?.75:p?.55:0:1;let j=-9999;const g=u.clientY-x.top;g<x.height*P?K="before":g>x.height*S?K="after":k?K="inner":K="none";const b=a.$el.querySelector(`.${s.be("node","expand-icon")}`).getBoundingClientRect(),E=d.value;K==="before"?j=b.top-v.top:K==="after"&&(j=b.bottom-v.top),E.style.top=`${j}px`,E.style.left=`${b.right-v.left}px`,K==="inner"?Re(a.$el,s.is("drop-inner")):re(a.$el,s.is("drop-inner")),i.value.showDropIndicator=K==="before"||K==="after",i.value.allowDrop=i.value.showDropIndicator||D,i.value.dropType=K,t.emit("node-drag-over",y.node,a.node,u)},treeNodeDragEnd:u=>{const{draggingNode:h,dropType:a,dropNode:l}=i.value;if(u.preventDefault(),u.dataTransfer&&(u.dataTransfer.dropEffect="move"),h&&l){const y={data:h.node.data};a!=="none"&&h.node.remove(),a==="before"?l.node.parent.insertBefore(y,l.node):a==="after"?l.node.parent.insertAfter(y,l.node):a==="inner"&&l.node.insertChild(y),a!=="none"&&(o.value.registerNode(y),o.value.key&&h.node.eachNode(p=>{var k;(k=o.value.nodesMap[p.data[o.value.key]])==null||k.setChecked(p.checked,!o.value.checkStrictly)})),re(l.$el,s.is("drop-inner")),t.emit("node-drag-end",h.node,l.node,a,u),a!=="none"&&t.emit("node-drop",h.node,l.node,a,u)}h&&!l&&t.emit("node-drag-end",h.node,null,a,u),i.value.showDropIndicator=!1,i.value.draggingNode=null,i.value.dropNode=null,i.value.allowDrop=!0}}),{dragState:i}}const ft=W({name:"ElTreeNode",components:{ElCollapseTransition:dt,ElCheckbox:st,NodeContent:ht,ElIcon:He,Loading:Ue},props:{node:{type:q,default:()=>({})},props:{type:Object,default:()=>({})},accordion:Boolean,renderContent:Function,renderAfterExpand:Boolean,showCheckbox:{type:Boolean,default:!1}},emits:["node-expand"],setup(e,t){const n=Y("tree"),{broadcastExpanded:d}=Me(e),o=F("RootTree"),s=A(!1),i=A(!1),c=A(null),r=A(null),N=A(null),u=F(Le),h=ve();Z("NodeInstance",h),e.node.expanded&&(s.value=!0,i.value=!0);const a=o.props.props.children||"children";w(()=>{const g=e.node.data[a];return g&&[...g]},()=>{e.node.updateChildren()}),w(()=>e.node.indeterminate,g=>{p(e.node.checked,g)}),w(()=>e.node.checked,g=>{p(g,e.node.indeterminate)}),w(()=>e.node.childNodes.length,()=>e.node.reInitChecked()),w(()=>e.node.expanded,g=>{z(()=>s.value=g),g&&(i.value=!0)});const l=g=>Ce(o.props.nodeKey,g.data),y=g=>{const b=e.props.class;if(!b)return{};let E;if(Ae(b)){const{data:ae}=g;E=b(ae,g)}else E=b;return Qe(E)?{[E]:!0}:E},p=(g,b)=>{(c.value!==g||r.value!==b)&&o.ctx.emit("check-change",e.node.data,g,b),c.value=g,r.value=b},k=g=>{pe(o.store,o.ctx.emit,()=>o.store.value.setCurrentNode(e.node)),o.currentNode.value=e.node,o.props.expandOnClickNode&&D(),o.props.checkOnClickNode&&!e.node.disabled&&x(null,{target:{checked:!e.node.checked}}),o.ctx.emit("node-click",e.node.data,e.node,h,g)},m=g=>{o.instance.vnode.props.onNodeContextmenu&&(g.stopPropagation(),g.preventDefault()),o.ctx.emit("node-contextmenu",g,e.node.data,e.node,h)},D=()=>{e.node.isLeaf||(s.value?(o.ctx.emit("node-collapse",e.node.data,e.node,h),e.node.collapse()):e.node.expand(()=>{t.emit("node-expand",e.node.data,e.node,h)}))},x=(g,b)=>{e.node.setChecked(b.target.checked,!o.props.checkStrictly),z(()=>{const E=o.store.value;o.ctx.emit("check",e.node.data,{checkedNodes:E.getCheckedNodes(),checkedKeys:E.getCheckedKeys(),halfCheckedNodes:E.getHalfCheckedNodes(),halfCheckedKeys:E.getHalfCheckedKeys()})})};return{ns:n,node$:N,tree:o,expanded:s,childNodeRendered:i,oldChecked:c,oldIndeterminate:r,getNodeKey:l,getNodeClass:y,handleSelectChange:p,handleClick:k,handleContextMenu:m,handleExpandIconClick:D,handleCheckChange:x,handleChildNodeExpand:(g,b,E)=>{d(b),o.ctx.emit("node-expand",g,b,E)},handleDragStart:g=>{o.props.draggable&&u.treeNodeDragStart({event:g,treeNode:e})},handleDragOver:g=>{g.preventDefault(),o.props.draggable&&u.treeNodeDragOver({event:g,treeNode:{$el:N.value,node:e.node}})},handleDrop:g=>{g.preventDefault()},handleDragEnd:g=>{o.props.draggable&&u.treeNodeDragEnd(g)},CaretRight:We}}});function yt(e,t,n,d,o,s){const i=B("el-icon"),c=B("el-checkbox"),r=B("loading"),N=B("node-content"),u=B("el-tree-node"),h=B("el-collapse-transition");return ue((O(),H("div",{ref:"node$",class:T([e.ns.b("node"),e.ns.is("expanded",e.expanded),e.ns.is("current",e.node.isCurrent),e.ns.is("hidden",!e.node.visible),e.ns.is("focusable",!e.node.disabled),e.ns.is("checked",!e.node.disabled&&e.node.checked),e.getNodeClass(e.node)]),role:"treeitem",tabindex:"-1","aria-expanded":e.expanded,"aria-disabled":e.node.disabled,"aria-checked":e.node.checked,draggable:e.tree.props.draggable,"data-key":e.getNodeKey(e.node),onClick:M(e.handleClick,["stop"]),onContextmenu:e.handleContextMenu,onDragstart:M(e.handleDragStart,["stop"]),onDragover:M(e.handleDragOver,["stop"]),onDragend:M(e.handleDragEnd,["stop"]),onDrop:M(e.handleDrop,["stop"])},[ye("div",{class:T(e.ns.be("node","content")),style:Ge({paddingLeft:(e.node.level-1)*e.tree.props.indent+"px"})},[e.tree.props.icon||e.CaretRight?(O(),R(i,{key:0,class:T([e.ns.be("node","expand-icon"),e.ns.is("leaf",e.node.isLeaf),{expanded:!e.node.isLeaf&&e.expanded}]),onClick:M(e.handleExpandIconClick,["stop"])},{default:ie(()=>[(O(),R(Ye(e.tree.props.icon||e.CaretRight)))]),_:1},8,["class","onClick"])):Q("v-if",!0),e.showCheckbox?(O(),R(c,{key:1,"model-value":e.node.checked,indeterminate:e.node.indeterminate,disabled:!!e.node.disabled,onClick:M(()=>{},["stop"]),onChange:e.handleCheckChange},null,8,["model-value","indeterminate","disabled","onClick","onChange"])):Q("v-if",!0),e.node.loading?(O(),R(i,{key:2,class:T([e.ns.be("node","loading-icon"),e.ns.is("loading")])},{default:ie(()=>[le(r)]),_:1},8,["class"])):Q("v-if",!0),le(N,{node:e.node,"render-content":e.renderContent},null,8,["node","render-content"])],6),le(h,null,{default:ie(()=>[!e.renderAfterExpand||e.childNodeRendered?ue((O(),H("div",{key:0,class:T(e.ns.be("node","children")),role:"group","aria-expanded":e.expanded},[(O(!0),H(we,null,Se(e.node.childNodes,a=>(O(),R(u,{key:e.getNodeKey(a),"render-content":e.renderContent,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,node:a,accordion:e.accordion,props:e.props,onNodeExpand:e.handleChildNodeExpand},null,8,["render-content","render-after-expand","show-checkbox","node","accordion","props","onNodeExpand"]))),128))],10,["aria-expanded"])),[[fe,e.expanded]]):Q("v-if",!0)]),_:1})],42,["aria-expanded","aria-disabled","aria-checked","draggable","data-key","onClick","onContextmenu","onDragstart","onDragover","onDragend","onDrop"])),[[fe,e.node.visible]])}var pt=se(ft,[["render",yt],["__file","tree-node.vue"]]);function gt({el$:e},t){const n=Y("tree"),d=Ke([]),o=Ke([]);Oe(()=>{i()}),Xe(()=>{d.value=Array.from(e.value.querySelectorAll("[role=treeitem]")),o.value=Array.from(e.value.querySelectorAll("input[type=checkbox]"))}),w(o,c=>{c.forEach(r=>{r.setAttribute("tabindex","-1")})}),_e(e,"keydown",c=>{const r=c.target;if(!r.className.includes(n.b("node")))return;const N=c.code;d.value=Array.from(e.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`));const u=d.value.indexOf(r);let h;if([L.up,L.down].includes(N)){if(c.preventDefault(),N===L.up){h=u===-1?0:u!==0?u-1:d.value.length-1;const l=h;for(;!t.value.getNode(d.value[h].dataset.key).canFocus;){if(h--,h===l){h=-1;break}h<0&&(h=d.value.length-1)}}else{h=u===-1?0:u<d.value.length-1?u+1:0;const l=h;for(;!t.value.getNode(d.value[h].dataset.key).canFocus;){if(h++,h===l){h=-1;break}h>=d.value.length&&(h=0)}}h!==-1&&d.value[h].focus()}[L.left,L.right].includes(N)&&(c.preventDefault(),r.click());const a=r.querySelector('[type="checkbox"]');[L.enter,L.space].includes(N)&&a&&(c.preventDefault(),a.click())});const i=()=>{var c;d.value=Array.from(e.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`)),o.value=Array.from(e.value.querySelectorAll("input[type=checkbox]"));const r=e.value.querySelectorAll(`.${n.is("checked")}[role=treeitem]`);if(r.length){r[0].setAttribute("tabindex","0");return}(c=d.value[0])==null||c.setAttribute("tabindex","0")}}const Nt=W({name:"ElTree",components:{ElTreeNode:pt},props:{data:{type:Array,default:()=>[]},emptyText:{type:String},renderAfterExpand:{type:Boolean,default:!0},nodeKey:String,checkStrictly:Boolean,defaultExpandAll:Boolean,expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkDescendants:{type:Boolean,default:!1},autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:Array,defaultExpandedKeys:Array,currentNodeKey:[String,Number],renderContent:Function,showCheckbox:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},allowDrag:Function,allowDrop:Function,props:{type:Object,default:()=>({children:"children",label:"label",disabled:"disabled"})},lazy:{type:Boolean,default:!1},highlightCurrent:Boolean,load:Function,filterNodeMethod:Function,accordion:Boolean,indent:{type:Number,default:18},icon:{type:Je}},emits:["check-change","current-change","node-click","node-contextmenu","node-collapse","node-expand","check","node-drag-start","node-drag-end","node-drop","node-drag-leave","node-drag-enter","node-drag-over"],setup(e,t){const{t:n}=Ze(),d=Y("tree"),o=F(De,null),s=A(new lt({key:e.nodeKey,data:e.data,lazy:e.lazy,props:e.props,load:e.load,currentNodeKey:e.currentNodeKey,checkStrictly:e.checkStrictly,checkDescendants:e.checkDescendants,defaultCheckedKeys:e.defaultCheckedKeys,defaultExpandedKeys:e.defaultExpandedKeys,autoExpandParent:e.autoExpandParent,defaultExpandAll:e.defaultExpandAll,filterNodeMethod:e.filterNodeMethod}));s.value.initialize();const i=A(s.value.root),c=A(null),r=A(null),N=A(null),{broadcastExpanded:u}=Me(e),{dragState:h}=ut({props:e,ctx:t,el$:r,dropIndicator$:N,store:s});gt({el$:r},s);const a=$(()=>{const{childNodes:f}=i.value,C=o?o.hasFilteredOptions!==0:!1;return(!f||f.length===0||f.every(({visible:I})=>!I))&&!C});w(()=>e.currentNodeKey,f=>{s.value.setCurrentNodeKey(f)}),w(()=>e.defaultCheckedKeys,f=>{s.value.setDefaultCheckedKey(f)}),w(()=>e.defaultExpandedKeys,f=>{s.value.setDefaultExpandedKeys(f)}),w(()=>e.data,f=>{s.value.setData(f)},{deep:!0}),w(()=>e.checkStrictly,f=>{s.value.checkStrictly=f});const l=f=>{if(!e.filterNodeMethod)throw new Error("[Tree] filterNodeMethod is required when filter");s.value.filter(f)},y=f=>Ce(e.nodeKey,f.data),p=f=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getNodePath");const C=s.value.getNode(f);if(!C)return[];const I=[C.data];let G=C.parent;for(;G&&G!==i.value;)I.push(G.data),G=G.parent;return I.reverse()},k=(f,C)=>s.value.getCheckedNodes(f,C),m=f=>s.value.getCheckedKeys(f),D=()=>{const f=s.value.getCurrentNode();return f?f.data:null},x=()=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getCurrentKey");const f=D();return f?f[e.nodeKey]:null},v=(f,C)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedNodes");s.value.setCheckedNodes(f,C)},K=(f,C)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedKeys");s.value.setCheckedKeys(f,C)},P=(f,C,I)=>{s.value.setChecked(f,C,I)},S=()=>s.value.getHalfCheckedNodes(),j=()=>s.value.getHalfCheckedKeys(),g=(f,C=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentNode");pe(s,t.emit,()=>{u(f),s.value.setUserCurrentNode(f,C)})},b=(f,C=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentKey");pe(s,t.emit,()=>{u(),s.value.setCurrentNodeKey(f,C)})},E=f=>s.value.getNode(f),ae=f=>{s.value.remove(f)},Be=(f,C)=>{s.value.append(f,C)},$e=(f,C)=>{s.value.insertBefore(f,C)},ze=(f,C)=>{s.value.insertAfter(f,C)},qe=(f,C,I)=>{u(C),t.emit("node-expand",f,C,I)},Fe=(f,C)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in updateKeyChild");s.value.updateChildren(f,C)};return Z("RootTree",{ctx:t,props:e,store:s,root:i,currentNode:c,instance:ve()}),Z(at,void 0),{ns:d,store:s,root:i,currentNode:c,dragState:h,el$:r,dropIndicator$:N,isEmpty:a,filter:l,getNodeKey:y,getNodePath:p,getCheckedNodes:k,getCheckedKeys:m,getCurrentNode:D,getCurrentKey:x,setCheckedNodes:v,setCheckedKeys:K,setChecked:P,getHalfCheckedNodes:S,getHalfCheckedKeys:j,setCurrentNode:g,setCurrentKey:b,t:n,getNode:E,remove:ae,append:Be,insertBefore:$e,insertAfter:ze,handleNodeExpand:qe,updateKeyChildren:Fe}}});function kt(e,t,n,d,o,s){const i=B("el-tree-node");return O(),H("div",{ref:"el$",class:T([e.ns.b(),e.ns.is("dragging",!!e.dragState.draggingNode),e.ns.is("drop-not-allow",!e.dragState.allowDrop),e.ns.is("drop-inner",e.dragState.dropType==="inner"),{[e.ns.m("highlight-current")]:e.highlightCurrent}]),role:"tree"},[(O(!0),H(we,null,Se(e.root.childNodes,c=>(O(),R(i,{key:e.getNodeKey(c),node:c,props:e.props,accordion:e.accordion,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,"render-content":e.renderContent,onNodeExpand:e.handleNodeExpand},null,8,["node","props","accordion","render-after-expand","show-checkbox","render-content","onNodeExpand"]))),128)),e.isEmpty?(O(),H("div",{key:0,class:T(e.ns.e("empty-block"))},[xe(e.$slots,"empty",{},()=>{var c;return[ye("span",{class:T(e.ns.e("empty-text"))},et((c=e.emptyText)!=null?c:e.t("el.tree.emptyText")),3)]})],2)):Q("v-if",!0),ue(ye("div",{ref:"dropIndicator$",class:T(e.ns.e("drop-indicator"))},null,2),[[fe,e.dragState.showDropIndicator]])],2)}var vt=se(Nt,[["render",kt],["__file","tree.vue"]]);const Ne=Te(vt),Ct=(e,{attrs:t,emit:n},{select:d,tree:o,key:s})=>{const i=Y("tree-select");return w(()=>e.data,()=>{e.filterable&&z(()=>{var r,N;(N=o.value)==null||N.filter((r=d.value)==null?void 0:r.states.inputValue)})},{flush:"post"}),{...de(Ie(e),Object.keys(ce.props)),...t,"onUpdate:modelValue":r=>n(X,r),valueKey:s,popperClass:$(()=>{const r=[i.e("popper")];return e.popperClass&&r.push(e.popperClass),r.join(" ")}),filterMethod:(r="")=>{var N;e.filterMethod?e.filterMethod(r):e.remoteMethod?e.remoteMethod(r):(N=o.value)==null||N.filter(r)}}},mt=W({extends:be,setup(e,t){const n=be.setup(e,t);delete n.selectOptionClick;const d=ve().proxy;return z(()=>{n.select.states.cachedOptions.get(d.value)||n.select.onOptionCreate(d)}),w(()=>t.attrs.visible,o=>{n.states.visible=o},{immediate:!0}),n},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function ke(e){return e||e===0}function me(e){return Array.isArray(e)&&e.length}function V(e){return Array.isArray(e)?e:ke(e)?[e]:[]}function ne(e,t,n,d,o){for(let s=0;s<e.length;s++){const i=e[s];if(t(i,s,e,o))return d?d(i,s,e,o):i;{const c=n(i);if(me(c)){const r=ne(c,t,n,d,i);if(r)return r}}}}function oe(e,t,n,d){for(let o=0;o<e.length;o++){const s=e[o];t(s,o,e,d);const i=n(s);me(i)&&oe(i,t,n,s)}}const bt=(e,{attrs:t,slots:n,emit:d},{select:o,tree:s,key:i})=>{w(()=>e.modelValue,()=>{e.showCheckbox&&z(()=>{const a=s.value;a&&!rt(a.getCheckedKeys(),V(e.modelValue))&&a.setCheckedKeys(V(e.modelValue))})},{immediate:!0,deep:!0});const c=$(()=>({value:i.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),r=(a,l)=>{var y;const p=c.value[a];return Ae(p)?p(l,(y=s.value)==null?void 0:y.getNode(r("value",l))):l[p]},N=V(e.modelValue).map(a=>ne(e.data||[],l=>r("value",l)===a,l=>r("children",l),(l,y,p,k)=>k&&r("value",k))).filter(a=>ke(a)),u=$(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const a=[];return oe(e.data.concat(e.cacheData),l=>{const y=r("value",l);a.push({value:y,currentLabel:r("label",l),isDisabled:r("disabled",l)})},l=>r("children",l)),a}),h=()=>{var a;return(a=s.value)==null?void 0:a.getCheckedKeys().filter(l=>{var y;const p=(y=s.value)==null?void 0:y.getNode(l);return!tt(p)&&nt(p.childNodes)})};return{...de(Ie(e),Object.keys(Ne.props)),...t,nodeKey:i,expandOnClickNode:$(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:$(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(N):N),renderContent:(a,{node:l,data:y,store:p})=>a(mt,{value:r("value",y),label:r("label",y),disabled:r("disabled",y),visible:l.visible},e.renderContent?()=>e.renderContent(a,{node:l,data:y,store:p}):n.default?()=>n.default({node:l,data:y,store:p}):void 0),filterNodeMethod:(a,l,y)=>e.filterNodeMethod?e.filterNodeMethod(a,l,y):a?new RegExp(Pe(a),"i").test(r("label",l)||""):!0,onNodeClick:(a,l,y)=>{var p,k,m,D;if((p=t.onNodeClick)==null||p.call(t,a,l,y),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||l.isLeaf)){if(!r("disabled",a)){const x=(k=o.value)==null?void 0:k.states.options.get(r("value",a));(m=o.value)==null||m.handleOptionSelect(x)}}else e.expandOnClickNode&&y.proxy.handleExpandIconClick();(D=o.value)==null||D.focus()}},onCheck:(a,l)=>{var y;if(!e.showCheckbox)return;const p=r("value",a),k={};oe([s.value.store.root],v=>k[v.key]=v,v=>v.childNodes);const m=l.checkedKeys,D=e.multiple?V(e.modelValue).filter(v=>!(v in k)&&!m.includes(v)):[],x=D.concat(m);if(e.checkStrictly)d(X,e.multiple?x:x.includes(p)?p:void 0);else if(e.multiple){const v=h();d(X,D.concat(v))}else{const v=ne([a],S=>!me(r("children",S))&&!r("disabled",S),S=>r("children",S)),K=v?r("value",v):void 0,P=ke(e.modelValue)&&!!ne([a],S=>r("value",S)===e.modelValue,S=>r("children",S));d(X,K===e.modelValue||P?void 0:K)}z(()=>{var v;const K=V(e.modelValue);s.value.setCheckedKeys(K),(v=t.onCheck)==null||v.call(t,a,{checkedKeys:s.value.getCheckedKeys(),checkedNodes:s.value.getCheckedNodes(),halfCheckedKeys:s.value.getHalfCheckedKeys(),halfCheckedNodes:s.value.getHalfCheckedNodes()})}),(y=o.value)==null||y.focus()},onNodeExpand:(a,l,y)=>{var p;(p=t.onNodeExpand)==null||p.call(t,a,l,y),z(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&l.checked){const k={},m=s.value.getCheckedKeys();oe([s.value.store.root],v=>k[v.key]=v,v=>v.childNodes);const D=V(e.modelValue).filter(v=>!(v in k)&&!m.includes(v)),x=h();d(X,D.concat(x))}})},cacheOptions:u}};var Kt=W({props:{data:{type:Array,default:()=>[]}},setup(e){const t=F(De);return w(()=>e.data,()=>{var n;e.data.forEach(o=>{t.states.cachedOptions.has(o.value)||t.states.cachedOptions.set(o.value,o)});const d=((n=t.selectRef)==null?void 0:n.querySelectorAll("input"))||[];ot&&!Array.from(d).includes(document.activeElement)&&t.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const Et=W({name:"ElTreeSelect",inheritAttrs:!1,props:{...ce.props,...Ne.props,cacheData:{type:Array,default:()=>[]}},setup(e,t){const{slots:n,expose:d}=t,o=A(),s=A(),i=$(()=>e.nodeKey||e.valueKey||"value"),c=Ct(e,t,{select:o,tree:s,key:i}),{cacheOptions:r,...N}=bt(e,t,{select:o,tree:s,key:i}),u=te({});return d(u),Oe(()=>{Object.assign(u,{...de(s.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...de(o.value,["focus","blur"])})}),()=>J(ce,te({...c,ref:h=>o.value=h}),{...n,default:()=>[J(Kt,{data:r.value}),J(Ne,te({...N,ref:h=>s.value=h}))]})}});var Dt=se(Et,[["__file","tree-select.vue"]]);const Mt=Te(Dt);export{Ne as E,Mt as a};
