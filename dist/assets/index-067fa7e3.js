import{d as H,e as L,f as O}from"./user-0222af61.js";import{_ as G,d as J,r as y,o as K,B as P,c as a,a as t,t as r,u as o,b as c,w as _,i as W,e as h,E as I,C as X,f as C,g as l,F as S,h as T,A as p,p as Y,l as Z,k as ee}from"./index-a92f1ef3.js";import{c as te}from"./index-20ac2abc.js";import"./index-5a5d1dbc.js";const F=v=>(Y("data-v-997b15c0"),v=v(),Z(),v),se={class:"box"},ue={class:"left"},oe={class:"exam-title"},ae={class:"content-title"},le={key:0},ne={key:1},ie={key:0},re={key:1},de={key:2},ce={key:3},_e=F(()=>t("span",null,".",-1)),he=F(()=>t("span",{style:{"font-size":"0.9rem","margin-right":"1rem"}},"请选择",-1)),pe=h("A"),Fe=h("B"),ve=h("C"),fe=h("D"),ye=F(()=>t("div",null,null,-1)),me={class:"right"},ge={class:"right-1"},Ce=F(()=>t("div",{class:"right-1-1"},"如未录像或人像显示不全，成绩作废",-1)),Be={class:"right-2"},Ae=F(()=>t("div",{class:"right-2-1"},"试卷详情",-1)),ke={class:"right-2-2"},Ee={class:"right-2-2"},xe={class:"right-2-2"},Ie=F(()=>t("div",{class:"right-2-2"},"每道题："+r(1)+"分",-1)),be={class:"right-2-2"},De={class:"right-3"},qe={class:"right-2-1"},we=h(" 剩余时间："),Ne={style:{"font-weight":"500",color:"red"}},Ve=h("交卷"),Se=J({props:["examId"],setup(v){const M=v,R=ee();let m=y(1e3),d=y({}),B=y([]);const A=y();let $=async()=>{await H({examId:M.examId}).then(e=>{e.code==200?(d.value=e.data,m.value=Number.isNaN(e.data.examDuration)?0:e.data.examDuration*60):I({type:"error",message:e.errMsg})}),L({ids:d.value.questionIds}).then(e=>{e.code==200&&(B.value=e.data.data)})},b=()=>{A.value.srcObject||X.alert("请开启摄像头权限，如不开启摄像头则本次考试无效！","警告",{type:"warning",confirmButtonText:"确定",callback:b})},g=(e,s)=>{e.result??(e.result=new Set),e.questionType==1&&(e.result.clear(),e.result.add(s)),e.questionType==2&&(e.result.has(s)?e.result.delete(s):e.result.add(s))},f=y(!1),k=()=>{let e=[];B.value.reduce((s,n)=>(n.result?s.push([...n.result].sort((E,x)=>E-x).join()):s.push(""),s),e),O({questionIds:"23,24,25,32,34,36",userAnswers:e.join("-"),examId:d.value.examId,examQtId:d.value.examQtId,creditImgUrl:""}).then(s=>{s.code==200?(I({type:"success",message:"交卷成功"}),R.back()):I({type:"error",message:s.errMsg})})},j=e=>{let s=Math.floor(e/60),n=e%60;return`${s>0?s+"分":""}${n}秒`},Q=setInterval(()=>{m.value>0?m.value--:f.value=!0},1e3);return K(()=>{te(A.value).then(()=>{b()}),$()}),P(()=>{clearInterval(Q)}),(e,s)=>{var D;const n=C("el-button"),E=C("el-scrollbar"),x=C("el-alert"),U=C("el-dialog");return l(),a("div",se,[t("div",ue,[t("div",oe,r(o(d).examName),1),c(E,{class:"content",height:"70vh"},{default:_(()=>[(l(!0),a(S,null,T(o(B),(u,z)=>{var q,w,N,V;return l(),a("div",{key:u.questionId,class:"content-item"},[t("div",ae,[t("span",null,r(z+1)+".",1),u.questionType==1?(l(),a("span",le,"【单选题】")):p("",!0),u.questionType==2?(l(),a("span",ne,"【多选题】")):p("",!0),t("span",null,r(u.questionContent),1)]),t("div",null,[(l(!0),a(S,null,T(u.answer,i=>(l(),a("div",{key:i.id,class:"answer-item"},[i.id==0?(l(),a("span",ie,"A")):p("",!0),i.id==1?(l(),a("span",re,"B")):p("",!0),i.id==2?(l(),a("span",de,"C")):p("",!0),i.id==3?(l(),a("span",ce,"D")):p("",!0),_e,h(" "+r(i.answer),1)]))),128))]),t("div",null,[he,c(n,{circle:"",type:(q=u.result)!=null&&q.has(0)?"primary":"default",onClick:i=>o(g)(u,0)},{default:_(()=>[pe]),_:2},1032,["type","onClick"]),c(n,{circle:"",type:(w=u.result)!=null&&w.has(1)?"primary":"default",onClick:i=>o(g)(u,1)},{default:_(()=>[Fe]),_:2},1032,["type","onClick"]),c(n,{circle:"",type:(N=u.result)!=null&&N.has(2)?"primary":"default",onClick:i=>o(g)(u,2)},{default:_(()=>[ve]),_:2},1032,["type","onClick"]),c(n,{circle:"",type:(V=u.result)!=null&&V.has(3)?"primary":"default",onClick:i=>o(g)(u,3)},{default:_(()=>[fe]),_:2},1032,["type","onClick"])]),ye])}),128))]),_:1})]),t("div",me,[t("div",ge,[Ce,t("video",{ref_key:"videoRef",ref:A},null,512)]),t("div",Be,[Ae,t("div",ke,"本卷共分为："+r((D=o(d).questionIds)==null?void 0:D.split(",").length)+"小题",1),t("div",Ee,"作答时间："+r(o(d).examDuration)+"分钟",1),t("div",xe,"试卷总分："+r(o(d).totalScore)+"分",1),Ie,t("div",be,"及格分："+r(o(d).passScore)+"分",1)]),t("div",De,[t("div",qe,[we,t("span",Ne,r(o(j)(o(m))),1)])]),t("div",{class:"right-button",onClick:s[0]||(s[0]=(...u)=>o(k)&&o(k)(...u))},"确认交卷")]),c(U,{modelValue:o(f),"onUpdate:modelValue":s[1]||(s[1]=u=>W(f)?f.value=u:f=u),title:"考试提示",center:"",width:"15rem"},{footer:_(()=>[c(n,{type:"primary",onClick:o(k)},{default:_(()=>[Ve]),_:1},8,["onClick"])]),default:_(()=>[c(x,{title:"考试时间到了，请交卷！",type:"warning","show-icon":!0,closable:!1})]),_:1},8,["modelValue"])])}}}),je=G(Se,[["__scopeId","data-v-997b15c0"]]);export{je as default};
