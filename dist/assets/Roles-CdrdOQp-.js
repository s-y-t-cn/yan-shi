import{d as z,r,o as J,P as x,c as L,e as A,k as G,D as a,w as l,ac as R,g as s,ai as H,bM as K,bS as Q,al as _,E as W,bJ as X,bL as w,bT as Y,bU as Z,bV as ee}from"./index-Bsn8uhFR.js";/* empty css                   *//* empty css                     *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  */import{E as te}from"./el-tree-select-Dhi-v-mF.js";/* empty css                    */import{E as ae}from"./el-popover-Ceu9nK0v.js";/* empty css                  */import{S as oe}from"./SytTable-CpLTqMDC.js";import{E as le}from"./index-NV_0FHae.js";import{E as se}from"./index-f9LhncNo.js";import{E as ne,a as re}from"./index-WB42fc2K.js";import{b as ie}from"./index-CEJYwNXW.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-qZKloEJB.js";import"./error-DyDUhvQa.js";import"./isEqual-DLLu8dhP.js";import"./index-li2vGeyt.js";import"./index-C-Yt4Yjn.js";import"./castArray-dThNn2ng.js";import"./index-9zNjbeCL.js";import"./index-DgBkyx5Q.js";import"./index-C2ioxsOw.js";import"./_baseClone-BqSBTuLD.js";import"./vnode-Ce9ES3ru.js";const de={class:"container"},ue={class:"tools"},pe=z({__name:"Roles",setup(ce){const T=r([{title:"角色名",dataIndex:"name"},{title:"菜单",dataIndex:"menusNames"}]);let b=r([]),v=r([]),h=r(!0),i=r(!1),y=r(null),d=r("");const k=r({name:[{required:!0,message:"请输入角色名",trigger:"blur"}],menus:[{required:!0,message:"请选择菜单",trigger:"change"}]});let E=()=>({name:"",pid:"",menus:[]}),n=r(E());const V=r([]),C=async()=>{await X().then(t=>{t.code===200&&(b.value=t.data,V.value=w(t.data))})},I=async()=>{await Y().then(t=>{t.code===200&&(t.data.forEach(e=>{e.menusNames=e.menus.map(p=>{var c,m;return(m=(c=b.value.find(g=>p==g.id))==null?void 0:c.meta)==null?void 0:m.title})}),v.value=w(t.data))})},u=async()=>{await C(),await I(),h.value=!1},B=()=>{d.value="添加",i.value=!0,n.value=E()},F=t=>{d.value="编辑",i.value=!0,n.value=K(t)},M=async()=>{let t=Object.assign({},n.value);Z(t).then(e=>{e.code==200&&(_({type:"success",message:"添加成功"}),u())})},N=async()=>{let t=Object.assign({},n.value);ee(t).then(e=>{e.code==200&&(_({type:"success",message:"编辑成功"}),u())})},U=t=>{t.id?Q({id:t.id}).then(e=>{e.code==200&&(_({type:"success",message:"删除成功"}),u())}):_({type:"error",message:"不存在的id"})},S=t=>{t&&t.validate(e=>{e?(d.value==="添加"?M():N(),i.value=!1):console.log("验证失败!")})};return J(()=>{u()}),(t,e)=>{const p=le,c=x("Edit"),m=W,g=x("Delete"),O=ae,j=se,f=ne,D=te,q=re,P=ie;return L(),A("div",de,[G("div",ue,[a(p,{onClick:B},{default:l(()=>[R("添加角色")]),_:1})]),a(oe,{columns:T.value,data:s(v)},{operations:l(({row:o})=>[a(m,{class:"icon",color:"#0af",onClick:$=>F(o)},{default:l(()=>[a(c)]),_:2},1032,["onClick"]),a(O,{title:"确定删除?",onConfirm:$=>U(o)},{reference:l(()=>[a(m,{class:"icon",color:"#f00"},{default:l(()=>[a(g)]),_:1})]),_:2},1032,["onConfirm"])]),_:1},8,["columns","data"]),a(P,{modelValue:s(i),"onUpdate:modelValue":e[4]||(e[4]=o=>H(i)?i.value=o:i=o),title:s(d),width:"350px"},{default:l(()=>[a(q,{ref_key:"ruleFormRef",ref:y,model:s(n),rules:k.value,size:"large",class:"w-full","label-width":"auto"},{default:l(()=>[a(f,{label:"角色名",prop:"name"},{default:l(()=>[a(j,{modelValue:s(n).name,"onUpdate:modelValue":e[0]||(e[0]=o=>s(n).name=o),placeholder:"角色名",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),a(f,{label:"权限菜单",prop:"menus"},{default:l(()=>[a(D,{modelValue:s(n).menus,"onUpdate:modelValue":e[1]||(e[1]=o=>s(n).menus=o),data:V.value,props:{label:o=>o.meta.title,value:"id"},"check-strictly":"",multiple:"","render-after-expand":!1,style:{width:"240px"}},null,8,["modelValue","data","props"])]),_:1}),a(f,{label:"上级角色"},{default:l(()=>[a(D,{modelValue:s(n).pid,"onUpdate:modelValue":e[2]||(e[2]=o=>s(n).pid=o),data:s(v),props:{label:"name",value:"id"},"check-strictly":"","render-after-expand":!1,clearable:"",style:{width:"240px"}},null,8,["modelValue","data"])]),_:1}),a(f,null,{default:l(()=>[a(p,{class:"w-full",type:"primary",onClick:e[3]||(e[3]=o=>S(s(y)))},{default:l(()=>[R(" 保存 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),ze=me(pe,[["__scopeId","data-v-c8352330"]]);export{ze as default};
