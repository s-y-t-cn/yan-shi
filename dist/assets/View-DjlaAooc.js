import{d as z,r as c,y as U,z as j,c as i,k as b,w as o,M as s,j as d,t as k,g as n,e as D,H as I,G as x,O as v,N as J,a8 as L,a9 as R}from"./index-B2ff-rFN.js";import{E as $}from"./el-space-EBiyQCyk.js";/* empty css                  */import{E as G,a as H}from"./el-timeline-item-CMwLOUPW.js";import{E as M}from"./el-card-Ckky4xsX.js";/* empty css                     */import{w as P,f as W}from"./examples-BP7CqAXr.js";import{u as q}from"./index-CDp5nt-z.js";import{S as A}from"./SytPreviewItem-DU7EPsfQ.js";import{a as K}from"./index-BIK7ipUj.js";import{f as Q}from"./index-CvnddM-F.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vnode-CgXj8ZtL.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-BWwQj9eg.js";import"./index-Bfj94Vt0.js";import"./typescript-PpV26QSH.js";import"./index-CQNAlFu8.js";import"./el-tag-5atBDTvJ.js";import"./el-checkbox-TOO-gUmm.js";import"./_Uint8Array-CLf01t9B.js";import"./isEqual-B5Vhr8lN.js";import"./index-DxdYCs-v.js";import"./focus-trap-VkXHYWcf.js";import"./scroll-JHJnPUrU.js";import"./castArray-D7uxE5bV.js";import"./el-radio-8apkelsO.js";import"./index-BOj1OCJV.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-V1vgd0a3.js";import"./index-BEiJmhUx.js";import"./_baseClone-CmqJW0qa.js";const Y=f=>(L("data-v-ffb59fe0"),f=f(),R(),f),Z=Y(()=>d("span",null,"流程",-1)),ee=z({__name:"View",props:{data:Object},emits:["examine"],setup(f,{emit:V}){const g=q(),h=f,F=V;let a=c({name:"",status:"",submitter:{},formData:[],flowData:[]}),_=c(!1);U(()=>JSON.parse(JSON.stringify(h.data)),async t=>{let e=t.formData,r=(await W({name:t.name})).data.formData;for(let m in e)N(m,r).value=e[m];a.value=t,a.value.formData=r,_.value=!1},{deep:!0,immediate:!0});const N=(t,e)=>{for(let r of e)if(r.type==="layout"){for(let m of r.cols)for(let p of m.children)if(t===p.field)return p}else if(t===r.field)return r};let u=c({flowId:"",examineId:"",status:""}),B=j(()=>{let t=a.value.flowData.map(e=>{switch(u.value.flowId=a.value._id,e.status){case"未处理":e.color="";break;case"处理中":e.color="",e.username===g.username&&(_.value=!0,u.value.examineId=e.id);break;case"通过":e.color="#00aabb";break;case"否决":e.color="#ff0000"}return e});return t.unshift({type:"发起人",label:a.value.submitter.nickname,color:"#00aabb"}),t});const S=c(),y=t=>{u.value.status=t,P(u.value).then(()=>F("examine"))};return(t,e)=>{const r=K,m=M,p=H,C=G,E=Q,O=$;return i(),b(O,{direction:"vertical",fill:"",class:"submit-container"},{default:o(()=>[s(m,null,{header:o(()=>[d("h1",null,k(n(a).name),1)]),default:o(()=>[s(r,{ref_key:"ruleFormRef",ref:S,model:n(a).formData,disabled:""},{default:o(()=>[(i(!0),D(x,null,I(n(a).formData,(l,w)=>(i(),b(A,{key:l.field,modelValue:n(a).formData[w],"onUpdate:modelValue":T=>n(a).formData[w]=T,index:w.toString(),"rule-form-ref":S.value},null,8,["modelValue","onUpdate:modelValue","index","rule-form-ref"]))),128))]),_:1},8,["model"])]),_:1}),s(m,null,{header:o(()=>[Z]),default:o(()=>[s(C,null,{default:o(()=>[(i(!0),D(x,null,I(n(B),l=>(i(),b(p,{key:l.id,color:l.color,timestamp:l.timestamp},{default:o(()=>[d("div",null,k(l.type),1),d("div",null,k(l.label),1)]),_:2},1032,["color","timestamp"]))),128))]),_:1}),n(_)?(i(),D(x,{key:0},[s(E,{size:"small",type:"warning",onClick:e[0]||(e[0]=l=>y("通过")),icon:"SuccessFilled"},{default:o(()=>[v(" 通过 ")]),_:1}),s(E,{size:"small",type:"danger",onClick:e[1]||(e[1]=l=>y("否决")),icon:"Failed"},{default:o(()=>[v(" 否决 ")]),_:1})],64)):J("",!0)]),_:1})]),_:1})}}}),Oe=X(ee,[["__scopeId","data-v-ffb59fe0"]]);export{Oe as default};
