import{d as W,ah as Y,r as k,N as $,y as q,c as h,l as I,w as p,D as v,k as b,t as x,g as c,e as V,ae as B,Y as C,ac as z,am as G,an as H}from"./index-Bsn8uhFR.js";import{E as K,S as M}from"./SytPreviewItem-S8t7P-EL.js";/* empty css                  */import{E as Q,a as X}from"./el-timeline-item-9cNf6uU6.js";import{E as Z}from"./el-card-P9uYmptO.js";/* empty css                     */import{h as ee,j as te}from"./examples-k_dzLM7F.js";import{a as ae}from"./index-WB42fc2K.js";import{E as oe}from"./index-NV_0FHae.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vnode-Ce9ES3ru.js";/* empty css                 *//* empty css                  *//* empty css               *//* empty css                    */import"./el-radio-Bnf4y1jI.js";/* empty css                  */import"./index-f9LhncNo.js";import"./error-DyDUhvQa.js";import"./index-DFENW1vO.js";import"./index-qZKloEJB.js";import"./isEqual-DLLu8dhP.js";import"./index-li2vGeyt.js";import"./index-C-Yt4Yjn.js";import"./castArray-dThNn2ng.js";import"./index-tMJgX954.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-B9r6-Uhw.js";import"./index-BqWwdBzB.js";import"./_baseClone-BqSBTuLD.js";const le=_=>(G("data-v-56e97eab"),_=_(),H(),_),ne=le(()=>b("span",null,"流程",-1)),ie=W({__name:"EditSubmit",props:{data:{type:Object,default(){return{name:"",formData:[],flowData:{nodesData:[],linesData:[]}}}}},emits:["submit"],setup(_,{emit:O}){const w=Y(),J=_,T=O;let s=k({name:"",formData:[],flowData:{nodesData:[],linesData:[]}});$(()=>JSON.parse(JSON.stringify(J.data)),t=>{s.value=t},{deep:!0,immediate:!0});const U=t=>{for(let a of s.value.formData)if(a.type==="layout"){for(let r of a.cols)for(let e of r.children)if(t===e.field)return e}else if(t===a.field)return a};let g=q(()=>j(s.value)),F=k({label:"部门主管",value:"部门主管"});ee().then(t=>{var a;F.value=(a=t.data.find(r=>r.value==w.department))==null?void 0:a.children.find(r=>r.label.includes("主管"))});const j=t=>{var u;let a=[],r={id:"",type:""},{nodesData:e,linesData:d}=t.flowData,i=r=e.find(o=>o.type==="start");if(!i)return[];for(i.color="#00aabb",a.push(i);d.find(o=>o.fromId===r.id);){let o={id:""},l=d.filter(n=>n.fromId===r.id);if(r.type=="condition"){let n=l.findIndex(D=>D.text==="是"),m=l.findIndex(D=>D.text==="否"),f=n,{field:R,comparison:A,value:S}=r.properties,y=U(R);if(y)switch(A){case"小于":y.value<S?f=n:f=m;break;case"等于":y.value===S?f=n:f=m;break;case"大于":y.value>S?f=n:f=m;break}o=e.find(D=>{var N;return D.id===((N=l[f])==null?void 0:N.toId)})}else o=e.find(n=>{var m;return n.id===((m=l[0])==null?void 0:m.toId)}),(o==null?void 0:o.type)=="handle"&&((u=o.properties)==null?void 0:u.value)=="部门主管"&&(o.properties=F.value);(o==null?void 0:o.type)!="condition"&&a.push(o),r=o}return a},E=k(),L=()=>{let t=new FormData;t.append("name",s.value.name),t.append("submitter",JSON.stringify({username:w.username,nickname:w.nickname}));let a={};s.value.formData.forEach(e=>{e.type==="img-upload"?e.value.forEach(d=>t.append(e.field,d)):e.type==="layout"?e.cols.forEach(d=>{d.children.forEach(i=>{i.type==="img-upload"?i.value.forEach(u=>t.append(i.field,u)):a[i.field]=i.value})}):a[e.field]=e.value}),t.append("formData",JSON.stringify(a));let r=g.value.filter(e=>e.type==="handle").map(e=>({id:e.id,type:e.text,label:e.properties.label,username:e.properties.value,status:"未处理"}));return t.append("flowData",JSON.stringify(r)),t},P=t=>{if(!t)return!1;t.validate(a=>{if(a)te(L()).then(()=>T("submit"));else return!1})};return(t,a)=>{const r=ae,e=Z,d=X,i=Q,u=oe,o=K;return h(),I(o,{direction:"vertical",fill:"",class:"submit-container"},{default:p(()=>[v(e,null,{header:p(()=>[b("h1",null,x(c(s).name),1)]),default:p(()=>[v(r,{ref_key:"ruleFormRef",ref:E,model:c(s).formData},{default:p(()=>[(h(!0),V(C,null,B(c(s).formData,(l,n)=>(h(),I(M,{key:l.field,modelValue:c(s).formData[n],"onUpdate:modelValue":m=>c(s).formData[n]=m,index:n.toString(),"rule-form-ref":E.value,onCascaderFetch:m=>l.options=m},null,8,["modelValue","onUpdate:modelValue","index","rule-form-ref","onCascaderFetch"]))),128))]),_:1},8,["model"])]),_:1}),v(e,null,{header:p(()=>[ne]),default:p(()=>[v(i,null,{default:p(()=>[(h(!0),V(C,null,B(c(g),l=>(h(),I(d,{key:l.id,icon:l.icon,color:l.color,timestamp:l.timestamp},{default:p(()=>{var n;return[b("div",null,x(l.text),1),b("div",null,x((n=l.properties)==null?void 0:n.label),1)]}),_:2},1032,["icon","color","timestamp"]))),128))]),_:1}),v(u,{type:"primary",onClick:a[0]||(a[0]=l=>P(E.value))},{default:p(()=>[z("提交")]),_:1})]),_:1})]),_:1})}}}),Le=re(ie,[["__scopeId","data-v-56e97eab"]]);export{Le as default};
