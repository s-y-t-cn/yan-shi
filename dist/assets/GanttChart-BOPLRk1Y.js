var Me=Object.defineProperty;var Ve=(h,P,y)=>P in h?Me(h,P,{enumerable:!0,configurable:!0,writable:!0,value:y}):h[P]=y;var p=(h,P,y)=>Ve(h,typeof P!="symbol"?P+"":P,y);import{E as K,d as Le,c as $e}from"./index-16XDJShn.js";import{d as ce,ay as ze,r as j,y as ie,L as Se,a4 as Be,a0 as re,o as Ce,c as d,e as c,k as u,z as de,G as A,C as i,w as r,g as o,aa as Y,W as E,ac as I,l as W,A as U,t as D,n as Ue,ak as Ne,al as We}from"./index-g37XHkO7.js";import{E as Q}from"./index-7XQ89VVv.js";import{a as te,E as T}from"./index-ekn85pdJ.js";import{E as Xe}from"./index-QePRsbhT.js";import{E as ae}from"./index-BANbd_X-.js";import{E as Z}from"./index-CWjOxhQe.js";import{E as ue,a as me}from"./index-Cq1NGWuE.js";import{E as Oe}from"./index-pm3rvx5C.js";import{d as Fe}from"./index-ClVUFy22.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-BosuxZz1.js";import"./error-C6KkHRRa.js";import"./isEqual-sIzh-_wJ.js";import"./castArray-D6nup7xA.js";import"./_baseClone-YGkPyP1V.js";import"./position-8TaTLdEo.js";import"./dropdown-D2TiOhAW.js";import"./index-Ct0d8tij.js";const ve=h=>(Ne("data-v-8ce63f22"),h=h(),We(),h),Ye={class:"syt-gantt-chart"},Ge={class:"names-box"},He={class:"chart-box"},Re=["width","height","viewBox"],qe=ve(()=>u("defs",null,[u("filter",{id:"shadow"},[u("feDropShadow",{dx:"1",dy:"1",stdDeviation:"0.5","flood-color":"#036","flood-opacity":"0.3"})])],-1)),Je=["transform"],Ke=["x1","y1","x2","y2"],Qe=["transform"],Ze={key:0},et=["width","height"],tt=["x","y"],at={key:1},lt=["x1","x2","y2","stroke"],nt=["transform","onPointerenter"],ot=["x1","x2"],st=["x","width","height"],it=["transform","onPointerdown","onContextmenu"],rt=["y","width","height","fill"],dt=["y"],ut=["x1","x2","y2","onPointerdown"],mt=["transform"],ct=["y2","stroke"],vt=["fill"],ft=["y"],ht=["transform"],pt=["y2","stroke"],xt=["fill"],wt=["y"],yt={class:"menu-item"},gt=ve(()=>u("div",null,"编辑",-1)),N=1e3*60*60*24,le=1e3*60*60,Tt=ce({__name:"SytGanttChart",props:{linesData:{type:Array,default:()=>[{id:"1",name:"线1"},{id:"2",name:"线2"},{id:"3",name:"线3"}]},plansData:{type:Array,default:()=>[{id:Math.random(),lineId:"1",name:"计划1",projectId:"1",projectName:"项目1",startTime:Date.now(),endTime:Date.now()+1e3*60*60*5,projectDeadline:Date.now()+1e3*60*60*1e3},{id:Math.random(),lineId:"1",name:"计划",projectId:"2",projectName:"项目2",startTime:Date.now()+1e3*60*60*5,endTime:Date.now()+1e3*60*60*20,projectDeadline:Date.now()+1e3*60*60*20},{id:Math.random(),lineId:"2",name:"计划2",projectId:"1",projectName:"项目1",startTime:Date.now(),endTime:Date.now()+1e3*60*60*1e3,projectDeadline:Date.now()+1e3*60*60*1e3}]},viewBoxWidth:{type:Number,default:1e3},limitStep:{type:Boolean,default:!0}},emits:["createPlan","editPlan","deletePlan","slicePlan"],setup(h,{emit:P}){ze(a=>({"6181af08":fe.value}));const y=h,B=P,g=j(0),v=j(30),fe=ie(()=>`${v.value}px`),V=j([]),G=j(!1),H=["hsl(0 80% 70%)","hsl(50 80% 70%)","hsl(100 80% 70%)","hsl(150 80% 70%)","hsl(200 80% 70%)","hsl(250 80% 70%)","hsl(300 80% 70%)","hsl(350 80% 70%)"];let L=0;Se(()=>y.plansData,()=>{L=0,V.value=[],y.plansData.forEach(a=>{V.value.some(e=>e.id==a.projectId)||(V.value.push({id:a.projectId,name:a.projectName,deadline:a.projectDeadline,color:H[L]}),L=(L+1)%H.length)})},{immediate:!0});class R{constructor(e){p(this,"isLineNode",!0);p(this,"id","");p(this,"name","");p(this,"children",[]);p(this,"rawData",{});({id:this.id,name:this.name}=e),this.rawData=e}add(e){e.parent&&e.parent.remove(e),e.parent=this,e.lineId=this.id,this.children.push(e)}remove(e){const t=this.children.indexOf(e);t!==-1&&this.children.splice(t,1)}}class q{constructor(e){p(this,"isTimeNode",!0);p(this,"id","");p(this,"name","");p(this,"parent",null);p(this,"startTime",0);p(this,"endTime",0);p(this,"rawData",{});({id:this.id,name:this.name,startTime:this.startTime,endTime:this.endTime}=e),this.rawData=e}}class J extends q{constructor(t){super(t);p(this,"isPlanNode",!0);p(this,"lineId","");p(this,"projectId","");p(this,"projectName","");p(this,"projectDeadline",null);({lineId:this.lineId,projectId:this.projectId,projectName:this.projectName,projectDeadline:this.projectDeadline}=t)}slice(t){const s={id:Math.random(),lineId:this.lineId,name:this.name+"复制",projectId:this.projectId,projectName:this.projectName,startTime:t,endTime:this.endTime,projectDeadline:this.projectDeadline};this.endTime=t;const l=new J(s);return this.parent.add(l),l}}const ne=new Date().setHours(0,0,0,0),$=j(200),f=a=>(a-ne)/N*$.value,z=a=>+a/$.value*N+ne,X=a=>y.limitStep?Math.round(a/le)*le:a,M=()=>y.limitStep?new Array(60).fill(0).map((a,e)=>e):[],he=()=>{const a=[],e=z(Math.floor(g.value/$.value)*$.value),t=z(g.value+y.viewBoxWidth),s=Math.ceil((t-e)/N);a[0]=new R({id:Math.random(),name:"年月"}),a[1]=new R({id:Math.random(),name:"天"}),a[2]=new R({id:Math.random(),name:"时"});let l=new Date(0),m=new Date(e);for(let w=1;w<=s;w++){const _=new Date(e+w*N),F=m.getDate();a[2].add(new q({id:Math.random(),name:"",startTime:m.getTime(),endTime:_.getTime()})),a[1].add(new q({id:Math.random(),name:F,startTime:m.getTime(),endTime:_.getTime()}));const Ee=l.getMonth(),Ie=m.getFullYear(),se=m.getMonth();a[0].children.length===0||Ee!==se?a[0].add(new q({id:Math.random(),name:`${Ie}-${se+1}`,startTime:m.getTime(),endTime:_.getTime()})):a[0].children.at(-1).endTime=_.getTime(),l=m,m=_}return a},S=ie(()=>he()),k=j([]);Be(()=>{const a=y.linesData.map(e=>{const t=new R(e);return y.plansData.filter(s=>s.lineId===e.id).map(s=>new J(s)).forEach(s=>t.add(s)),t});k.value=a});const pe=a=>{const e=g.value,t=a.x,s=m=>{g.value=e-(m.x-t)},l=()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",l)},x=re({time:0,title:"",visible:!1,slice:!1}),xe=a=>{const{offsetX:e}=a,t=e+g.value,s=X(z(t));x.time=s,x.title=new Date(s).toLocaleString()},we=a=>{const e=Math.sign(a.deltaY);let t=1;e==1?t=2/3:e==-1&&(t=3/2);const s=f(x.time)-g.value;$.value*=t,g.value=f(x.time)-s},n=j(),O=j(!1),ye=a=>{O.value&&a.add(n.value)},ge=(a,e)=>{if(a.button!==0)return;if(x.slice)return De(e);const{startTime:t,endTime:s}=e,l=z(a.x);n.value=e;const m=_=>{if(_.movementX==0&&_.movementY==0)return;const F=z(_.x)-l;Math.abs(F)<le/3||(O.value=!0,e.startTime=X(t+F),e.endTime=X(s+F))},w=()=>{O.value&&B("editPlan",e),n.value=null,O.value=!1,b.visible=!1,document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",w)};document.addEventListener("mousemove",m),document.addEventListener("mouseup",w)},Te=(a,e)=>{const{endTime:t}=e,s=X(z(a.x)),l=w=>{const _=z(w.x)-s;e.endTime=X(t+_)},m=()=>{B("editPlan",e),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",m)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",m)},b=re({visible:!1,x:0,y:0}),ee=j(),be=(a,e)=>{b.visible=!0,{offsetX:b.x,offsetY:b.y}=a,n.value=e;const t=s=>{var l;ee.value===s.target||((l=ee.value)==null?void 0:l.compareDocumentPosition(s.target))&Node.DOCUMENT_POSITION_CONTAINED_BY||(n.value=null,b.visible=!1,document.removeEventListener("mousedown",t))};document.addEventListener("mousedown",t)},_e=()=>{x.slice=!0,b.visible=!1},De=a=>{const e=a.slice(x.time);x.slice=!1,B("slicePlan",[a,e])},Pe=()=>{var a;n.value&&((a=n.value.parent)==null||a.remove(n.value),B("deletePlan",n.value),b.visible=!1,oe())},C=j(!1),ke=()=>{C.value=!C.value;const a=new J({id:Math.random(),name:"新计划",startTime:Date.now(),endTime:Date.now()+N,lineId:null,projectId:Math.random(),projectName:"新项目",projectDeadline:Date.now()+N});n.value=a},je=()=>{var a;n.value.lineId&&((a=k.value.find(e=>e.id==n.value.lineId))==null||a.add(n.value),V.value.push({id:n.value.projectId,name:n.value.projectName,deadline:n.value.projectDeadline,color:H[L]}),L=(L+1)%H.length,C.value=!1,B("createPlan",n.value))},oe=()=>{G.value=!1,C.value=!1,n.value=null,O.value=!1,x.slice=!1};return Ce(()=>{document.addEventListener("pointerdown",oe)}),(a,e)=>(d(),c("div",Ye,[u("div",Ge,[u("div",{class:"names-top",style:de({height:`${v.value*S.value.length}px`}),onPointerdown:e[6]||(e[6]=A(()=>{},["stop"]))},[i(o(ae),{visible:G.value,teleported:!1,width:"unset",placement:"right-start"},{reference:r(()=>[i(o(Q),{type:"primary",size:"small",onClick:e[0]||(e[0]=t=>G.value=!G.value)},{default:r(()=>[Y(" 项目图例 ")]),_:1})]),default:r(()=>[i(o(te),null,{default:r(()=>[(d(!0),c(E,null,I(V.value,t=>(d(),W(o(T),{key:t.id,label:t.name},{default:r(()=>[i(o(Xe),{modelValue:t.color,"onUpdate:modelValue":s=>t.color=s,size:"small",teleported:!1},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["visible"]),i(o(ae),{visible:C.value,teleported:!1,width:"260px",placement:"right-start"},{reference:r(()=>[i(o(Q),{style:{margin:"10px 0"},type:"primary",size:"small",onPointerdown:ke},{default:r(()=>[Y(" 新增项目 ")]),_:1})]),default:r(()=>[C.value&&n.value?(d(),W(o(te),{key:0,"label-width":"80px"},{default:r(()=>[i(o(T),{label:"项目名"},{default:r(()=>[i(o(Z),{modelValue:n.value.projectName,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.projectName=t),size:"small"},null,8,["modelValue"])]),_:1}),i(o(T),{label:"线"},{default:r(()=>[i(o(ue),{modelValue:n.value.lineId,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.lineId=t),teleported:!1},{default:r(()=>[(d(!0),c(E,null,I(k.value,t=>(d(),W(o(me),{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(o(T),{label:"计划名"},{default:r(()=>[i(o(Z),{modelValue:n.value.name,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.name=t),size:"small"},null,8,["modelValue"])]),_:1}),i(o(T),{label:"开始时间"},{default:r(()=>[i(o(K),{modelValue:n.value.startTime,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.startTime=t),type:"datetime",size:"small",clearable:!1,"value-format":"x","disabled-minutes":M,"disabled-seconds":M,teleported:!1},null,8,["modelValue"])]),_:1}),i(o(T),{label:"结束时间"},{default:r(()=>[i(o(K),{"model-value":n.value.endTime,type:"datetime",size:"small",clearable:!1,"value-format":"x","disabled-minutes":M,"disabled-seconds":M,teleported:!1,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.endTime=n.value.projectDeadline=t)},null,8,["model-value"])]),_:1}),i(o(T),null,{default:r(()=>[i(o(Q),{style:{margin:"10px 0"},type:"warning",size:"small",onPointerdown:je},{default:r(()=>[Y(" 确定 ")]),_:1})]),_:1})]),_:1})):U("",!0)]),_:1},8,["visible"])],36),(d(!0),c(E,null,I(h.linesData,t=>(d(),c("div",{key:t.id,class:"item-name"},[i(o(Fe),{content:t.name},{default:r(()=>[i(o(Oe),{type:"info",truncated:""},{default:r(()=>[Y(D(t.name),1)]),_:2},1024)]),_:2},1032,["content"])]))),128))]),u("div",He,[(d(),c("svg",{style:{display:"block"},width:h.viewBoxWidth,height:`${v.value*(S.value.length+k.value.length)}px`,viewBox:`${g.value} 0 ${h.viewBoxWidth} ${v.value*(S.value.length+k.value.length)}`,xmlns:"http://www.w3.org/2000/svg",onPointerdown:pe,onPointermove:xe,onWheel:we,onPointerenter:e[7]||(e[7]=t=>x.visible=!0),onPointerleave:e[8]||(e[8]=t=>x.visible=!1)},[qe,(d(!0),c(E,null,I(S.value,(t,s)=>(d(),c("g",{key:t.id,transform:`translate(0 ${v.value*s})`},[u("line",{x1:g.value,y1:v.value,x2:g.value+h.viewBoxWidth,y2:v.value,stroke:"#adf"},null,8,Ke),(d(!0),c(E,null,I(t.children,l=>(d(),c("g",{key:l.id,transform:`translate(${f(l.startTime)} 0)`},[t.name=="年月"||$.value>12?(d(),c("g",Ze,[u("title",null,D(l.name),1),u("rect",{class:Ue({"project-node":l.isPlanNode}),x:"0",y:"0",width:Math.abs(f(l.endTime)-f(l.startTime)),height:v.value,fill:"#fafdff",stroke:"rgb(0 0 0 / 0.05)"},null,10,et),u("text",{x:Math.abs(f(l.endTime)-f(l.startTime))/2,y:v.value/2,"text-anchor":"middle","dominant-baseline":"middle","font-size":12,fill:"#9ab",style:{"user-select":"none"}},D(l.name),9,tt)])):U("",!0),t.name=="时"&&$.value>20?(d(),c("g",at,[(d(),c(E,null,I(24,m=>u("line",{key:m,x1:Math.abs(f(l.endTime)-f(l.startTime))/24*m,y1:"0",x2:Math.abs(f(l.endTime)-f(l.startTime))/24*m,y2:m%10===0?v.value/2:v.value/3,stroke:m%10===0?"#ccc":"#ddd"},null,8,lt)),64))])):U("",!0)],8,Qe))),128))],8,Je))),128)),(d(!0),c(E,null,I(k.value,(t,s)=>(d(),c("g",{key:t.id,class:"project-node",transform:`translate(0 ${v.value*(s+S.value.length)})`,onPointerenter:l=>ye(t)},[u("line",{x1:g.value,y1:"0",x2:g.value+h.viewBoxWidth,y2:"0",stroke:"#eee"},null,8,ot),u("rect",{x:g.value,y:"0",width:h.viewBoxWidth,height:v.value,fill:"transparent"},null,8,st),(d(!0),c(E,null,I(t.children,l=>{var m;return d(),c("g",{key:l.id,transform:`translate(${f(l.startTime)} 0)`,onPointerdown:A(w=>ge(w,l),["stop"]),onContextmenu:A(w=>be(w,l),["stop","prevent"])},[u("title",null,D(l.projectName)+" "+D(l.name),1),u("rect",{x:"0",y:v.value*.1,rx:"8",width:Math.abs(f(l.endTime)-f(l.startTime)),height:v.value*.8,fill:(m=V.value.find(w=>w.id===l.projectId))==null?void 0:m.color,stroke:"rgb(0 0 0 / 0.05)",opacity:"0.6"},null,8,rt),u("text",{x:"5",y:v.value/2,"text-anchor":"start","dominant-baseline":"middle","font-size":13,fill:"#fff",filter:"url(#shadow)",stroke:"rgb(0 0 0 / 0.1)","paint-order":"stroke",style:{"user-select":"none"},draggable:"false"},D(l.projectName)+" "+D(l.name),9,dt),u("line",{x1:Math.abs(f(l.endTime)-f(l.startTime)),y1:"0",x2:Math.abs(f(l.endTime)-f(l.startTime)),y2:v.value,stroke:"transparent","stroke-width":"5",style:{cursor:"ew-resize"},onPointerdown:A(w=>Te(w,l),["stop"])},null,40,ut)],40,it)}),128))],40,nt))),128)),(d(!0),c(E,null,I(V.value,t=>(d(),c("g",{key:t.id,transform:`translate(${f(t.deadline)}, 0)`},[u("line",{x1:"0",y1:"0",x2:0,y2:`${v.value*(S.value.length+k.value.length)}`,stroke:t.color},null,8,ct),u("rect",{x:"0",y:"0",width:"120",height:"30",fill:t.color},null,8,vt),u("text",{x:"5",y:v.value/2,"text-anchor":"start","dominant-baseline":"middle","font-size":12,fill:"#059",style:{"user-select":"none"},draggable:"false"},D(new Date(t.deadline).toLocaleString()),9,ft),u("title",null,D(t.name)+"截止时间："+D(new Date(t.deadline).toLocaleString()),1)],8,mt))),128)),x.visible?(d(),c("g",{key:0,transform:`translate(${f(x.time)}, 0)`,style:{"pointer-events":"none"}},[u("line",{x1:"0",y1:"0",x2:0,y2:`${v.value*(S.value.length+k.value.length)}`,stroke:x.slice?"#fda":"#adf","stroke-dasharray":"5,5"},null,8,pt),u("rect",{x:"0",y:"0",width:"120",height:"30",fill:x.slice?"#fda":"#adf"},null,8,xt),u("text",{x:"5",y:v.value/2,"text-anchor":"start","dominant-baseline":"middle","font-size":12,fill:"#059",style:{"user-select":"none"},draggable:"false"},D(x.title),9,wt)],8,ht)):U("",!0)],40,Re)),b.visible?(d(),c("menu",{key:0,ref_key:"menuRef",ref:ee,style:de({left:`${b.x}px`,top:`${b.y}px`}),class:"contextmenu",onPointerdown:e[16]||(e[16]=A(()=>{},["stop"]))},[u("li",{class:"menu-item",onPointerdown:_e},"切片",32),u("li",yt,[i(o(ae),{trigger:"click",teleported:!1,width:"260px"},{reference:r(()=>[gt]),default:r(()=>[n.value?(d(),W(o(te),{key:0,"label-width":"80px"},{default:r(()=>[i(o(T),{label:"项目名"},{default:r(()=>[i(o(Z),{modelValue:n.value.projectName,"onUpdate:modelValue":e[9]||(e[9]=t=>n.value.projectName=t),disabled:"",size:"small"},null,8,["modelValue"])]),_:1}),i(o(T),{label:"线"},{default:r(()=>[i(o(ue),{modelValue:n.value.lineId,"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.lineId=t),teleported:!1,onChange:e[11]||(e[11]=t=>{var s;return(s=k.value.find(l=>l.id==t))==null?void 0:s.add(n.value)})},{default:r(()=>[(d(!0),c(E,null,I(k.value,t=>(d(),W(o(me),{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(o(T),{label:"计划名"},{default:r(()=>[i(o(Z),{modelValue:n.value.name,"onUpdate:modelValue":e[12]||(e[12]=t=>n.value.name=t),size:"small"},null,8,["modelValue"])]),_:1}),i(o(T),{label:"开始时间"},{default:r(()=>[i(o(K),{modelValue:n.value.startTime,"onUpdate:modelValue":e[13]||(e[13]=t=>n.value.startTime=t),type:"datetime",size:"small",clearable:!1,"value-format":"x","disabled-minutes":M,"disabled-seconds":M,teleported:!1},null,8,["modelValue"])]),_:1}),i(o(T),{label:"结束时间"},{default:r(()=>[i(o(K),{modelValue:n.value.endTime,"onUpdate:modelValue":e[14]||(e[14]=t=>n.value.endTime=t),type:"datetime",size:"small",clearable:!1,"value-format":"x",teleported:!1,"disabled-minutes":M,"disabled-seconds":M},null,8,["modelValue"])]),_:1}),i(o(T),null,{default:r(()=>[i(o(Q),{style:{margin:"10px 0"},type:"warning",size:"small",onPointerdown:e[15]||(e[15]=()=>{b.visible=!1,B("editPlan",n.value)})},{default:r(()=>[Y(" 确定 ")]),_:1})]),_:1})]),_:1})):U("",!0)]),_:1})]),u("li",{class:"menu-item",onPointerdown:Pe},"删除",32)],36)):U("",!0)])]))}}),bt=Ae(Tt,[["__scopeId","data-v-8ce63f22"]]),Ft=ce({__name:"GanttChart",setup(h){return Le.extend($e),(P,y)=>(d(),W(bt,{viewBoxWidth:1200}))}});export{Ft as default};
