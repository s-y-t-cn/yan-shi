import{d as E,r as f,I as w,k as y,w as l,L as V,a5 as v,c as x,M as t,g,O as P}from"./index-B2ff-rFN.js";/* empty css                     *//* empty css                  */import{u as F}from"./index-CDp5nt-z.js";import{r as b}from"./auth-CtID0RP3.js";import{f as M}from"./permission-CAa-2GWk.js";import{u as U}from"./menus-B2ciZQin.js";import{h}from"./index-DIjjrsno.js";import{a as C,E as R}from"./index-BIK7ipUj.js";import{E as S}from"./index-Bfj94Vt0.js";import{E as k}from"./index-CQNAlFu8.js";import{f as q}from"./index-CvnddM-F.js";const G=E({__name:"Regist",setup(B){const _=v(),p=f();let n=f(!1);const o=w({username:"",password:"",repeatPassword:"",verifyCode:""}),c=w({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,validator:(u,e,r)=>{e===""?r(new Error("请输入密码")):/^(?=.*\d)(?=.*[A-Za-z]).{6,}$/.test(e)?r():r(new Error("密码最少6位并包含字母和数字"))},trigger:"blur"}],repeatPassword:[{required:!0,validator:(u,e,r)=>{e===""?r(new Error("请输入确认密码")):e!=o.password?r(new Error("两次密码不一致")):r()},trigger:"blur"}]}),m=u=>{u&&(n.value=!0,u.validate(async e=>{if(e){let r=Object.assign({},o);Reflect.deleteProperty(r,"repeatPassword"),r.password=await h(r.password),b(r).then(async s=>{if(s.code===200){const i=s.data;F().login(i),await M().then(d=>{d.code===200&&U().SAVE_MENUS(d.data)}),S({type:"success",message:"注册成功"}),_.push("/")}else n.value=!1})}else n.value=!1,console.log("验证失败!")}))};return(u,e)=>{const r=k,s=R,i=q,d=C;return x(),y(d,{ref_key:"ruleFormRef",ref:p,model:o,rules:c,size:"large",class:"w-full",onKeydown:e[4]||(e[4]=V(a=>m(p.value),["enter"]))},{default:l(()=>[t(s,{prop:"username"},{default:l(()=>[t(r,{modelValue:o.username,"onUpdate:modelValue":e[0]||(e[0]=a=>o.username=a),placeholder:"用户名","prefix-icon":"user"},null,8,["modelValue"])]),_:1}),t(s,{prop:"password"},{default:l(()=>[t(r,{modelValue:o.password,"onUpdate:modelValue":e[1]||(e[1]=a=>o.password=a),type:"password",placeholder:"密码","prefix-icon":"lock","show-password":""},null,8,["modelValue"])]),_:1}),t(s,{prop:"repeatPassword"},{default:l(()=>[t(r,{modelValue:o.repeatPassword,"onUpdate:modelValue":e[2]||(e[2]=a=>o.repeatPassword=a),type:"password",placeholder:"确认密码","prefix-icon":"lock","show-password":""},null,8,["modelValue"])]),_:1}),t(s,null,{default:l(()=>[t(i,{class:"w-full",type:"primary",loading:g(n),disabled:g(n),onClick:e[3]||(e[3]=a=>m(p.value))},{default:l(()=>[P(" 注册 ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model","rules"])}}});export{G as _};
