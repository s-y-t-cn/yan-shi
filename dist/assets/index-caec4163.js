import{d as z,f as p,g as b,j as B,w as s,c as w,h as O,F as R,r as i,D as q,G as K,b as u,A as L,u as t,H as M,i as I,I as j,_ as Q,J as W,e as N,E as h,K as X}from"./index-92e8b837.js";import{r as T}from"./index-c4fad515.js";const Y=()=>T({url:"/findUsers",method:"GET"}),Z=d=>T({url:"/insertUser",method:"POST",data:d}),ee=d=>T({url:"/updateUser",method:"POST",data:d}),te=d=>T({url:"/deleteUser",method:"POST",data:d}),le=z({props:{thData:{type:Object}},setup(d){return(k,g)=>{const _=p("el-table-column"),C=p("SytTableColumn",!0);return d.thData.children?(b(),B(_,{key:1,label:d.thData.title,align:"center"},{default:s(()=>[(b(!0),w(R,null,O(d.thData.children,r=>(b(),B(C,{key:r.dataIndex,"th-data":r},null,8,["th-data"]))),128))]),_:1},8,["label"])):(b(),B(_,{key:0,prop:d.thData.dataIndex,label:d.thData.title,align:"center",sortable:"custom"},null,8,["prop","label"]))}}}),ue=z({props:{columns:{type:Array,default:()=>[]},data:{type:Array,default:()=>[]},selection:{type:Boolean,default:!1}},emits:["selection-alter"],setup(d,{emit:k}){const g=d;let _=i(),C=q(()=>g.columns),r=i([]),V=i(""),v=i(""),U=({prop:o,order:m})=>{V.value=o,v.value=m,m==="ascending"&&r.value.sort((f,D)=>f[o]<D[o]?1:f[o]>D[o]?-1:0),m==="descending"&&r.value.sort((f,D)=>f[o]<D[o]?-1:f[o]>D[o]?1:0)};K(()=>{r.value=j(g.data),U({prop:V.value,order:v.value})});let F=i(10),n=i(1),x=q(()=>{let o=(n.value-1)*F.value,m=o+F.value;return r.value.slice(o,m)});const A=o=>{k("selection-alter",o)};return(o,m)=>{const f=p("el-table-column"),D=p("el-table"),S=p("el-pagination");return b(),w("div",null,[u(D,{ref_key:"tableRef",ref:_,data:t(x),"row-key":"_id",onSortChange:t(U),onSelectionChange:A,"max-height":"80%",border:"",stripe:""},{default:s(()=>[d.selection?(b(),B(f,{key:0,type:"selection","reserve-selection":"",width:55})):L("",!0),(b(!0),w(R,null,O(t(C),l=>(b(),B(le,{key:l.dataIndex,"th-data":l},null,8,["th-data"]))),128)),u(f,{label:"操作",align:"center",fixed:"right",width:100},{default:s(({row:l,column:e,$index:c})=>[M(o.$slots,"operations",{row:l,column:e,$index:c})]),_:3})]),_:3},8,["data","onSortChange"]),u(S,{small:"",background:"","page-size":t(F),"onUpdate:page-size":m[0]||(m[0]=l=>I(F)?F.value=l:F=l),"current-page":t(n),"onUpdate:current-page":m[1]||(m[1]=l=>I(n)?n.value=l:n=l),layout:"total, sizes, prev, pager, next, jumper",total:t(r).length,"page-sizes":[10,20,30,40,50,100]},null,8,["page-size","current-page","total"])])}}});const ae={"element-loading-text":"加载中..."},ne=N("添加账号"),oe=N(" 保存 "),re=z({setup(d){let k=i([{title:"用户名",dataIndex:"username"},{title:"角色",dataIndex:"role"},{title:"昵称",dataIndex:"nickname"},{title:"部门",dataIndex:"department"},{title:"职位",dataIndex:"position"}]),g=i(""),_=i([]),C=i(!0),r=i(!1),V=i(null),v=i("");const U=i({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],role:[{required:!0,message:"请输入角色",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],department:[{required:!0,message:"请输入部门",trigger:"blur"}],position:[{required:!0,message:"请输入职位",trigger:"blur"}]});let F=()=>({username:"",password:"123456",nickname:"",role:"role-1",department:"软件部",position:"职员"}),n=i(F());const x=()=>{Y().then(l=>{l.code===200&&(_.value=l.data)}),C.value=!1};x();const A=()=>{v.value="添加账号",r.value=!0,n.value=F()},o=l=>{v.value="编辑账号",r.value=!0,n.value=j(l)},m=()=>{let l=Object.assign({},n.value);Z(l).then(e=>{e.code!==200?h({type:"error",message:e.message}):(h({type:"success",message:"添加成功"}),x())})},f=()=>{let l=Object.assign({},n.value);ee(l).then(e=>{e.code!==200?h({type:"error",message:e.message}):(x(),h({type:"success",message:"编辑成功"}))})},D=l=>{l._id?te({_id:l._id}).then(e=>{e.code==200?(_.value.splice(_.value.findIndex(c=>c._id===l._id),1),h({type:"success",message:"删除成功"})):h({type:"error",message:e.message})}):h({type:"error",message:"不存在的_id"})},S=l=>{l&&l.validate(e=>{if(e)v.value==="添加账号"?m():f(),r.value=!1;else return console.log("验证失败!"),!1})};return(l,e)=>{const c=p("el-input"),E=p("el-button"),P=p("el-popconfirm"),y=p("el-form-item"),$=p("el-form"),G=p("el-dialog"),H=X("loading");return W((b(),w("div",ae,[u(c,{modelValue:t(g),"onUpdate:modelValue":e[0]||(e[0]=a=>I(g)?g.value=a:g=a),placeholder:"输入账号查询",class:"search",clearable:""},null,8,["modelValue"]),u(E,{onClick:A},{default:s(()=>[ne]),_:1}),u(ue,{columns:t(k),data:t(_).filter(a=>a.username.includes(t(g)))},{operations:s(a=>[u(E,{size:"small",type:"primary",onClick:J=>o(a.row),icon:"Edit",circle:""},null,8,["onClick"]),u(P,{title:`确定删除 ${a.row.username} 账号?`,"confirm-button-text":"确定","cancel-button-text":"取消",icon:"InfoFilled","icon-color":"var(--el-color-warning)",onConfirm:J=>D(a.row)},{reference:s(()=>[u(E,{size:"small",type:"danger",icon:"Delete",circle:""})]),_:2},1032,["title","onConfirm"])]),_:1},8,["columns","data"]),u(G,{modelValue:t(r),"onUpdate:modelValue":e[8]||(e[8]=a=>I(r)?r.value=a:r=a),title:t(v)},{default:s(()=>[u($,{ref_key:"ruleFormRef",ref:V,model:t(n),rules:U.value,size:"large",class:"w-full"},{default:s(()=>[u(y,{label:"账号",prop:"username"},{default:s(()=>[u(c,{modelValue:t(n).username,"onUpdate:modelValue":e[1]||(e[1]=a=>t(n).username=a),placeholder:"用户名","prefix-icon":"user",disabled:t(v)=="编辑账号"},null,8,["modelValue","disabled"])]),_:1}),u(y,{label:"密码",prop:"password"},{default:s(()=>[u(c,{modelValue:t(n).password,"onUpdate:modelValue":e[2]||(e[2]=a=>t(n).password=a),placeholder:"密码","prefix-icon":"lock"},null,8,["modelValue"])]),_:1}),u(y,{label:"角色",prop:"role"},{default:s(()=>[u(c,{modelValue:t(n).role,"onUpdate:modelValue":e[3]||(e[3]=a=>t(n).role=a),placeholder:"角色"},null,8,["modelValue"])]),_:1}),u(y,{label:"昵称",prop:"nickname"},{default:s(()=>[u(c,{modelValue:t(n).nickname,"onUpdate:modelValue":e[4]||(e[4]=a=>t(n).nickname=a),placeholder:"昵称"},null,8,["modelValue"])]),_:1}),u(y,{label:"部门",prop:"department"},{default:s(()=>[u(c,{modelValue:t(n).department,"onUpdate:modelValue":e[5]||(e[5]=a=>t(n).department=a),placeholder:"部门"},null,8,["modelValue"])]),_:1}),u(y,{label:"职位",prop:"position"},{default:s(()=>[u(c,{modelValue:t(n).position,"onUpdate:modelValue":e[6]||(e[6]=a=>t(n).position=a),placeholder:"职位"},null,8,["modelValue"])]),_:1}),u(y,null,{default:s(()=>[u(E,{class:"w-full",type:"primary",onClick:e[7]||(e[7]=a=>S(t(V)))},{default:s(()=>[oe]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])),[[H,t(C)]])}}}),ie=Q(re,[["__scopeId","data-v-4531dc09"]]);export{ie as default};
