import{d as z,r,o as Y,N as R,c as Z,e as A,k as G,C as a,w as l,aa as x,g as s,ag as H,bS as J,bY as K,aj as _,E as L,bP as Q,bR as w,bZ as W,b_ as X,b$ as ee}from"./index-g37XHkO7.js";/* empty css                   *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                       *//* empty css                    *//* empty css                 */import{E as te}from"./el-popover-tSKsVJ3k.js";/* empty css                  */import{S as ae}from"./SytTable-BQFAgx-u.js";import{E as oe}from"./index-7XQ89VVv.js";import{E as le}from"./index-CWjOxhQe.js";import{E as se,a as ne}from"./index-ekn85pdJ.js";import{a as re}from"./index-9xp24Tp6.js";import{b as ie}from"./index-CBwcHNbb.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-ClVUFy22.js";import"./error-C6KkHRRa.js";import"./index-Di-CCxpl.js";import"./index-Cq1NGWuE.js";import"./index-Ct0d8tij.js";import"./castArray-D6nup7xA.js";import"./isEqual-sIzh-_wJ.js";import"./index-B--V0hz4.js";import"./_baseClone-YGkPyP1V.js";import"./index-vz8m2Jyi.js";import"./vnode-DwFJRcHj.js";const de={class:"container"},ue={class:"tools"},pe=z({__name:"Roles",setup(ce){const C=r([{title:"角色名",dataIndex:"name"},{title:"菜单",dataIndex:"menusNames"}]);let b=r([]),g=r([]),h=r(!0),i=r(!1),y=r(null),d=r("");const k=r({name:[{required:!0,message:"请输入角色名",trigger:"blur"}],menus:[{required:!0,message:"请选择菜单",trigger:"change"}]});let E=()=>({name:"",pid:"",menus:[]}),n=r(E());const V=r([]),T=async()=>{await Q().then(t=>{t.code===200&&(b.value=t.data,V.value=w(t.data))})},I=async()=>{await W().then(t=>{t.code===200&&(t.data.forEach(e=>{e.menusNames=e.menus.map(p=>{var c,m;return(m=(c=b.value.find(v=>p==v.id))==null?void 0:c.meta)==null?void 0:m.title})}),g.value=w(t.data))})},u=async()=>{await T(),await I(),h.value=!1},B=()=>{d.value="添加",i.value=!0,n.value=E()},F=t=>{d.value="编辑",i.value=!0,n.value=J(t)},N=async()=>{let t=Object.assign({},n.value);X(t).then(e=>{e.code==200&&(_({type:"success",message:"添加成功"}),u())})},M=async()=>{let t=Object.assign({},n.value);ee(t).then(e=>{e.code==200&&(_({type:"success",message:"编辑成功"}),u())})},S=t=>{t.id?K({id:t.id}).then(e=>{e.code==200&&(_({type:"success",message:"删除成功"}),u())}):_({type:"error",message:"不存在的id"})},U=t=>{t&&t.validate(e=>{e?(d.value==="添加"?N():M(),i.value=!1):console.log("验证失败!")})};return Y(()=>{u()}),(t,e)=>{const p=oe,c=R("Edit"),m=L,v=R("Delete"),j=te,O=le,f=se,D=re,$=ne,q=ie;return Z(),A("div",de,[G("div",ue,[a(p,{onClick:B},{default:l(()=>[x("添加角色")]),_:1})]),a(ae,{columns:C.value,data:s(g)},{operations:l(({row:o})=>[a(m,{class:"icon",color:"#0af",onClick:P=>F(o)},{default:l(()=>[a(c)]),_:2},1032,["onClick"]),a(j,{title:"确定删除?",onConfirm:P=>S(o)},{reference:l(()=>[a(m,{class:"icon",color:"#f00"},{default:l(()=>[a(v)]),_:1})]),_:2},1032,["onConfirm"])]),_:1},8,["columns","data"]),a(q,{modelValue:s(i),"onUpdate:modelValue":e[4]||(e[4]=o=>H(i)?i.value=o:i=o),title:s(d),width:"350px"},{default:l(()=>[a($,{ref_key:"ruleFormRef",ref:y,model:s(n),rules:k.value,size:"large",class:"w-full","label-width":"auto"},{default:l(()=>[a(f,{label:"角色名",prop:"name"},{default:l(()=>[a(O,{modelValue:s(n).name,"onUpdate:modelValue":e[0]||(e[0]=o=>s(n).name=o),placeholder:"角色名",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),a(f,{label:"权限菜单",prop:"menus"},{default:l(()=>[a(D,{modelValue:s(n).menus,"onUpdate:modelValue":e[1]||(e[1]=o=>s(n).menus=o),data:V.value,props:{label:o=>o.meta.title,value:"id"},"check-strictly":"",multiple:"","render-after-expand":!1,style:{width:"240px"}},null,8,["modelValue","data","props"])]),_:1}),a(f,{label:"上级角色"},{default:l(()=>[a(D,{modelValue:s(n).pid,"onUpdate:modelValue":e[2]||(e[2]=o=>s(n).pid=o),data:s(g),props:{label:"name",value:"id"},"check-strictly":"","render-after-expand":!1,clearable:"",style:{width:"240px"}},null,8,["modelValue","data"])]),_:1}),a(f,null,{default:l(()=>[a(p,{class:"w-full",type:"primary",onClick:e[3]||(e[3]=o=>U(s(y)))},{default:l(()=>[x(" 保存 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Ye=me(pe,[["__scopeId","data-v-c8352330"]]);export{Ye as default};
