import{d as A,r as E,y as G,z as H,c as h,k as I,w as p,M as v,j as b,t as x,g as c,e as O,H as V,G as B,O as M,a8 as W,a9 as $}from"./index-3lwVo2y0.js";import{E as q}from"./el-space-nclD-xc-.js";/* empty css                  */import{E as K,a as Q}from"./el-timeline-item-CA3VQ1k4.js";import{E as X}from"./el-card-DsiDhd6c.js";/* empty css                     */import{h as Y,j as Z}from"./examples-qXBsSl1_.js";import{u as ee}from"./index-F5rh05N7.js";import{S as te}from"./SytPreviewItem-DkL6L2Rj.js";import{a as ae}from"./index-kL61-N24.js";import{f as oe}from"./index-DlwHQsx5.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vnode-mNfM4dg-.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./index-BWwQj9eg.js";import"./index-qESz8UqH.js";import"./typescript-gghwE45V.js";import"./index-sCpGYuuU.js";import"./el-tag-Dx9-JzTw.js";import"./el-checkbox-s_GngyB_.js";import"./_Uint8Array-DyXCWp4w.js";import"./isEqual-DSxYV8To.js";import"./index-Wki9wfLK.js";import"./focus-trap-BjQrKON9.js";import"./scroll-BTBHWhC0.js";import"./castArray-Br8Ioqbo.js";import"./el-radio-BEwXQFWd.js";import"./index-dhLKrPE9.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-BbsUdgo6.js";import"./index-DyexuUs5.js";import"./_baseClone-BmgoMR3V.js";const le=_=>(W("data-v-56e97eab"),_=_(),$(),_),ie=le(()=>b("span",null,"流程",-1)),ne=A({__name:"EditSubmit",props:{data:{type:Object,default(){return{name:"",formData:[],flowData:{nodesData:[],linesData:[]}}}}},emits:["submit"],setup(_,{emit:C}){const w=ee(),J=_,T=C;let s=E({name:"",formData:[],flowData:{nodesData:[],linesData:[]}});G(()=>JSON.parse(JSON.stringify(J.data)),t=>{s.value=t},{deep:!0,immediate:!0});const j=t=>{for(let a of s.value.formData)if(a.type==="layout"){for(let r of a.cols)for(let e of r.children)if(t===e.field)return e}else if(t===a.field)return a};let g=H(()=>U(s.value)),F=E({label:"部门主管",value:"部门主管"});Y().then(t=>{var a;F.value=(a=t.data.find(r=>r.value==w.department))==null?void 0:a.children.find(r=>r.label.includes("主管"))});const U=t=>{var u;let a=[],r={id:"",type:""},{nodesData:e,linesData:d}=t.flowData,n=r=e.find(o=>o.type==="start");if(!n)return[];for(n.color="#00aabb",a.push(n);d.find(o=>o.fromId===r.id);){let o={id:""},l=d.filter(i=>i.fromId===r.id);if(r.type=="condition"){let i=l.findIndex(D=>D.text==="是"),m=l.findIndex(D=>D.text==="否"),f=i,{field:R,comparison:z,value:k}=r.properties,y=j(R);if(y)switch(z){case"小于":y.value<k?f=i:f=m;break;case"等于":y.value===k?f=i:f=m;break;case"大于":y.value>k?f=i:f=m;break}o=e.find(D=>{var N;return D.id===((N=l[f])==null?void 0:N.toId)})}else o=e.find(i=>{var m;return i.id===((m=l[0])==null?void 0:m.toId)}),(o==null?void 0:o.type)=="handle"&&((u=o.properties)==null?void 0:u.value)=="部门主管"&&(o.properties=F.value);(o==null?void 0:o.type)!="condition"&&a.push(o),r=o}return a},S=E(),L=()=>{let t=new FormData;t.append("name",s.value.name),t.append("submitter",JSON.stringify({username:w.username,nickname:w.nickname}));let a={};s.value.formData.forEach(e=>{e.type==="img-upload"?e.value.forEach(d=>t.append(e.field,d)):e.type==="layout"?e.cols.forEach(d=>{d.children.forEach(n=>{n.type==="img-upload"?n.value.forEach(u=>t.append(n.field,u)):a[n.field]=n.value})}):a[e.field]=e.value}),t.append("formData",JSON.stringify(a));let r=g.value.filter(e=>e.type==="handle").map(e=>({id:e.id,type:e.text,label:e.properties.label,username:e.properties.value,status:"未处理"}));return t.append("flowData",JSON.stringify(r)),t},P=t=>{if(!t)return!1;t.validate(a=>{if(a)Z(L()).then(()=>T("submit"));else return!1})};return(t,a)=>{const r=ae,e=X,d=Q,n=K,u=oe,o=q;return h(),I(o,{direction:"vertical",fill:"",class:"submit-container"},{default:p(()=>[v(e,null,{header:p(()=>[b("h1",null,x(c(s).name),1)]),default:p(()=>[v(r,{ref_key:"ruleFormRef",ref:S,model:c(s).formData},{default:p(()=>[(h(!0),O(B,null,V(c(s).formData,(l,i)=>(h(),I(te,{key:l.field,modelValue:c(s).formData[i],"onUpdate:modelValue":m=>c(s).formData[i]=m,index:i.toString(),"rule-form-ref":S.value,onCascaderFetch:m=>l.options=m},null,8,["modelValue","onUpdate:modelValue","index","rule-form-ref","onCascaderFetch"]))),128))]),_:1},8,["model"])]),_:1}),v(e,null,{header:p(()=>[ie]),default:p(()=>[v(n,null,{default:p(()=>[(h(!0),O(B,null,V(c(g),l=>(h(),I(d,{key:l.id,icon:l.icon,color:l.color,timestamp:l.timestamp},{default:p(()=>{var i;return[b("div",null,x(l.text),1),b("div",null,x((i=l.properties)==null?void 0:i.label),1)]}),_:2},1032,["icon","color","timestamp"]))),128))]),_:1}),v(u,{type:"primary",onClick:a[0]||(a[0]=l=>P(S.value))},{default:p(()=>[M("提交")]),_:1})]),_:1})]),_:1})}}}),Re=re(ne,[["__scopeId","data-v-56e97eab"]]);export{Re as default};
