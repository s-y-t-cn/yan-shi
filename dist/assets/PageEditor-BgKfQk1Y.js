import{d as G,aD as ge,aE as ye,c as re,e as ue,D as o,w as Z,g as j,aF as we,E as T,k as ee,f as ae,n as _e,z as be,aq as xe,r as g,y as ce,o as $e,ac as H,Y as Me,ap as W,aG as Re,az as Ce,aB as Le,aH as Ee,aI as Ne,N as Pe,a3 as V,U as ze,ah as Se,am as ke,an as Ye}from"./index-B_ZJlzGL.js";import{E as Ie}from"./el-card-8P3sCtdk.js";import{a as Xe}from"./index-TXtwhKK1.js";import{s as D,f as K,t as ie,m as De,N as ve,a as Ae,d as pe,u as Ve,E as He,b as ne,U as Be,e as Fe,c as fe}from"./animation-DdT18_uv.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as se}from"./index-9aEKxBXi.js";import{b as Te}from"./index-DMy1G94c.js";import"./error-BJ0obFE8.js";import"./index-BBE6lv8d.js";import"./index-BU1K9O-H.js";import"./castArray-istU0CW9.js";import"./index-Df35gMDy.js";import"./index-DhIrNDFU.js";import"./position-D1Aw7UUH.js";import"./index-Bhb0wNCv.js";import"./index-NPrhiEQX.js";import"./index-DkGcPRir.js";import"./index-DIP1PYhk.js";import"./index-hpsKijdF.js";import"./_baseClone-DJp4dWdX.js";import"./index-CT3RxB0d.js";import"./isEqual-BBTZ5Qrx.js";import"./index-5JyK2C3A.js";import"./index-ZFLvW_Yn.js";import"./index-DQbwhJou.js";import"./dropdown-B0pv4gKc.js";import"./index-DaUUvwgy.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-C8tJppOc.js";import"./index-BByvj_sx.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./vnode-BLYMqKVk.js";const We={class:"header"},je={class:"content"},Ge=G({__name:"Drawer",props:ge({width:{type:String,default:"30%"},direction:{type:String,default:"rtl"}},{modelValue:{type:Boolean,default:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const f=i,v=ye(i,"modelValue");return(a,p)=>(re(),ue("div",{class:_e(["drawer",[{hide:!v.value},f.direction]]),style:be({width:f.width})},[o(j(T),{class:"switch",size:"15",onClick:p[0]||(p[0]=c=>v.value=!v.value)},{default:Z(()=>[o(j(we))]),_:1}),ee("div",We,[ae(a.$slots,"header",{},void 0,!0)]),ee("div",je,[o(j(Xe),null,{default:Z(()=>[ae(a.$slots,"default",{},void 0,!0)]),_:3})])],6))}}),me=de(Ge,[["__scopeId","data-v-99c100d8"]]),Oe={__name:"PieMenu",props:{data:{type:Array,default(){return[{title:"菜单1",handleClick:()=>{},children:[{title:"菜单1-1",handleClick:()=>{}},{title:"菜单1-2",handleClick:()=>{}}]},{title:"菜单2",handleClick:()=>{},children:[{title:"菜单2-1",handleClick:()=>{}},{title:"菜单2-2",handleClick:()=>{}}]}]}}},emits:["click"],setup(i,{emit:f}){xe(m=>({"6f834758":j(r)}));const v=i,a=f,p=2*Math.PI;let c=g(),n=g(),_=g(80),r=ce(()=>`${_.value}px`),y=ce(()=>_.value/2),h=g(70),L=g(p);const b=new WeakMap,$=m=>{const x=!b.get(m),{level:w,index:C,pIndex:s}=m.dataset,u=s.split("-");b.set(m,x),c.value.querySelectorAll("div[data-level]").forEach(l=>{u.includes(l.dataset.index)||m===l||(l.dataset.level>Number(w)&&l.classList.remove("show"),l.classList.remove("active"),b.set(l,!1))}),x?(m.classList.add("active"),c.value.querySelectorAll(`div[data-level='${+w+1}'][data-p-index*='${C}']`).forEach(t=>t.classList.add("show"))):m.classList.remove("active")},M=()=>Math.random().toString(16).replace(".","");let R=(m,x,w)=>{const C=L.value/m.length,s=C>=p?p-.001:C,u=m.length==1?1:0;for(let d=0,l=m;d<l.length;d++){let t=y.value+h.value*x,e=d*s,N=(d+1)*s,k=t+Math.sin(e)*t,O=t-Math.cos(e)*t,U=t+Math.sin(N)*t,q=t-Math.cos(N)*t,P=document.createElement("div");P.classList.add("menu-item"),P.dataset.level=+x,P.dataset.index=M(),P.dataset.pIndex=w.dataset.pIndex?`${w.dataset.pIndex}-${w.dataset.index}`:`${w.dataset.index}`,P.style.setProperty("width",`${t*2}px`),P.style.setProperty("height",`${t*2}px`),P.style.setProperty("z-index",-x),P.style.setProperty("clip-path",`path("M ${t} ${t} L ${k} ${O} A ${t} ${t} 0 ${u} 1 ${U} ${q} z")`);const I=document.createElement("div");I.className="item-bg",x%2==0?I.classList.add("bg-even"):I.classList.add("bg-odd"),N=(d+1)*s-.01,k=t+Math.sin(e)*t,O=t-Math.cos(e)*t,U=t+Math.sin(N)*t,q=t-Math.cos(N)*t,I.style.setProperty("width",`${t*2}px`),I.style.setProperty("height",`${t*2}px`),I.style.setProperty("clip-path",`path("M ${t} ${t} L ${k} ${O} A ${t} ${t} 0 ${u} 1 ${U} ${q} z")`),P.appendChild(I);let B=(d+1/2)*s,te=t-h.value/2,X=document.createElement("div");X.style.left=t+Math.sin(B)*te+"px",X.style.top=t-Math.cos(B)*te+"px",X.style.setProperty("position","absolute"),X.style.whiteSpace="nowrap",X.style.transform=`translate(-50%, -50%) rotate(${-Math.PI/2+B}rad)`;let F=document.createElement("div"),J=B>Math.PI?Math.PI:0;F.style.transform=`rotateY(${J}rad) rotateX(${J}rad)`,F.innerText=l[d].title,X.appendChild(F),P.appendChild(X),P.addEventListener("pointerdown",()=>{var Q,A;(A=(Q=l[d]).handleClick)==null||A.call(Q),a("click",l[d].title)}),P.addEventListener("pointerdown",()=>$(P)),c.value.insertAdjacentElement("afterbegin",P),l[d].children&&R(l[d].children,x+1,P)}};const z=(m,x)=>{let w={offsetX:0,offsetY:0};const C=s=>{const u=s.clientX,d=s.clientY,{offsetX:l,offsetY:t}=w,e=m.getBoundingClientRect(),N=e.left,k=e.top,O=e.width,U=e.height,q=document.documentElement.clientWidth,P=document.documentElement.clientHeight,I=-N+l,B=-k+t,te=q-N-O+l,X=P-k-U+t,F=Q=>{let A=l+Q.clientX-u,oe=t+Q.clientY-d;A=Math.min(Math.max(A,I),te),oe=Math.min(Math.max(oe,B),X),w={offsetX:A,offsetY:oe},m&&(m.style.transform=`translate(${A}px, ${oe}px)`)},J=()=>{document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",J)};document.addEventListener("mousemove",F),document.addEventListener("mouseup",J)};x.addEventListener("mousedown",C)},S=()=>{z(c.value,n.value);const m="0",x=M();n.value.dataset.level=m,n.value.dataset.index=x,n.value.dataset.pIndex="",R(v.data,+m+1,n.value),n.value.addEventListener("pointerdown",w=>$(n.value))};return $e(()=>{S()}),(m,x)=>(re(),ue("div",{ref_key:"rongQi",ref:c,class:"rong-qi"},[ee("div",{ref_key:"center",ref:n,class:"center",draggable:"false",onDblclick:x[0]||(x[0]=w=>a("click","center"))},[ae(m.$slots,"center",{draggable:"false"},()=>[H("菜单")],!0)],544)],512))}},Ue=de(Oe,[["__scopeId","data-v-4163a80a"]]),qe="_editor_i94p9_1",Je="_container_i94p9_55",Qe="_views_i94p9_79",Y={editor:qe,container:Je,views:Qe,"views-title":"_views-title_i94p9_87","views-container":"_views-container_i94p9_95"},Ke="_controls_ogkh9_1",Ze="_button_ogkh9_95",et="_guide_ogkh9_131",E={controls:Ke,"right-resize":"_right-resize_ogkh9_41","bottom-resize":"_bottom-resize_ogkh9_59","corner-resize":"_corner-resize_ogkh9_77","button-list":"_button-list_ogkh9_95",button:Ze,guide:et,"guide-horizontal":"_guide-horizontal_ogkh9_145","guide-vertical":"_guide-vertical_ogkh9_159"};function tt(i,f,v=!0,a){let p={offsetX:0,offsetY:0};const c=n=>{const _=window.getComputedStyle(i),r=Number.parseFloat(_.getPropertyValue("left")),y=Number.parseFloat(_.getPropertyValue("top"));if(_.position!="absolute")return;p={offsetX:r,offsetY:y};const h=n.clientX,L=n.clientY,{offsetX:b,offsetY:$}=p,M=i.getBoundingClientRect(),R=M.left,z=M.top,S=M.width,m=M.height,x=document.documentElement.clientWidth,w=document.documentElement.clientHeight,C=-R+b,s=-z+$,u=x-R-S+b,d=w-z-m+$,l=e=>{let N=b+e.clientX-h,k=$+e.clientY-L;v||(N=Math.min(Math.max(N,C),u),k=Math.min(Math.max(k,s),d)),p={offsetX:N,offsetY:k},i&&(i.style.left=`${N}px`,i.style.top=`${k}px`),a==null||a(e)},t=()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",t)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",t)};return f.addEventListener("mousedown",c),()=>{f.removeEventListener("mousedown",c)}}function ot(i,f){const v=a=>{if(window.getComputedStyle(i).position=="absolute")return;i.setAttribute("draggable","true");const p=c=>{i.setAttribute("draggable","false"),document.removeEventListener("mouseup",p)};document.addEventListener("mouseup",p)};return f.addEventListener("mousedown",v),()=>{f.removeEventListener("mousedown",v)}}function le(i,f,v,a){const p=c=>{const n=window.getComputedStyle(i),_=Number.parseFloat(n.getPropertyValue("width")),r=Number.parseFloat(n.getPropertyValue("height")),y=c.clientX,h=c.clientY,L=$=>{let M=$.clientX-y+_,R=$.clientY-h+r;i&&(v===0?i.style.width=`${M}px`:v===1?i.style.height=`${R}px`:(i.style.width=`${M}px`,i.style.height=`${R}px`)),a==null||a($)},b=()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",b)};document.addEventListener("mousemove",L),document.addEventListener("mouseup",b)};return f.addEventListener("mousedown",p),()=>{f.removeEventListener("mousedown",p)}}function nt(i,f){const v=a=>{a.preventDefault(),a.stopPropagation();const{deltaY:p}=a,c=5e-4,r=window.getComputedStyle(i).getPropertyValue("transform").match(/matrix\(([-\d\.]+), ([-\d\.]+), ([-\d\.]+), ([-\d\.]+), ([-\d\.]+), ([-\d\.]+)\)/);let y=+(r==null?void 0:r[1])||1;const h=+(r==null?void 0:r[2])||0,L=+(r==null?void 0:r[3])||0;let b=+(r==null?void 0:r[4])||1;const $=+(r==null?void 0:r[5])||0,M=+(r==null?void 0:r[6])||0;y+=-p*c,b+=-p*c,i.style.transform=`matrix(${y}, ${h}, ${L}, ${b}, ${$}, ${M})`,f==null||f(a)};return i.addEventListener("wheel",v),()=>{i.removeEventListener("wheel",v)}}const st=G((i,{expose:f})=>{const v=g(),a=g(),p=g(),c=g(),n=5,_=()=>{v.value.style.visibility=a.value.style.visibility=p.value.style.visibility=c.value.style.visibility="hidden",v.value.style.left=a.value.style.left=p.value.style.top=c.value.style.top="0"};return f({hideGuides:_,showGuides:y=>{if(!(y&&v.value&&a.value&&p.value&&c.value))return;_();const h=y.elRef.value,L=i.page.getAllNodes().filter(m=>!m.isNPage&&m!==y).map(m=>m.elRef.value),{left:b,right:$,top:M,bottom:R,width:z,height:S}=h.getBoundingClientRect();for(let m=0,x=L.length;m<x;m++){const w=L[m];if(!w)continue;const{left:C,right:s,top:u,bottom:d}=w.getBoundingClientRect();let l,t=i.page.elRef.value;(l=Math.abs(C-b)<=n&&C||Math.abs(s-b)<=n&&s)&&(v.value.style.visibility="visible",D(v.value,l,"left",t),D(y.elRef.value,l,"left",t)),(l=Math.abs(C-$)<=n&&C||Math.abs(s-$)<=n&&s)&&(a.value.style.visibility="visible",D(a.value,l,"left",t),D(y.elRef.value,l-z,"left",t)),(l=Math.abs(u-M)<=n&&u||Math.abs(d-M)<=n&&d)&&(p.value.style.visibility="visible",D(p.value,l,"top",t),D(y.elRef.value,l,"top",t)),(l=Math.abs(u-R)<=n&&u||Math.abs(d-R)<=n&&d)&&(c.value.style.visibility="visible",D(c.value,l,"top",t),D(y.elRef.value,l-S,"top",t))}y.updateStyle()}}),()=>o(Me,null,[o("div",{ref:v,class:`${E.guide} ${E["guide-vertical"]}`},null),o("div",{ref:a,class:`${E.guide} ${E["guide-vertical"]}`},null),o("div",{ref:p,class:`${E.guide} ${E["guide-horizontal"]}`},null),o("div",{ref:c,class:`${E.guide} ${E["guide-horizontal"]}`},null)])},{props:{page:{type:Object}}}),lt=G((i,{attrs:f,emit:v,expose:a})=>{const p=g(),c=g(),n=g(),_=g(),r=g(),y=g(),h=W(),L=g({...f.style}),b=[],$=()=>{h.value=null,p.value.remove(),b.forEach(s=>s())},M=s=>{s&&s.append(p.value)},R=()=>{h.value&&h.value.updateStyle()},z=s=>{var u;(u=y.value)==null||u.showGuides(h.value),R()},S=s=>{$(),y.value.hideGuides(),h.value=s,M(s.elRef.value);const u=le(s.elRef.value,n.value,0,R),d=le(s.elRef.value,_.value,1,R),l=le(s.elRef.value,r.value,2,R),t=tt(s.elRef.value,c.value,!0,z);b.push(t,u,d,l),s.isNPage?b.push(nt(s.elRef.value,R)):b.push(ot(s.elRef.value,c.value))},m=s=>{if(s.preventDefault(),s.stopPropagation(),!h.value)return;const u=h.value,d=u.parent,l=d.children.indexOf(u),t=d.children[l-1];t&&d.insert(u,t)},x=s=>{if(s.preventDefault(),s.stopPropagation(),!h.value)return;const u=h.value,d=u.parent,l=d.children.indexOf(u),t=d.children[l+1];t&&d.insert(u,t,"after")},w=s=>{if(s.preventDefault(),s.stopPropagation(),!h.value)return;const u=h.value,d=K(ie(u));u.parent.insert(d,u,"after")},C=s=>{if(s.preventDefault(),s.stopPropagation(),!h.value)return;const u=h.value;$(),u.parent.remove(u),v("removeNode")};return a({control:S,clearControl:$}),()=>{var s,u,d,l;return o("div",{ref:p,class:E.controls,style:L.value},[o("div",{ref:n,class:E["right-resize"]},null),o("div",{ref:_,class:E["bottom-resize"]},null),o("div",{ref:r,class:E["corner-resize"]},null),o("div",{class:E["button-list"]},[o("div",{ref:c,class:E.button},[o(T,{size:15,color:"#fff"},{default:()=>[o(Re,null,null)]})]),o("div",{class:E.button,style:{display:(s=h.value)!=null&&s.isNPage?"none":"initial"},onPointerdown:m},[o(T,{size:15,color:"#fff"},{default:()=>[o(Ce,null,null)]})]),o("div",{class:E.button,style:{display:(u=h.value)!=null&&u.isNPage?"none":"initial"},onPointerdown:x},[o(T,{size:15,color:"#fff"},{default:()=>[o(Le,null,null)]})]),o("div",{class:E.button,style:{display:(d=h.value)!=null&&d.isNPage?"none":"initial"},onPointerdown:w},[o(T,{size:15,color:"#fff"},{default:()=>[o(Ee,null,null)]})]),o("div",{class:E.button,style:{display:(l=h.value)!=null&&l.isNPage?"none":"initial"},onPointerdown:C},[o(T,{size:15,color:"#fff"},{default:()=>[o(Ne,null,null)]})])]),o(st,{page:i.page,ref:y},null)])}},{props:{page:{type:Object}},emits:["removeNode"]}),at=G((i,{expose:f})=>{const v=g(),a=g(),p=g({pointerEvents:"none",position:"absolute",zIndex:"100",inset:"0",boxSizing:"border-box",border:"2px dashed var(--color-8)"}),c=()=>{a.value=null,v.value.remove()},n=r=>{r.append(v.value)};return f({hover:r=>{c(),a.value=r,n(r.elRef.value)},clearHover:c}),()=>o("div",{ref:v,style:p.value},null)});function it(i,f){var v;f.isContainerNode?f.add(i):(v=f.parent)==null||v.insert(i,f)}const rt=G((i,{emit:f})=>{const v=g(),a=W([]);a.value=Object.values(De).map(e=>new e.default);const p=g([{title:"退出",handleClick:()=>{f("exit")}},{title:"全屏",handleClick:()=>{const e=v.value;e&&(document.fullscreenElement==e?document.exitFullscreen():e.requestFullscreen())}},{title:"编辑",children:[{title:"撤销",handleClick:()=>{b()}},{title:"恢复",handleClick:()=>{$()}},{title:"清空",handleClick:()=>{n.value=new ve,_=n.value.component}}]},{title:"文件",children:[{title:"导出",children:[{title:"导出vue",handleClick:()=>{n.value.resetStyle(),Ae(n.value).then(e=>{pe(e,"Page.zip")})}},{title:"导出json",handleClick:()=>{n.value.resetStyle();const e=ie(n.value);pe(e,"page.json")}}]},{title:"导入json",handleClick:()=>{Ve(e=>{e.text().then(N=>{n.value=K(N),_=n.value.component})})}}]}]),c=g(),n=W(new ve);let _=n.value.component;const r=W(),y=localStorage.getItem("SytPage");y&&(n.value=K(y),_=n.value.component),Pe(n,()=>{const e=ie(n.value);localStorage.setItem("SytPage",e),L?L=!1:h.push(e)},{deep:!0,flush:"post"});const h=new Be;let L=!1;const b=()=>{h.undo(e=>{n.value=K(e),_=n.value.component,r.value=null,L=!0})},$=()=>{h.redo(e=>{n.value=K(e),_=n.value.component,r.value=null,L=!0})},M=e=>{r.value=e,e.active=!0,ze(()=>{c.value.control(e)})},R=e=>{n.value.traverse(N=>N.active=!1),M(e.targetNode)},z=g(),S=g(),m=e=>{z.value=e.targetNode,S.value.hover(e.targetNode)},x=e=>{z.value=null,S.value.clearHover()},w=W(),C=W(),s=e=>{w.value=e.targetNode},u=200,d=Fe(e=>{C.value=e.targetNode,it(w.value,C.value),M(w.value)},u),l=e=>{setTimeout(()=>w.value=C.value=null,u)},t=()=>{r.value=null};return()=>V("div",{ref:v,class:Y.editor,onDragend:l,onDragNode:s},[o(Ue,{data:p.value},null),o(me,{width:"300px",direction:"ltr"},{header:()=>o("span",null,[H("组件")]),default:()=>o(He,{modelValue:["1","2","3","4"],class:Y.views},{default:()=>[o(ne,{name:"1"},{title:()=>o(se,{class:Y["views-title"],tag:"b"},{default:()=>[H("布局")]}),default:()=>a.value.filter(e=>e.isLayoutNode).map(e=>V(e.view))}),o(ne,{name:"2"},{title:()=>o(se,{class:Y["views-title"],tag:"b"},{default:()=>[H("表单")]}),default:()=>o("div",{class:Y["views-container"]},{default:()=>a.value.filter(e=>e.isFormNode).map(e=>V(e.view))})}),o(ne,{name:"3"},{title:()=>o(se,{class:Y["views-title"],tag:"b"},{default:()=>[H("图表")]}),default:()=>o("div",{class:Y["views-container"]},{default:()=>a.value.filter(e=>e.isChartNode).map(e=>V(e.view))})}),o(ne,{name:"4"},{title:()=>o(se,{class:Y["views-title"],tag:"b"},{default:()=>[H("数据展示")]}),default:()=>o("div",{class:Y["views-container"]},{default:()=>a.value.filter(e=>e.isDataNode).map(e=>V(e.view))})})]})}),V("div",{class:Y.container,onMouseleave:x,onHover:m,onNodeSelect:R,onDragenterNode:d},o(_,null,null)),o(me,{width:"300px"},{header:()=>o("span",null,[H("参数")]),default:()=>r.value?V(r.value.params):""}),o(lt,{ref:c,page:n.value,style:{display:r.value?"block":"none"},onRemoveNode:t},null),o(at,{ref:S,style:{display:z.value?"block":"none"}},null)])},{emits:["exit"]}),he=i=>(ke("data-v-dc6eeab8"),i=i(),Ye(),i),ut={class:"container"},dt=he(()=>ee("span",{class:"card-title"},"低代码页面编辑器",-1)),ct=he(()=>ee("p",{class:"card-content"},"拖拽编辑页面",-1)),vt=G({__name:"PageEditor",setup(i){fe.baseUrl="http://localhost:8080",fe.token=Se().token;const f=g(!1);return(v,a)=>{const p=Ie;return re(),ue("div",ut,[o(p,{class:"card-button",onClick:a[0]||(a[0]=c=>f.value=!0)},{header:Z(()=>[dt]),default:Z(()=>[ct]),_:1}),o(j(Te),{modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=c=>f.value=c),fullscreen:"","destroy-on-close":"","show-close":!1,class:"el-dialog"},{default:Z(()=>[o(j(rt),{onExit:a[1]||(a[1]=c=>f.value=!1)})]),_:1},8,["modelValue"])])}}}),jt=de(vt,[["__scopeId","data-v-dc6eeab8"]]);export{jt as default};
