import{d as H,e as L,f as O}from"./user-a4f17727.js";import{_ as G,d as J,m as K,r as y,o as P,x as W,c as a,a as t,t as r,u as o,b as c,w as _,i as X,e as h,E as I,y as Y,f as C,g as l,F as V,h as T,z as p,p as Z,l as ee,k as te}from"./index-2793a848.js";import{c as se}from"./index-20ac2abc.js";import"./index-3d2dc7ee.js";const F=v=>(Z("data-v-7691c9a3"),v=v(),ee(),v),ue={class:"box"},oe={class:"left"},ae={class:"exam-title"},le={class:"content-title"},ne={key:0},ie={key:1},re={key:0},de={key:1},ce={key:2},_e={key:3},he=F(()=>t("span",null,".",-1)),pe=F(()=>t("span",{style:{"font-size":"0.9rem","margin-right":"1rem"}},"请选择",-1)),Fe=h("A"),ve=h("B"),fe=h("C"),ye=h("D"),me=F(()=>t("div",null,null,-1)),ge={class:"right"},Ce={class:"right-1"},Be=F(()=>t("div",{class:"right-1-1"},"如未录像或人像显示不全，成绩作废",-1)),ke={class:"right-2"},Ae=F(()=>t("div",{class:"right-2-1"},"试卷详情",-1)),Ee={class:"right-2-2"},xe={class:"right-2-2"},Ie={class:"right-2-2"},De=F(()=>t("div",{class:"right-2-2"},"每道题："+r(1)+"分",-1)),be={class:"right-2-2"},qe={class:"right-3"},we={class:"right-2-1"},Ne=h(" 剩余时间："),Se={style:{"font-weight":"500",color:"red"}},Ve=h("交卷"),Te=J({props:["examId"],setup(v){const M=v,R=te();K();let m=y(1e3),d=y({}),B=y([]);const k=y();let $=async()=>{await H({examId:M.examId}).then(e=>{e.code==200?(d.value=e.data,m.value=Number.isNaN(e.data.examDuration)?0:e.data.examDuration*60):I({type:"error",message:e.errMsg})}),L({ids:d.value.questionIds}).then(e=>{e.code==200&&(B.value=e.data.data)})},D=()=>{k.value.srcObject||Y.alert("请开启摄像头权限，如不开启摄像头则本次考试无效！","警告",{type:"warning",confirmButtonText:"确定",callback:D})},g=(e,s)=>{e.result??(e.result=new Set),e.questionType==1&&(e.result.clear(),e.result.add(s)),e.questionType==2&&(e.result.has(s)?e.result.delete(s):e.result.add(s))},f=y(!1),A=()=>{let e=[];B.value.reduce((s,n)=>(n.result?s.push([...n.result].sort((E,x)=>E-x).join()):s.push(""),s),e),O({questionIds:"23,24,25,32,34,36",userAnswers:e.join("-"),examId:d.value.examId,examQtId:d.value.examQtId,creditImgUrl:""}).then(s=>{s.code==200?(I({type:"success",message:"交卷成功"}),R.back()):I({type:"error",message:s.errMsg})})},U=e=>{let s=Math.floor(e/60),n=e%60;return`${s>0?s+"分":""}${n}秒`},j=setInterval(()=>{m.value>0?m.value--:f.value=!0},1e3);return P(()=>{se(k.value).then(()=>{D()}),$()}),W(()=>{clearInterval(j)}),(e,s)=>{var b;const n=C("el-button"),E=C("el-scrollbar"),x=C("el-alert"),z=C("el-dialog");return l(),a("div",ue,[t("div",oe,[t("div",ae,r(o(d).examName),1),c(E,{class:"content",height:"70vh"},{default:_(()=>[(l(!0),a(V,null,T(o(B),(u,Q)=>{var q,w,N,S;return l(),a("div",{key:u.questionId,class:"content-item"},[t("div",le,[t("span",null,r(Q+1)+".",1),u.questionType==1?(l(),a("span",ne,"【单选题】")):p("",!0),u.questionType==2?(l(),a("span",ie,"【多选题】")):p("",!0),t("span",null,r(u.questionContent),1)]),t("div",null,[(l(!0),a(V,null,T(u.answer,i=>(l(),a("div",{key:i.id,class:"answer-item"},[i.id==0?(l(),a("span",re,"A")):p("",!0),i.id==1?(l(),a("span",de,"B")):p("",!0),i.id==2?(l(),a("span",ce,"C")):p("",!0),i.id==3?(l(),a("span",_e,"D")):p("",!0),he,h(" "+r(i.answer),1)]))),128))]),t("div",null,[pe,c(n,{circle:"",type:(q=u.result)!=null&&q.has(0)?"primary":"default",onClick:i=>o(g)(u,0)},{default:_(()=>[Fe]),_:2},1032,["type","onClick"]),c(n,{circle:"",type:(w=u.result)!=null&&w.has(1)?"primary":"default",onClick:i=>o(g)(u,1)},{default:_(()=>[ve]),_:2},1032,["type","onClick"]),c(n,{circle:"",type:(N=u.result)!=null&&N.has(2)?"primary":"default",onClick:i=>o(g)(u,2)},{default:_(()=>[fe]),_:2},1032,["type","onClick"]),c(n,{circle:"",type:(S=u.result)!=null&&S.has(3)?"primary":"default",onClick:i=>o(g)(u,3)},{default:_(()=>[ye]),_:2},1032,["type","onClick"])]),me])}),128))]),_:1})]),t("div",ge,[t("div",Ce,[Be,t("video",{ref_key:"videoRef",ref:k},null,512)]),t("div",ke,[Ae,t("div",Ee,"本卷共分为："+r((b=o(d).questionIds)==null?void 0:b.split(",").length)+"小题",1),t("div",xe,"作答时间："+r(o(d).examDuration)+"分钟",1),t("div",Ie,"试卷总分："+r(o(d).totalScore)+"分",1),De,t("div",be,"及格分："+r(o(d).passScore)+"分",1)]),t("div",qe,[t("div",we,[Ne,t("span",Se,r(o(U)(o(m))),1)])]),t("div",{class:"right-button",onClick:s[0]||(s[0]=(...u)=>o(A)&&o(A)(...u))},"确认交卷")]),c(z,{modelValue:o(f),"onUpdate:modelValue":s[1]||(s[1]=u=>X(f)?f.value=u:f=u),title:"考试提示",center:"",width:"15rem"},{footer:_(()=>[c(n,{type:"primary",onClick:o(A)},{default:_(()=>[Ve]),_:1},8,["onClick"])]),default:_(()=>[c(x,{title:"考试时间到了，请交卷！",type:"warning","show-icon":!0,closable:!1})]),_:1},8,["modelValue"])])}}}),je=G(Te,[["__scopeId","data-v-7691c9a3"]]);export{je as default};
