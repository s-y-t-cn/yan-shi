import{d as A,af as $,r as S,L as q,y as z,c as h,l as I,w as p,C as v,k as b,t as x,g as c,e as N,ac as V,W as B,aa as G,ak as H,al as K}from"./index-g37XHkO7.js";import{E as M,S as Q}from"./SytPreviewItem-zesOK_pE.js";/* empty css                  */import{E as X,a as Y}from"./el-timeline-item-xpV2Go0K.js";import{E as Z}from"./el-card-DuID4xM1.js";/* empty css                     */import{h as ee,j as te}from"./examples-DKVMKnJo.js";import{a as ae}from"./index-ekn85pdJ.js";import{E as oe}from"./index-7XQ89VVv.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vnode-DwFJRcHj.js";/* empty css                 *//* empty css                  *//* empty css               *//* empty css                    */import"./el-radio-KCor6jJh.js";/* empty css                  */import"./index-CWjOxhQe.js";import"./error-C6KkHRRa.js";import"./index-BP-IRLDI.js";import"./index-16XDJShn.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-ClVUFy22.js";import"./isEqual-sIzh-_wJ.js";import"./index-CdXg1XjN.js";import"./index-B--V0hz4.js";import"./index-Cq1NGWuE.js";import"./index-Ct0d8tij.js";import"./castArray-D6nup7xA.js";import"./index-rcptLjZg.js";import"./_baseClone-YGkPyP1V.js";import"./position-8TaTLdEo.js";const le=_=>(H("data-v-56e97eab"),_=_(),K(),_),ie=le(()=>b("span",null,"流程",-1)),ne=A({__name:"EditSubmit",props:{data:{type:Object,default(){return{name:"",formData:[],flowData:{nodesData:[],linesData:[]}}}}},emits:["submit"],setup(_,{emit:O}){const w=$(),J=_,T=O;let s=S({name:"",formData:[],flowData:{nodesData:[],linesData:[]}});q(()=>JSON.parse(JSON.stringify(J.data)),t=>{s.value=t},{deep:!0,immediate:!0});const L=t=>{for(let a of s.value.formData)if(a.type==="layout"){for(let r of a.cols)for(let e of r.children)if(t===e.field)return e}else if(t===a.field)return a};let g=z(()=>U(s.value)),F=S({label:"部门主管",value:"部门主管"});ee().then(t=>{var a;F.value=(a=t.data.find(r=>r.value==w.department))==null?void 0:a.children.find(r=>r.label.includes("主管"))});const U=t=>{var u;let a=[],r={id:"",type:""},{nodesData:e,linesData:d}=t.flowData,n=r=e.find(o=>o.type==="start");if(!n)return[];for(n.color="#00aabb",a.push(n);d.find(o=>o.fromId===r.id);){let o={id:""},l=d.filter(i=>i.fromId===r.id);if(r.type=="condition"){let i=l.findIndex(D=>D.text==="是"),m=l.findIndex(D=>D.text==="否"),f=i,{field:R,comparison:W,value:E}=r.properties,y=L(R);if(y)switch(W){case"小于":y.value<E?f=i:f=m;break;case"等于":y.value===E?f=i:f=m;break;case"大于":y.value>E?f=i:f=m;break}o=e.find(D=>{var C;return D.id===((C=l[f])==null?void 0:C.toId)})}else o=e.find(i=>{var m;return i.id===((m=l[0])==null?void 0:m.toId)}),(o==null?void 0:o.type)=="handle"&&((u=o.properties)==null?void 0:u.value)=="部门主管"&&(o.properties=F.value);(o==null?void 0:o.type)!="condition"&&a.push(o),r=o}return a},k=S(),j=()=>{let t=new FormData;t.append("name",s.value.name),t.append("submitter",JSON.stringify({username:w.username,nickname:w.nickname}));let a={};s.value.formData.forEach(e=>{e.type==="img-upload"?e.value.forEach(d=>t.append(e.field,d)):e.type==="layout"?e.cols.forEach(d=>{d.children.forEach(n=>{n.type==="img-upload"?n.value.forEach(u=>t.append(n.field,u)):a[n.field]=n.value})}):a[e.field]=e.value}),t.append("formData",JSON.stringify(a));let r=g.value.filter(e=>e.type==="handle").map(e=>({id:e.id,type:e.text,label:e.properties.label,username:e.properties.value,status:"未处理"}));return t.append("flowData",JSON.stringify(r)),t},P=t=>{if(!t)return!1;t.validate(a=>{if(a)te(j()).then(()=>T("submit"));else return!1})};return(t,a)=>{const r=ae,e=Z,d=Y,n=X,u=oe,o=M;return h(),I(o,{direction:"vertical",fill:"",class:"submit-container"},{default:p(()=>[v(e,null,{header:p(()=>[b("h1",null,x(c(s).name),1)]),default:p(()=>[v(r,{ref_key:"ruleFormRef",ref:k,model:c(s).formData},{default:p(()=>[(h(!0),N(B,null,V(c(s).formData,(l,i)=>(h(),I(Q,{key:l.field,modelValue:c(s).formData[i],"onUpdate:modelValue":m=>c(s).formData[i]=m,index:i.toString(),"rule-form-ref":k.value,onCascaderFetch:m=>l.options=m},null,8,["modelValue","onUpdate:modelValue","index","rule-form-ref","onCascaderFetch"]))),128))]),_:1},8,["model"])]),_:1}),v(e,null,{header:p(()=>[ie]),default:p(()=>[v(n,null,{default:p(()=>[(h(!0),N(B,null,V(c(g),l=>(h(),I(d,{key:l.id,icon:l.icon,color:l.color,timestamp:l.timestamp},{default:p(()=>{var i;return[b("div",null,x(l.text),1),b("div",null,x((i=l.properties)==null?void 0:i.label),1)]}),_:2},1032,["icon","color","timestamp"]))),128))]),_:1}),v(u,{type:"primary",onClick:a[0]||(a[0]=l=>P(k.value))},{default:p(()=>[G("提交")]),_:1})]),_:1})]),_:1})}}}),Re=re(ne,[["__scopeId","data-v-56e97eab"]]);export{Re as default};
