import{d as re,aF as Fe,ao as Re,x as Ve,y as he,aG as He,o as ge,ar as xe,c as A,e as j,B as t,w as N,l as ee,g as k,aH as We,E as O,aI as qe,G as ne,f as $e,k as H,n as q,z as pe,r as C,aa as le,ac as ve,W as J,m as fe,t as je,ax as Me,az as ke,aJ as De,aK as Se,aL as Te,aM as Ae,aN as Be,ap as Ce,an as ue,aO as Ge,R as Ye,L as Je,a1 as ye}from"./index-C_YbkAKH.js";import{a as Q,E as Ie}from"./index-Dli7m8L2.js";import{E as Oe,a as Ue,t as Ne,b as oe,d as Z,f as ae,g as we,e as Qe,m as Ze,h as et,i as be,u as tt,j as ot,k as Le,N as ze,U as lt,l as st}from"./animation-CC0oKNmc.js";import{_ as Ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as Xe}from"./index-CQmBfNNm.js";import{E as nt}from"./el-checkbox-DwSOVDsD.js";import"./el-tooltip-BGUaIBXT.js";/* empty css                  */import{E as at}from"./index-OCjV84rr.js";import{E as it}from"./index-CYVqnvBV.js";const te={drawerToggle:{code:"Tab",key:"Tab",shiftKey:!1,ctrlKey:!1,altKey:!1},copyNode:{code:"KeyC",key:"c",shiftKey:!1,ctrlKey:!0,altKey:!1},pasteNode:{code:"KeyV",key:"v",shiftKey:!1,ctrlKey:!0,altKey:!1},removeNode:{code:"Delete",key:"Delete",shiftKey:!1,ctrlKey:!1,altKey:!1},undo:{code:"KeyZ",key:"z",shiftKey:!1,ctrlKey:!0,altKey:!1},redo:{code:"KeyY",key:"y",shiftKey:!1,ctrlKey:!0,altKey:!1},save:{code:"KeyS",key:"s",shiftKey:!1,ctrlKey:!0,altKey:!1}},ie=a=>`快捷键：${a.shiftKey?"Shift + ":""}${a.ctrlKey?"Ctrl + ":""}${a.altKey?"Alt + ":""}${a.key}`,rt={key:0,class:"header"},ut={class:"content"},ct=re({__name:"Drawer",props:Fe({width:{type:String,default:"30%"},direction:{type:String,default:"rtl"}},{modelValue:{type:Boolean,default:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(a){Re(l=>({"67bb54b2":p.value}));const w=a,y=Ve(),p=he(()=>y.header?"35px":"0px"),v=he(()=>({width:w.direction=="rtl"||w.direction=="ltr"?w.width:"100%",height:w.direction=="ttb"||w.direction=="btt"?w.width:"100%"})),f=He(a,"modelValue"),s=te.drawerToggle,_=l=>{l.code==s.code&&l.shiftKey==s.shiftKey&&l.ctrlKey==s.ctrlKey&&l.altKey==s.altKey&&(l.preventDefault(),f.value=!f.value)};return ge(()=>{document.addEventListener("keydown",_)}),xe(()=>{document.removeEventListener("keydown",_)}),(l,K)=>(A(),j("div",{class:q(["drawer",[{hide:!f.value},w.direction]]),style:pe({width:v.value.width,height:v.value.height})},[t(k(Q),{content:`${k(ie)(k(s))}`,effect:"light",teleported:!1},{default:N(()=>[a.direction=="rtl"||a.direction=="ltr"?(A(),ee(k(O),{key:0,class:"switch",size:"12",onClick:K[0]||(K[0]=M=>f.value=!f.value)},{default:N(()=>[t(k(We))]),_:1})):a.direction=="ttb"||a.direction=="btt"?(A(),ee(k(O),{key:1,class:"switch",size:"12",onClick:K[1]||(K[1]=M=>f.value=!f.value)},{default:N(()=>[t(k(qe))]),_:1})):ne("",!0)]),_:1},8,["content"]),l.$slots.header?(A(),j("div",rt,[$e(l.$slots,"header",{},void 0,!0)])):ne("",!0),H("div",ut,[t(k(Ie),null,{default:N(()=>[$e(l.$slots,"default",{},void 0,!0)]),_:3})])],6))}}),_e=Ke(ct,[["__scopeId","data-v-4f3edd37"]]),dt={__name:"PieMenu",props:{data:{type:Array,default(){return[{title:"菜单1",handleClick:()=>{},children:[{title:"菜单1-1",handleClick:()=>{}},{title:"菜单1-2",handleClick:()=>{}}]},{title:"菜单2",handleClick:()=>{},children:[{title:"菜单2-1",handleClick:()=>{}},{title:"菜单2-2",handleClick:()=>{}}]}]}}},emits:["click"],setup(a,{emit:w}){Re(c=>({"4a24d064":m.value,"5145de5e":k(l)}));const y=a,p=w,v=2*Math.PI;let f=C(),s=C(),_=C(80),l=he(()=>`${_.value}px`),K=he(()=>_.value/2),M=C(70),b=C(v);const E=new WeakMap,m=C("15px"),h=c=>{const L=!E.get(c),{level:z,index:x,pIndex:R}=c.dataset,I=R.split("-");E.set(c,L),f.value.querySelectorAll("div[data-level]").forEach($=>{I.includes($.dataset.index)||c===$||($.dataset.level>Number(z)&&$.classList.remove("show"),$.classList.remove("active"),E.set($,!1))}),L?(c.classList.add("active"),f.value.querySelectorAll(`div[data-level='${+z+1}'][data-p-index*='${x}']`).forEach(r=>r.classList.add("show"))):c.classList.remove("active")},i=()=>Math.random().toString(16).replace(".","");let Y=(c,L,z)=>{const x=b.value/c.length,R=x>=v?v-.001:x,I=c.length==1?1:0;for(let P=0,$=c;P<$.length;P++){let r=K.value+M.value*L,T=P*R,V=(P+1)*R,F=r+Math.sin(T)*r,o=r-Math.cos(T)*r,n=r+Math.sin(V)*r,u=r-Math.cos(V)*r,d=document.createElement("div");d.classList.add("menu-item"),d.dataset.level=+L,d.dataset.index=i(),d.dataset.pIndex=z.dataset.pIndex?`${z.dataset.pIndex}-${z.dataset.index}`:`${z.dataset.index}`,d.style.setProperty("width",`${r*2}px`),d.style.setProperty("height",`${r*2}px`),d.style.setProperty("z-index",-L),d.style.setProperty("clip-path",`path("M ${r} ${r} L ${F} ${o} A ${r} ${r} 0 ${I} 1 ${n} ${u} z")`);const e=document.createElement("div");e.className="item-bg",L%2==0?e.classList.add("bg-even"):e.classList.add("bg-odd"),V=(P+1)*R-.01,F=r+Math.sin(T)*r,o=r-Math.cos(T)*r,n=r+Math.sin(V)*r,u=r-Math.cos(V)*r,e.style.setProperty("width",`${r*2}px`),e.style.setProperty("height",`${r*2}px`),e.style.setProperty("clip-path",`path("M ${r} ${r} L ${F} ${o} A ${r} ${r} 0 ${I} 1 ${n} ${u} z")`),d.appendChild(e);let g=(P+1/2)*R,S=r-M.value/2,X=document.createElement("div");X.style.left=r+Math.sin(g)*S+"px",X.style.top=r-Math.cos(g)*S+"px",X.style.setProperty("position","absolute"),X.style.textAlign="center",X.style.transform=`translate(-50%, -50%) rotate(${-Math.PI/2+g}rad)`;let U=document.createElement("div"),ce=g>Math.PI?Math.PI:0;U.style.display="inline-block",U.innerText=$[P].title,U.style.width=`${M.value-10}px`,U.style.transform=`rotateY(${ce}rad) rotateX(${ce}rad)`,X.appendChild(U),d.appendChild(X),d.addEventListener("pointerdown",()=>{var de,se;(se=(de=$[P]).handleClick)==null||se.call(de),p("click",$[P].title)}),d.addEventListener("pointerdown",()=>h(d)),f.value.insertAdjacentElement("afterbegin",d),$[P].children&&Y($[P].children,L+1,d)}};const G=(c,L)=>{let z={offsetX:0,offsetY:0};const x=R=>{const I=R.clientX,P=R.clientY,{offsetX:$,offsetY:r}=z,T=c.getBoundingClientRect(),V=T.left,F=T.top,o=T.width,n=T.height,u=document.documentElement.clientWidth,d=document.documentElement.clientHeight,e=-V+$,g=-F+r,S=u-V-o+$,X=d-F-n+r,U=de=>{let se=$+de.clientX-I,me=r+de.clientY-P;se=Math.min(Math.max(se,e),S),me=Math.min(Math.max(me,g),X),z={offsetX:se,offsetY:me},c&&(c.style.transform=`translate(${se}px, ${me}px)`)},ce=()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",ce)};document.addEventListener("mousemove",U),document.addEventListener("mouseup",ce)};L.addEventListener("mousedown",x)},D=()=>{G(f.value,s.value);const c="0",L=i();s.value.dataset.level=c,s.value.dataset.index=L,s.value.dataset.pIndex="",Y(y.data,+c+1,s.value),s.value.addEventListener("pointerdown",z=>h(s.value))};return ge(()=>{D()}),(c,L)=>(A(),j("div",{ref_key:"rongQi",ref:f,class:"rong-qi"},[H("div",{ref_key:"center",ref:s,class:"center",draggable:"false",onDblclick:L[0]||(L[0]=z=>p("click","center"))},[$e(c.$slots,"center",{draggable:"false"},()=>[le("菜单")],!0)],544)],512))}},vt=Ke(dt,[["__scopeId","data-v-9e36371f"]]),ft="_editor_o961q_1",pt="_container_o961q_93",mt="_views_o961q_115",W={editor:ft,container:pt,views:mt,"views-title":"_views-title_o961q_123","views-container":"_views-container_o961q_131","views-tabs":"_views-tabs_o961q_147"},yt=re({__name:"ComponentViews",props:["viewNodes"],setup(a){return(w,y)=>{const p=Xe,v=Oe,f=Ue;return A(),ee(f,{"model-value":["1","2","3","4","5"],class:q(k(W).views)},{default:N(()=>[t(v,{name:"1"},{title:N(()=>[t(p,{class:q(k(W)["views-title"]),tag:"b"},{default:N(()=>[le(" 布局 ")]),_:1},8,["class"])]),default:N(()=>[H("div",{class:q(k(W)["views-container"])},[(A(!0),j(J,null,ve(a.viewNodes,s=>(A(),j(J,{key:s.uuid},[s.isLayoutNode?(A(),ee(fe(s.view),{key:0})):ne("",!0)],64))),128))],2)]),_:1}),t(v,{name:"2"},{title:N(()=>[t(p,{class:q(k(W)["views-title"]),tag:"b"},{default:N(()=>[le(" 表单 ")]),_:1},8,["class"])]),default:N(()=>[H("div",{class:q(k(W)["views-container"])},[(A(!0),j(J,null,ve(a.viewNodes,s=>(A(),j(J,{key:s.uuid},[s.isFormNode?(A(),ee(fe(s.view),{key:0})):ne("",!0)],64))),128))],2)]),_:1}),t(v,{name:"3"},{title:N(()=>[t(p,{class:q(k(W)["views-title"]),tag:"b"},{default:N(()=>[le(" 图表 ")]),_:1},8,["class"])]),default:N(()=>[H("div",{class:q(k(W)["views-container"])},[(A(!0),j(J,null,ve(a.viewNodes,s=>(A(),j(J,{key:s.uuid},[s.isChartNode?(A(),ee(fe(s.view),{key:0})):ne("",!0)],64))),128))],2)]),_:1}),t(v,{name:"4"},{title:N(()=>[t(p,{class:q(k(W)["views-title"]),tag:"b"},{default:N(()=>[le(" 数据展示 ")]),_:1},8,["class"])]),default:N(()=>[H("div",{class:q(k(W)["views-container"])},[(A(!0),j(J,null,ve(a.viewNodes,s=>(A(),j(J,{key:s.uuid},[s.isDataNode?(A(),ee(fe(s.view),{key:0})):ne("",!0)],64))),128))],2)]),_:1}),t(v,{name:"5"},{title:N(()=>[t(p,{class:q(k(W)["views-title"]),tag:"b"},{default:N(()=>[le(" 导航 ")]),_:1},8,["class"])]),default:N(()=>[H("div",{class:q(k(W)["views-container"])},[(A(!0),j(J,null,ve(a.viewNodes,s=>(A(),j(J,{key:s.uuid},[s.isNavigationNode?(A(),ee(fe(s.view),{key:0})):ne("",!0)],64))),128))],2)]),_:1})]),_:1},8,["class"])}}}),ht=["onMouseover","onClick"],gt=["onPointerdown"],wt=["onPointerdown"],bt=["onPointerdown"],_t=["onPointerdown"],Pt=["onPointerdown"],$t=["onPointerdown"],xt=["onPointerdown"],Nt=re({__name:"ViewsTree",props:["page","hoveredNode","selectedNode","controls"],emits:["hoverNode","selectNode"],setup(a,{emit:w}){const y=a,p=w,v=(m,h,i)=>i=="inner"?h.data.isContainerNode:!h.data.isNPage,f=(m,h,i)=>{i=="inner"?m.data.parent=h.data:m.data.parent=h.data.parent},s=(m,h)=>{var i;return(i=y.controls)==null?void 0:i.moveBefore(m,h)},_=(m,h)=>{var i;return(i=y.controls)==null?void 0:i.moveAfter(m,h)},l=(m,h)=>{var i;return(i=y.controls)==null?void 0:i.copyNode(m,h)},K=(m,h)=>{var i;return(i=y.controls)==null?void 0:i.cloneNode(m,h)},M=(m,h)=>{var i;return(i=y.controls)==null?void 0:i.pasteNode(m,h)},b=(m,h)=>{var i;return(i=y.controls)==null?void 0:i.pasteNodeParams(m,h)},E=(m,h)=>{var i;return(i=y.controls)==null?void 0:i.removeNode(m,h)};return(m,h)=>{const i=O,Y=Q,G=nt;return A(),ee(G,{style:{width:"500px"},data:[a.page],props:{label:"name"},"node-key":"uuid","expand-on-click-node":!1,"default-expand-all":"",draggable:"","allow-drop":v,onNodeDrop:f},{default:N(({node:D,data:c})=>{var L,z;return[H("div",{class:q(["n-tree-node",{hovered:((L=a.hoveredNode)==null?void 0:L.uuid)==c.uuid,selected:((z=a.selectedNode)==null?void 0:z.uuid)==c.uuid}]),style:{flex:"1"},onMouseover:x=>p("hoverNode",{targetNode:Ce(c)}),onClick:x=>p("selectNode",{targetNode:Ce(c)})},[H("span",null,je(D.label),1),H("div",null,[H("div",{class:"button",style:pe({display:c.isNPage?"none":"initial"}),onPointerdown:x=>s(x,c)},[t(Y,{content:"上移",effect:"light",teleported:!1},{default:N(()=>[t(i,{size:13,color:"#08f"},{default:N(()=>[t(k(Me))]),_:1})]),_:1})],44,gt),H("div",{class:"button",style:pe({display:c.isNPage?"none":"initial"}),onPointerdown:x=>_(x,c)},[t(Y,{content:"下移",effect:"light",teleported:!1},{default:N(()=>[t(i,{size:13,color:"#08f"},{default:N(()=>[t(k(ke))]),_:1})]),_:1})],44,wt),H("div",{class:"button",style:pe({display:c.isNPage?"none":"initial"}),onPointerdown:x=>K(x,c)},[t(Y,{content:"克隆",effect:"light",teleported:!1},{default:N(()=>[t(i,{size:13,color:"#a50"},{default:N(()=>[t(k(De))]),_:1})]),_:1})],44,bt),H("div",{class:"button",onPointerdown:x=>b(x,c)},[t(Y,{content:"粘贴参数",effect:"light",teleported:!1},{default:N(()=>[t(i,{size:13,color:"#a50"},{default:N(()=>[t(k(Se))]),_:1})]),_:1})],40,_t),H("div",{class:"button",onPointerdown:x=>l(x,c)},[t(Y,{content:"复制",effect:"light",teleported:!1},{default:N(()=>[t(i,{size:13,color:"#a50"},{default:N(()=>[t(k(Te))]),_:1})]),_:1})],40,Pt),H("div",{class:"button",onPointerdown:x=>M(x,c)},[t(Y,{content:"粘贴",effect:"light",teleported:!1},{default:N(()=>[t(i,{size:13,color:"#a50"},{default:N(()=>[t(k(Ae))]),_:1})]),_:1})],40,$t),H("div",{class:"button",style:pe({display:c.isNPage?"none":"initial"}),onPointerdown:x=>E(x,c)},[t(Y,{content:"删除",effect:"light",teleported:!1},{default:N(()=>[t(i,{size:13,color:"#a00"},{default:N(()=>[t(k(Be))]),_:1})]),_:1})],44,xt)])],42,ht)]}),_:1},8,["data"])}}}),Kt=Ke(Nt,[["__scopeId","data-v-f48b45fa"]]),Et="_controls_78emz_1",Ct="_button_78emz_95",Lt="_guide_78emz_135",B={controls:Et,"right-resize":"_right-resize_78emz_41","bottom-resize":"_bottom-resize_78emz_59","corner-resize":"_corner-resize_78emz_77","button-list":"_button-list_78emz_95",button:Ct,guide:Lt,"guide-horizontal":"_guide-horizontal_78emz_149","guide-vertical":"_guide-vertical_78emz_163"},Ee=100;function zt(a,w,y=!0,p){let v={offsetX:0,offsetY:0};const f=s=>{const _=window.getComputedStyle(a),l=Number.parseFloat(_.getPropertyValue("left")),K=Number.parseFloat(_.getPropertyValue("top"));if(_.position!="absolute")return;v={offsetX:l,offsetY:K};const M=s.clientX,b=s.clientY,{offsetX:E,offsetY:m}=v,h=a.getBoundingClientRect(),i=h.left,Y=h.top,G=h.width,D=h.height,c=document.documentElement.clientWidth,L=document.documentElement.clientHeight,z=-i+E,x=-Y+m,R=c-i-G+E,I=L-Y-D+m,P=Ne(r=>{let T=E+r.clientX-M,V=m+r.clientY-b;y||(T=Math.min(Math.max(T,z),R),V=Math.min(Math.max(V,x),I)),v={offsetX:T,offsetY:V},a&&(a.style.left=`${T}px`,a.style.top=`${V}px`),p==null||p(r)},Ee),$=()=>{document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",$)};document.addEventListener("mousemove",P),document.addEventListener("mouseup",$)};return w.addEventListener("mousedown",f),()=>{w.removeEventListener("mousedown",f)}}function Rt(a,w){const y=p=>{if(window.getComputedStyle(a).position=="absolute")return;a.setAttribute("draggable","true");const v=f=>{a.setAttribute("draggable","false"),document.removeEventListener("mouseup",v)};document.addEventListener("mouseup",v)};return w.addEventListener("mousedown",y),()=>{w.removeEventListener("mousedown",y)}}function Pe(a,w,y,p){const v=f=>{const s=window.getComputedStyle(a),_=Number.parseFloat(s.getPropertyValue("width")),l=Number.parseFloat(s.getPropertyValue("height")),K=f.clientX,M=f.clientY,b=Ne(m=>{let h=m.clientX-K+_,i=m.clientY-M+l;a&&(y===0?a.style.width=`${h}px`:y===1?a.style.height=`${i}px`:(a.style.width=`${h}px`,a.style.height=`${i}px`)),p==null||p(m)},Ee),E=()=>{document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",E)};document.addEventListener("mousemove",b),document.addEventListener("mouseup",E)};return w.addEventListener("mousedown",v),()=>{w.removeEventListener("mousedown",v)}}function Mt(a,w){const y=Ne(p=>{p.preventDefault(),p.stopPropagation();const{deltaY:v}=p,f=5e-4,l=window.getComputedStyle(a).getPropertyValue("transform").match(/matrix\(([-\d\.]+), ([-\d\.]+), ([-\d\.]+), ([-\d\.]+), ([-\d\.]+), ([-\d\.]+)\)/);let K=+(l==null?void 0:l[1])||1;const M=+(l==null?void 0:l[2])||0,b=+(l==null?void 0:l[3])||0;let E=+(l==null?void 0:l[4])||1;const m=+(l==null?void 0:l[5])||0,h=+(l==null?void 0:l[6])||0;K+=-v*f,E+=-v*f,a.style.transform=`matrix(${K}, ${M}, ${b}, ${E}, ${m}, ${h})`,w==null||w(p)},Ee);return a.addEventListener("wheel",y),()=>{a.removeEventListener("wheel",y)}}const kt=re((a,{expose:w})=>{const y=C(),p=C(),v=C(),f=C(),s=5,_=()=>{y.value.style.visibility=p.value.style.visibility=v.value.style.visibility=f.value.style.visibility="hidden",y.value.style.left=p.value.style.left=v.value.style.top=f.value.style.top="0"};return w({hideGuides:_,showGuides:K=>{if(!(K&&y.value&&p.value&&v.value&&f.value))return;_();const M=K.elRef.value,b=a.page.getAllNodes().filter(D=>!D.isNPage&&D!==K).map(D=>D.elRef.value),{left:E,right:m,top:h,bottom:i,width:Y,height:G}=M.getBoundingClientRect();for(let D=0,c=b.length;D<c;D++){const L=b[D];if(!L)continue;const{left:z,right:x,top:R,bottom:I}=L.getBoundingClientRect();let P,$=a.page.elRef.value;(P=Math.abs(z-E)<=s&&z||Math.abs(x-E)<=s&&x)&&(y.value.style.visibility="visible",oe(y.value,P,"left",$),oe(K.elRef.value,P,"left",$)),(P=Math.abs(z-m)<=s&&z||Math.abs(x-m)<=s&&x)&&(p.value.style.visibility="visible",oe(p.value,P,"left",$),oe(K.elRef.value,P-Y,"left",$)),(P=Math.abs(R-h)<=s&&R||Math.abs(I-h)<=s&&I)&&(v.value.style.visibility="visible",oe(v.value,P,"top",$),oe(K.elRef.value,P,"top",$)),(P=Math.abs(R-i)<=s&&R||Math.abs(I-i)<=s&&I)&&(f.value.style.visibility="visible",oe(f.value,P,"top",$),oe(K.elRef.value,P-G,"top",$))}K.updateStyle()}}),()=>t(J,null,[t("div",{ref:y,class:`${B.guide} ${B["guide-vertical"]}`},null),t("div",{ref:p,class:`${B.guide} ${B["guide-vertical"]}`},null),t("div",{ref:v,class:`${B.guide} ${B["guide-horizontal"]}`},null),t("div",{ref:f,class:`${B.guide} ${B["guide-horizontal"]}`},null)])},{props:{page:{type:Object}}}),Dt=re((a,{attrs:w,emit:y,expose:p})=>{const v=C(),f=C(),s=C(),_=C(),l=C(),K=C(),M=C(),b=ue(),E=30,m=()=>{const o=f.value.style;o.setProperty("top",`-${E}px`),o.setProperty("bottom","auto"),o.setProperty("left","auto"),o.setProperty("right","0");const{top:n,bottom:u,left:d,right:e}=Qe(f.value),{bottom:g}=v.value.getBoundingClientRect(),{top:S,left:X,right:U}=f.value.getBoundingClientRect();S<n&&(g+E>u?(o.setProperty("top","0"),o.setProperty("bottom","auto")):(o.setProperty("top","auto"),o.setProperty("bottom",`-${E}px`))),X<d&&(o.setProperty("left","0"),o.setProperty("right","auto")),U>e&&(o.setProperty("left","auto"),o.setProperty("right","0"))},h=C({...w.style}),i=[],Y=()=>{b.value=null,v.value.remove(),i.forEach(o=>o())},G=o=>{o&&(o.append(v.value),Ye(m))},D=()=>{b.value&&b.value.updateStyle()},c=o=>{var n;(n=M.value)==null||n.showGuides(b.value),D()},L=o=>{Y(),M.value.hideGuides(),b.value=o,G(o.elRef.value);const n=Pe(o.elRef.value,_.value,0,D),u=Pe(o.elRef.value,l.value,1,D),d=Pe(o.elRef.value,K.value,2,D),e=zt(o.elRef.value,s.value,!0,c);i.push(e,n,u,d),o.isNPage?i.push(Mt(o.elRef.value,D)):i.push(Rt(o.elRef.value,s.value))},z=(o,n)=>{if(o.preventDefault(),o.stopPropagation(),!n)return;const u=n.parent,d=u.children.indexOf(n),e=u.children[d-1];e&&u.insert(n,e)},x=(o,n)=>{if(o.preventDefault(),o.stopPropagation(),!n)return;const u=n.parent,d=u.children.indexOf(n),e=u.children[d+1];e&&u.insert(n,e,"after")},R=C(""),I=(o,n)=>{if(o.preventDefault(),o.stopPropagation(),!n)return;const u=Z(n);R.value=u},P=(o,n)=>{if(o.preventDefault(),o.stopPropagation(),!n)return;const u=Z(n),d=ae(u);R.value=u,d.traverse(g=>g.uuid=we()),n.parent.insert(d,n,"after")},$=(o,n)=>{if(o.preventDefault(),o.stopPropagation(),!n||!R.value)return;const u=ae(R.value);u.traverse(d=>d.uuid=we()),n!=null&&n.isContainerNode?n.isNPage&&u.isNPage?(n.copy(u),[...u.children].forEach(d=>n.add(d))):u.isNPage||n.add(u):n.parent.add(u)},r=(o,n)=>{if(o.preventDefault(),o.stopPropagation(),!n||!R.value)return;const u=ae(R.value);u.traverse(d=>d.uuid=we()),n.copy(u)},T=(o,n)=>{if(o.preventDefault(),o.stopPropagation(),!n)return;Y();const u=n.parent;u==null||u.remove(n),y("removeNode")},V=o=>{const{copyNode:n,pasteNode:u,removeNode:d}=te;o.code==n.code&&o.shiftKey==n.shiftKey&&o.ctrlKey==n.ctrlKey&&o.altKey==n.altKey&&I(o,b.value),o.code==u.code&&o.shiftKey==u.shiftKey&&o.ctrlKey==u.ctrlKey&&o.altKey==u.altKey&&$(o,b.value),o.code==d.code&&o.shiftKey==d.shiftKey&&o.ctrlKey==d.ctrlKey&&o.altKey==d.altKey&&T(o,b.value)};ge(()=>{document.addEventListener("keydown",V)}),xe(()=>{document.removeEventListener("keydown",V)}),p({control:L,clearControl:Y,moveBefore:z,moveAfter:x,copyNode:I,cloneNode:P,pasteNode:$,pasteNodeParams:r,removeNode:T});const F=C("#fff");return()=>{var o,n,u,d;return t("div",{ref:v,class:B.controls,style:h.value},[t("div",{ref:_,class:B["right-resize"]},null),t("div",{ref:l,class:B["bottom-resize"]},null),t("div",{ref:K,class:B["corner-resize"]},null),t("div",{ref:f,class:B["button-list"]},[t("div",{class:B.button},[t(Xe,{style:`--el-text-color: ${F.value};`},{default:()=>{var e;return[(e=b.value)==null?void 0:e.name]}})]),t("div",{ref:s,class:B.button},[t(Q,{content:"拖拽",effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(Ge,null,null)]})]})]),t("div",{class:B.button,style:{display:(o=b.value)!=null&&o.isNPage?"none":"initial"},onPointerdown:e=>z(e,b.value)},[t(Q,{content:"上移",effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(Me,null,null)]})]})]),t("div",{class:B.button,style:{display:(n=b.value)!=null&&n.isNPage?"none":"initial"},onPointerdown:e=>x(e,b.value)},[t(Q,{content:"下移",effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(ke,null,null)]})]})]),t("div",{class:B.button,style:{display:(u=b.value)!=null&&u.isNPage?"none":"initial"},onPointerdown:e=>P(e,b.value)},[t(Q,{content:"克隆",effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(De,null,null)]})]})]),t("div",{class:B.button,onPointerdown:e=>r(e,b.value)},[t(Q,{content:"粘贴参数",effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(Se,null,null)]})]})]),t("div",{class:B.button,onPointerdown:e=>I(e,b.value)},[t(Q,{content:`复制 ${ie(te.copyNode)}`,effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(Te,null,null)]})]})]),t("div",{class:B.button,onPointerdown:e=>$(e,b.value)},[t(Q,{content:`粘贴 ${ie(te.pasteNode)}`,effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(Ae,null,null)]})]})]),t("div",{class:B.button,style:{display:(d=b.value)!=null&&d.isNPage?"none":"initial"},onPointerdown:e=>T(e,b.value)},[t(Q,{content:`删除 ${ie(te.removeNode)}`,effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(Be,null,null)]})]})])]),t(kt,{page:a.page,ref:M},null)])}},{props:{page:{type:Object}},emits:["removeNode"]}),St=re((a,{expose:w})=>{const y=C(),p=C(),v=C({pointerEvents:"none",position:"absolute",zIndex:"100",inset:"0",boxSizing:"border-box",border:"2px dashed var(--color-8)"}),f=()=>{p.value=null,y.value.remove()},s=l=>{l&&l.append(y.value)};return w({hover:l=>{f(),p.value=l,s(l.elRef.value)},clearHover:f}),()=>t("div",{ref:y,style:v.value},null)});function Tt(a,w){var y;w.isContainerNode?w.add(a):(y=w.parent)==null||y.insert(a,w,"after")}const jt=re((a,{emit:w,expose:y})=>{const p=C(),v=ue([]);v.value=Object.values(Ze).filter(e=>e.preview).map(e=>new e);const f=C([{title:"退出",handleClick:()=>{w("exit")}},{title:"全屏",handleClick:()=>{const e=p.value;e&&(document.fullscreenElement==e?document.exitFullscreen():e.requestFullscreen())}},{title:"编辑",children:[{title:`撤销 ${ie(te.undo)}`,handleClick:()=>{c()}},{title:`恢复 ${ie(te.redo)}`,handleClick:()=>{L()}}]},{title:"文件",children:[{title:"导出",children:[{title:"导出当前编辑页面vue",handleClick:()=>{l.value&&(l.value.resetStyle(),et(l.value).then(e=>{be(e,"Page.zip")}))}},{title:"导出当前编辑页面json",handleClick:()=>{if(!l.value)return;l.value.resetStyle();const e=Z(l.value);be(e,"page.json")}},{title:`导出所有页面json ${ie(te.save)}`,handleClick:()=>{G()}}]},{title:"导入json",handleClick:()=>{tt(e=>{e.text().then(g=>{const S=ae(g);Array.isArray(S)?S.forEach(X=>m(X)):m(S)})})}}]}]),s=C(),_=C([]),l=C();let K=null;const M=ue(),b=new WeakMap,E=e=>{if(l.value=e,M.value=null,!e)return;K=e.component;const g=_.value.findIndex(S=>S.uuid==e.uuid);g!==-1&&_.value.splice(g,1,l.value)},m=e=>{b[e.uuid]=new lt,_.value.push(e),E(e)},h=e=>{const g=_.value.findIndex(S=>S.uuid==e.uuid);if(g!==-1&&_.value.splice(g,1),e.uuid==l.value.uuid){const S=_.value[g-1],X=_.value[g];E(X||S)}},i=e=>{if(_.value=[],!e)return m(new ze);const g=ae(e);Array.isArray(g)?g.forEach(S=>m(S)):m(g)},Y=e=>e?Z(_.value):Z(l.value);Je([l,_],()=>{if(w("change",Z(l.value),Z(_.value)),!D&&l.value){const e=b[l.value.uuid];e==null||e.push(Z(l.value))}else D=!1},{deep:!0,flush:"post"});const G=()=>{_.value.forEach(g=>g.resetStyle());const e=Z(_.value);be(e,"allPages.json")};let D=!1;const c=()=>{if(!l.value)return;const e=b[l.value.uuid];e==null||e.undo(g=>{E(ae(g)),D=!0})},L=()=>{if(!l.value)return;const e=b[l.value.uuid];e==null||e.redo(g=>{E(ae(g)),D=!0})},z=e=>{M.value=e,e.active=!0,Ye(()=>{s.value.control(e)})},x=e=>{l.value.traverse(g=>g.active=!1),z(e.targetNode)},R=ue(),I=C(),P=e=>{R.value=e.targetNode,I.value.hover(e.targetNode)},$=e=>{R.value=null,I.value.clearHover()},r=ue(),T=ue(),V=e=>{r.value=e.targetNode},F=200,o=st(e=>{r.value&&(T.value=e.targetNode,Tt(r.value,T.value),z(r.value))},F),n=e=>{setTimeout(()=>r.value=T.value=null,F)},u=()=>{M.value=null},d=e=>{const{undo:g,redo:S,save:X}=te;e.preventDefault(),e.stopPropagation(),e.code==g.code&&e.shiftKey==g.shiftKey&&e.ctrlKey==g.ctrlKey&&e.altKey==g.altKey&&c(),e.code==S.code&&e.shiftKey==S.shiftKey&&e.ctrlKey==S.ctrlKey&&e.altKey==S.altKey&&L(),e.code==X.code&&e.shiftKey==X.shiftKey&&e.ctrlKey==X.ctrlKey&&e.altKey==X.altKey&&G()};return ge(()=>{document.addEventListener("keydown",d)}),xe(()=>{document.removeEventListener("keydown",d)}),y({setData:i,getData:Y}),()=>ye("div",{ref:p,class:W.editor,onDragend:n,onDragNode:V},[t(vt,{data:f.value},null),t(_e,{width:"330px",direction:"ltr"},{header:()=>t("span",null,[le("组件视图")]),default:()=>t(ot,{class:W["views-tabs"],type:"border-card"},{default:()=>[t(Le,{label:"组件"},{default:()=>[t(yt,{viewNodes:v.value},null)]}),t(Le,{label:"视图结构"},{default:()=>[t(Ie,null,{default:()=>[l.value?t(Kt,{page:l.value,hoveredNode:R.value,selectedNode:M.value,controls:s.value,onHoverNode:P,onSelectNode:x},null):null]})]})]})}),l.value?ye("div",{class:W.container,onMouseleave:$,onHoverNode:P,onSelectNode:x,onDragenterNode:o},t(K,null,null)):"",ye(_e,{width:"330px",onKeydown:e=>e.stopPropagation()},{header:()=>t("span",null,[le("参数")]),default:()=>M.value?ye(M.value.params):""}),t(_e,{width:"30px",direction:"ttb"},{default:()=>[..._.value.map(e=>{var g;return t(at,{color:e.uuid==((g=l.value)==null?void 0:g.uuid)?"var(--color-5)":"var(--color-1)",effect:"dark",style:"cursor: pointer",size:"small",closable:!0,onClick:()=>E(e),onClose:()=>h(e)},{default:()=>[e.props.name]})}),t(it,{size:"small",circle:!0,icon:"Plus",onClick:()=>m(new ze)},null)]}),t(Dt,{ref:s,page:l.value,style:{display:M.value?"block":"none"},onRemoveNode:u},null),t(St,{ref:I,style:{display:R.value?"block":"none"}},null)])},{emits:["change","exit"]});export{jt as S};
