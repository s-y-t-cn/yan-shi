import{d as re,aF as Fe,ao as ke,x as Ve,y as he,aG as He,o as ge,ar as Ne,c as A,e as j,B as t,w as x,l as ee,g as z,aH as We,E as O,aI as qe,G as se,f as $e,k as H,n as q,z as pe,r as E,aa as le,ac as ve,W as J,m as fe,t as je,ax as Re,az as ze,aJ as De,aK as Se,aL as Te,aM as Ae,aN as Be,ap as Ce,an as ue,aO as Ge,R as Ye,L as Je,a1 as ye}from"./index-BJnXyKVp.js";import{a as Q,E as Ie}from"./index-4Fm7eXAf.js";import{E as Oe,a as Ue,t as xe,b as oe,d as Z,f as ae,g as we,m as Qe,e as Ze,h as be,u as et,i as tt,j as Le,N as Me,U as ot,k as lt}from"./animation-CXCGPh_Q.js";import{_ as Ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as Xe}from"./index-BfOb3weB.js";import{E as nt}from"./el-checkbox-Bk2i9P2Q.js";import"./el-tooltip-DOnXmCDG.js";/* empty css                  */import{E as st}from"./index-C7ZdmN6q.js";import{E as at}from"./index-BiJnfdqe.js";const te={drawerToggle:{code:"Tab",key:"Tab",shiftKey:!1,ctrlKey:!1,altKey:!1},copyNode:{code:"KeyC",key:"c",shiftKey:!1,ctrlKey:!0,altKey:!1},pasteNode:{code:"KeyV",key:"v",shiftKey:!1,ctrlKey:!0,altKey:!1},removeNode:{code:"Delete",key:"Delete",shiftKey:!1,ctrlKey:!1,altKey:!1},undo:{code:"KeyZ",key:"z",shiftKey:!1,ctrlKey:!0,altKey:!1},redo:{code:"KeyY",key:"y",shiftKey:!1,ctrlKey:!0,altKey:!1},save:{code:"KeyS",key:"s",shiftKey:!1,ctrlKey:!0,altKey:!1}},ie=s=>`快捷键：${s.shiftKey?"Shift + ":""}${s.ctrlKey?"Ctrl + ":""}${s.altKey?"Alt + ":""}${s.key}`,it={key:0,class:"header"},rt={class:"content"},ut=re({__name:"Drawer",props:Fe({width:{type:String,default:"30%"},direction:{type:String,default:"rtl"}},{modelValue:{type:Boolean,default:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(s){ke(l=>({"67bb54b2":m.value}));const b=s,h=Ve(),m=he(()=>h.header?"35px":"0px"),f=he(()=>({width:b.direction=="rtl"||b.direction=="ltr"?b.width:"100%",height:b.direction=="ttb"||b.direction=="btt"?b.width:"100%"})),p=He(s,"modelValue"),n=te.drawerToggle,_=l=>{l.code==n.code&&l.shiftKey==n.shiftKey&&l.ctrlKey==n.ctrlKey&&l.altKey==n.altKey&&(l.preventDefault(),p.value=!p.value)};return ge(()=>{document.addEventListener("keydown",_)}),Ne(()=>{document.removeEventListener("keydown",_)}),(l,K)=>(A(),j("div",{class:q(["drawer",[{hide:!p.value},b.direction]]),style:pe({width:f.value.width,height:f.value.height})},[t(z(Q),{content:`${z(ie)(z(n))}`,effect:"light",teleported:!1},{default:x(()=>[s.direction=="rtl"||s.direction=="ltr"?(A(),ee(z(O),{key:0,class:"switch",size:"12",onClick:K[0]||(K[0]=R=>p.value=!p.value)},{default:x(()=>[t(z(We))]),_:1})):s.direction=="ttb"||s.direction=="btt"?(A(),ee(z(O),{key:1,class:"switch",size:"12",onClick:K[1]||(K[1]=R=>p.value=!p.value)},{default:x(()=>[t(z(qe))]),_:1})):se("",!0)]),_:1},8,["content"]),l.$slots.header?(A(),j("div",it,[$e(l.$slots,"header",{},void 0,!0)])):se("",!0),H("div",rt,[t(z(Ie),null,{default:x(()=>[$e(l.$slots,"default",{},void 0,!0)]),_:3})])],6))}}),_e=Ke(ut,[["__scopeId","data-v-4f3edd37"]]),ct={__name:"PieMenu",props:{data:{type:Array,default(){return[{title:"菜单1",handleClick:()=>{},children:[{title:"菜单1-1",handleClick:()=>{}},{title:"菜单1-2",handleClick:()=>{}}]},{title:"菜单2",handleClick:()=>{},children:[{title:"菜单2-1",handleClick:()=>{}},{title:"菜单2-2",handleClick:()=>{}}]}]}}},emits:["click"],setup(s,{emit:b}){ke(d=>({"4a24d064":y.value,"5145de5e":z(l)}));const h=s,m=b,f=2*Math.PI;let p=E(),n=E(),_=E(80),l=he(()=>`${_.value}px`),K=he(()=>_.value/2),R=E(70),g=E(f);const C=new WeakMap,y=E("15px"),w=d=>{const L=!C.get(d),{level:M,index:N,pIndex:k}=d.dataset,I=k.split("-");C.set(d,L),p.value.querySelectorAll("div[data-level]").forEach($=>{I.includes($.dataset.index)||d===$||($.dataset.level>Number(M)&&$.classList.remove("show"),$.classList.remove("active"),C.set($,!1))}),L?(d.classList.add("active"),p.value.querySelectorAll(`div[data-level='${+M+1}'][data-p-index*='${N}']`).forEach(u=>u.classList.add("show"))):d.classList.remove("active")},r=()=>Math.random().toString(16).replace(".","");let Y=(d,L,M)=>{const N=g.value/d.length,k=N>=f?f-.001:N,I=d.length==1?1:0;for(let P=0,$=d;P<$.length;P++){let u=K.value+R.value*L,T=P*k,V=(P+1)*k,F=u+Math.sin(T)*u,o=u-Math.cos(T)*u,a=u+Math.sin(V)*u,c=u-Math.cos(V)*u,v=document.createElement("div");v.classList.add("menu-item"),v.dataset.level=+L,v.dataset.index=r(),v.dataset.pIndex=M.dataset.pIndex?`${M.dataset.pIndex}-${M.dataset.index}`:`${M.dataset.index}`,v.style.setProperty("width",`${u*2}px`),v.style.setProperty("height",`${u*2}px`),v.style.setProperty("z-index",-L),v.style.setProperty("clip-path",`path("M ${u} ${u} L ${F} ${o} A ${u} ${u} 0 ${I} 1 ${a} ${c} z")`);const e=document.createElement("div");e.className="item-bg",L%2==0?e.classList.add("bg-even"):e.classList.add("bg-odd"),V=(P+1)*k-.01,F=u+Math.sin(T)*u,o=u-Math.cos(T)*u,a=u+Math.sin(V)*u,c=u-Math.cos(V)*u,e.style.setProperty("width",`${u*2}px`),e.style.setProperty("height",`${u*2}px`),e.style.setProperty("clip-path",`path("M ${u} ${u} L ${F} ${o} A ${u} ${u} 0 ${I} 1 ${a} ${c} z")`),v.appendChild(e);let i=(P+1/2)*k,S=u-R.value/2,X=document.createElement("div");X.style.left=u+Math.sin(i)*S+"px",X.style.top=u-Math.cos(i)*S+"px",X.style.setProperty("position","absolute"),X.style.textAlign="center",X.style.transform=`translate(-50%, -50%) rotate(${-Math.PI/2+i}rad)`;let U=document.createElement("div"),ce=i>Math.PI?Math.PI:0;U.style.display="inline-block",U.innerText=$[P].title,U.style.width=`${R.value-10}px`,U.style.transform=`rotateY(${ce}rad) rotateX(${ce}rad)`,X.appendChild(U),v.appendChild(X),v.addEventListener("pointerdown",()=>{var de,ne;(ne=(de=$[P]).handleClick)==null||ne.call(de),m("click",$[P].title)}),v.addEventListener("pointerdown",()=>w(v)),p.value.insertAdjacentElement("afterbegin",v),$[P].children&&Y($[P].children,L+1,v)}};const G=(d,L)=>{let M={offsetX:0,offsetY:0};const N=k=>{const I=k.clientX,P=k.clientY,{offsetX:$,offsetY:u}=M,T=d.getBoundingClientRect(),V=T.left,F=T.top,o=T.width,a=T.height,c=document.documentElement.clientWidth,v=document.documentElement.clientHeight,e=-V+$,i=-F+u,S=c-V-o+$,X=v-F-a+u,U=de=>{let ne=$+de.clientX-I,me=u+de.clientY-P;ne=Math.min(Math.max(ne,e),S),me=Math.min(Math.max(me,i),X),M={offsetX:ne,offsetY:me},d&&(d.style.transform=`translate(${ne}px, ${me}px)`)},ce=()=>{document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",ce)};document.addEventListener("mousemove",U),document.addEventListener("mouseup",ce)};L.addEventListener("mousedown",N)},D=()=>{G(p.value,n.value);const d="0",L=r();n.value.dataset.level=d,n.value.dataset.index=L,n.value.dataset.pIndex="",Y(h.data,+d+1,n.value),n.value.addEventListener("pointerdown",M=>w(n.value))};return ge(()=>{D()}),(d,L)=>(A(),j("div",{ref_key:"rongQi",ref:p,class:"rong-qi"},[H("div",{ref_key:"center",ref:n,class:"center",draggable:"false",onDblclick:L[0]||(L[0]=M=>m("click","center"))},[$e(d.$slots,"center",{draggable:"false"},()=>[le("菜单")],!0)],544)],512))}},dt=Ke(ct,[["__scopeId","data-v-9e36371f"]]),vt="_editor_o961q_1",ft="_container_o961q_93",pt="_views_o961q_115",W={editor:vt,container:ft,views:pt,"views-title":"_views-title_o961q_123","views-container":"_views-container_o961q_131","views-tabs":"_views-tabs_o961q_147"},mt=re({__name:"ComponentViews",props:["viewNodes"],setup(s){return(b,h)=>{const m=Xe,f=Oe,p=Ue;return A(),ee(p,{"model-value":["1","2","3","4","5"],class:q(z(W).views)},{default:x(()=>[t(f,{name:"1"},{title:x(()=>[t(m,{class:q(z(W)["views-title"]),tag:"b"},{default:x(()=>[le(" 布局 ")]),_:1},8,["class"])]),default:x(()=>[H("div",{class:q(z(W)["views-container"])},[(A(!0),j(J,null,ve(s.viewNodes,n=>(A(),j(J,{key:n.uuid},[n.isLayoutNode?(A(),ee(fe(n.view),{key:0})):se("",!0)],64))),128))],2)]),_:1}),t(f,{name:"2"},{title:x(()=>[t(m,{class:q(z(W)["views-title"]),tag:"b"},{default:x(()=>[le(" 表单 ")]),_:1},8,["class"])]),default:x(()=>[H("div",{class:q(z(W)["views-container"])},[(A(!0),j(J,null,ve(s.viewNodes,n=>(A(),j(J,{key:n.uuid},[n.isFormNode?(A(),ee(fe(n.view),{key:0})):se("",!0)],64))),128))],2)]),_:1}),t(f,{name:"3"},{title:x(()=>[t(m,{class:q(z(W)["views-title"]),tag:"b"},{default:x(()=>[le(" 图表 ")]),_:1},8,["class"])]),default:x(()=>[H("div",{class:q(z(W)["views-container"])},[(A(!0),j(J,null,ve(s.viewNodes,n=>(A(),j(J,{key:n.uuid},[n.isChartNode?(A(),ee(fe(n.view),{key:0})):se("",!0)],64))),128))],2)]),_:1}),t(f,{name:"4"},{title:x(()=>[t(m,{class:q(z(W)["views-title"]),tag:"b"},{default:x(()=>[le(" 数据展示 ")]),_:1},8,["class"])]),default:x(()=>[H("div",{class:q(z(W)["views-container"])},[(A(!0),j(J,null,ve(s.viewNodes,n=>(A(),j(J,{key:n.uuid},[n.isDataNode?(A(),ee(fe(n.view),{key:0})):se("",!0)],64))),128))],2)]),_:1}),t(f,{name:"5"},{title:x(()=>[t(m,{class:q(z(W)["views-title"]),tag:"b"},{default:x(()=>[le(" 导航 ")]),_:1},8,["class"])]),default:x(()=>[H("div",{class:q(z(W)["views-container"])},[(A(!0),j(J,null,ve(s.viewNodes,n=>(A(),j(J,{key:n.uuid},[n.isNavigationNode?(A(),ee(fe(n.view),{key:0})):se("",!0)],64))),128))],2)]),_:1})]),_:1},8,["class"])}}}),yt=["onMouseover","onClick"],ht=["onPointerdown"],gt=["onPointerdown"],wt=["onPointerdown"],bt=["onPointerdown"],_t=["onPointerdown"],Pt=["onPointerdown"],$t=["onPointerdown"],Nt=re({__name:"ViewsTree",props:["page","hoveredNode","selectedNode","controls"],emits:["hoverNode","selectNode"],setup(s,{emit:b}){const h=s,m=b,f=(y,w,r)=>r=="inner"?w.data.isContainerNode:!w.data.isNPage,p=(y,w,r)=>{r=="inner"?y.data.parent=w.data:y.data.parent=w.data.parent},n=(y,w)=>{var r;return(r=h.controls)==null?void 0:r.moveBefore(y,w)},_=(y,w)=>{var r;return(r=h.controls)==null?void 0:r.moveAfter(y,w)},l=(y,w)=>{var r;return(r=h.controls)==null?void 0:r.copyNode(y,w)},K=(y,w)=>{var r;return(r=h.controls)==null?void 0:r.cloneNode(y,w)},R=(y,w)=>{var r;return(r=h.controls)==null?void 0:r.pasteNode(y,w)},g=(y,w)=>{var r;return(r=h.controls)==null?void 0:r.pasteNodeParams(y,w)},C=(y,w)=>{var r;return(r=h.controls)==null?void 0:r.removeNode(y,w)};return(y,w)=>{const r=O,Y=Q,G=nt;return A(),ee(G,{style:{width:"500px"},data:[s.page],props:{label:"name"},"node-key":"uuid","expand-on-click-node":!1,"default-expand-all":"",draggable:"","allow-drop":f,onNodeDrop:p},{default:x(({node:D,data:d})=>{var L,M;return[H("div",{class:q(["n-tree-node",{hovered:((L=s.hoveredNode)==null?void 0:L.uuid)==d.uuid,selected:((M=s.selectedNode)==null?void 0:M.uuid)==d.uuid}]),style:{flex:"1"},onMouseover:N=>m("hoverNode",{targetNode:Ce(d)}),onClick:N=>m("selectNode",{targetNode:Ce(d)})},[H("span",null,je(D.label),1),H("div",null,[H("div",{class:"button",style:pe({display:d.isNPage?"none":"initial"}),onPointerdown:N=>n(N,d)},[t(Y,{content:"上移",effect:"light",teleported:!1},{default:x(()=>[t(r,{size:13,color:"#08f"},{default:x(()=>[t(z(Re))]),_:1})]),_:1})],44,ht),H("div",{class:"button",style:pe({display:d.isNPage?"none":"initial"}),onPointerdown:N=>_(N,d)},[t(Y,{content:"下移",effect:"light",teleported:!1},{default:x(()=>[t(r,{size:13,color:"#08f"},{default:x(()=>[t(z(ze))]),_:1})]),_:1})],44,gt),H("div",{class:"button",style:pe({display:d.isNPage?"none":"initial"}),onPointerdown:N=>K(N,d)},[t(Y,{content:"克隆",effect:"light",teleported:!1},{default:x(()=>[t(r,{size:13,color:"#a50"},{default:x(()=>[t(z(De))]),_:1})]),_:1})],44,wt),H("div",{class:"button",onPointerdown:N=>g(N,d)},[t(Y,{content:"粘贴参数",effect:"light",teleported:!1},{default:x(()=>[t(r,{size:13,color:"#a50"},{default:x(()=>[t(z(Se))]),_:1})]),_:1})],40,bt),H("div",{class:"button",onPointerdown:N=>l(N,d)},[t(Y,{content:"复制",effect:"light",teleported:!1},{default:x(()=>[t(r,{size:13,color:"#a50"},{default:x(()=>[t(z(Te))]),_:1})]),_:1})],40,_t),H("div",{class:"button",onPointerdown:N=>R(N,d)},[t(Y,{content:"粘贴",effect:"light",teleported:!1},{default:x(()=>[t(r,{size:13,color:"#a50"},{default:x(()=>[t(z(Ae))]),_:1})]),_:1})],40,Pt),H("div",{class:"button",style:pe({display:d.isNPage?"none":"initial"}),onPointerdown:N=>C(N,d)},[t(Y,{content:"删除",effect:"light",teleported:!1},{default:x(()=>[t(r,{size:13,color:"#a00"},{default:x(()=>[t(z(Be))]),_:1})]),_:1})],44,$t)])],42,yt)]}),_:1},8,["data"])}}}),xt=Ke(Nt,[["__scopeId","data-v-f48b45fa"]]),Kt="_controls_1v4du_1",Et="_button_1v4du_95",Ct="_guide_1v4du_129",B={controls:Kt,"right-resize":"_right-resize_1v4du_41","bottom-resize":"_bottom-resize_1v4du_59","corner-resize":"_corner-resize_1v4du_77","button-list":"_button-list_1v4du_95",button:Et,guide:Ct,"guide-horizontal":"_guide-horizontal_1v4du_143","guide-vertical":"_guide-vertical_1v4du_157"},Ee=250;function Lt(s,b,h=!0,m){let f={offsetX:0,offsetY:0};const p=n=>{const _=window.getComputedStyle(s),l=Number.parseFloat(_.getPropertyValue("left")),K=Number.parseFloat(_.getPropertyValue("top"));if(_.position!="absolute")return;f={offsetX:l,offsetY:K};const R=n.clientX,g=n.clientY,{offsetX:C,offsetY:y}=f,w=s.getBoundingClientRect(),r=w.left,Y=w.top,G=w.width,D=w.height,d=document.documentElement.clientWidth,L=document.documentElement.clientHeight,M=-r+C,N=-Y+y,k=d-r-G+C,I=L-Y-D+y,P=xe(u=>{let T=C+u.clientX-R,V=y+u.clientY-g;h||(T=Math.min(Math.max(T,M),k),V=Math.min(Math.max(V,N),I)),f={offsetX:T,offsetY:V},s&&(s.style.left=`${T}px`,s.style.top=`${V}px`),m==null||m(u)},Ee),$=()=>{document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",$)};document.addEventListener("mousemove",P),document.addEventListener("mouseup",$)};return b.addEventListener("mousedown",p),()=>{b.removeEventListener("mousedown",p)}}function Mt(s,b){const h=m=>{if(window.getComputedStyle(s).position=="absolute")return;s.setAttribute("draggable","true");const f=p=>{s.setAttribute("draggable","false"),document.removeEventListener("mouseup",f)};document.addEventListener("mouseup",f)};return b.addEventListener("mousedown",h),()=>{b.removeEventListener("mousedown",h)}}function Pe(s,b,h,m){const f=p=>{const n=window.getComputedStyle(s),_=Number.parseFloat(n.getPropertyValue("width")),l=Number.parseFloat(n.getPropertyValue("height")),K=p.clientX,R=p.clientY,g=xe(y=>{let w=y.clientX-K+_,r=y.clientY-R+l;s&&(h===0?s.style.width=`${w}px`:h===1?s.style.height=`${r}px`:(s.style.width=`${w}px`,s.style.height=`${r}px`)),m==null||m(y)},Ee),C=()=>{document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",C)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",C)};return b.addEventListener("mousedown",f),()=>{b.removeEventListener("mousedown",f)}}function kt(s,b){const h=xe(m=>{m.preventDefault(),m.stopPropagation();const{deltaY:f}=m,p=5e-4,l=window.getComputedStyle(s).getPropertyValue("transform").match(/matrix\(([-\d\.]+), ([-\d\.]+), ([-\d\.]+), ([-\d\.]+), ([-\d\.]+), ([-\d\.]+)\)/);let K=+(l==null?void 0:l[1])||1;const R=+(l==null?void 0:l[2])||0,g=+(l==null?void 0:l[3])||0;let C=+(l==null?void 0:l[4])||1;const y=+(l==null?void 0:l[5])||0,w=+(l==null?void 0:l[6])||0;K+=-f*p,C+=-f*p,s.style.transform=`matrix(${K}, ${R}, ${g}, ${C}, ${y}, ${w})`,b==null||b(m)},Ee);return s.addEventListener("wheel",h),()=>{s.removeEventListener("wheel",h)}}const Rt=re((s,{expose:b})=>{const h=E(),m=E(),f=E(),p=E(),n=5,_=()=>{h.value.style.visibility=m.value.style.visibility=f.value.style.visibility=p.value.style.visibility="hidden",h.value.style.left=m.value.style.left=f.value.style.top=p.value.style.top="0"};return b({hideGuides:_,showGuides:K=>{if(!(K&&h.value&&m.value&&f.value&&p.value))return;_();const R=K.elRef.value,g=s.page.getAllNodes().filter(D=>!D.isNPage&&D!==K).map(D=>D.elRef.value),{left:C,right:y,top:w,bottom:r,width:Y,height:G}=R.getBoundingClientRect();for(let D=0,d=g.length;D<d;D++){const L=g[D];if(!L)continue;const{left:M,right:N,top:k,bottom:I}=L.getBoundingClientRect();let P,$=s.page.elRef.value;(P=Math.abs(M-C)<=n&&M||Math.abs(N-C)<=n&&N)&&(h.value.style.visibility="visible",oe(h.value,P,"left",$),oe(K.elRef.value,P,"left",$)),(P=Math.abs(M-y)<=n&&M||Math.abs(N-y)<=n&&N)&&(m.value.style.visibility="visible",oe(m.value,P,"left",$),oe(K.elRef.value,P-Y,"left",$)),(P=Math.abs(k-w)<=n&&k||Math.abs(I-w)<=n&&I)&&(f.value.style.visibility="visible",oe(f.value,P,"top",$),oe(K.elRef.value,P,"top",$)),(P=Math.abs(k-r)<=n&&k||Math.abs(I-r)<=n&&I)&&(p.value.style.visibility="visible",oe(p.value,P,"top",$),oe(K.elRef.value,P-G,"top",$))}K.updateStyle()}}),()=>t(J,null,[t("div",{ref:h,class:`${B.guide} ${B["guide-vertical"]}`},null),t("div",{ref:m,class:`${B.guide} ${B["guide-vertical"]}`},null),t("div",{ref:f,class:`${B.guide} ${B["guide-horizontal"]}`},null),t("div",{ref:p,class:`${B.guide} ${B["guide-horizontal"]}`},null)])},{props:{page:{type:Object}}}),zt=re((s,{attrs:b,emit:h,expose:m})=>{const f=E(),p=E(),n=E(),_=E(),l=E(),K=E(),R=E(),g=ue(),C=E("-30px"),y=()=>{const o=p.value.style;o.setProperty("top",C.value),o.setProperty("bottom","auto"),o.setProperty("left","auto"),o.setProperty("right","0");const{top:a,bottom:c,left:v,right:e}=s.page.elRef.getBoundingClientRect(),{top:i,bottom:S,left:X,right:U}=p.value.getBoundingClientRect();i<a&&(o.setProperty("top","auto"),o.setProperty("bottom",C.value)),S>c&&(o.setProperty("top",C.value),o.setProperty("bottom","auto")),X<v&&(o.setProperty("left","0"),o.setProperty("right","auto")),U>e&&(o.setProperty("left","auto"),o.setProperty("right","0"))},w=E({...b.style}),r=[],Y=()=>{g.value=null,f.value.remove(),r.forEach(o=>o())},G=o=>{o&&(o.append(f.value),Ye(y))},D=()=>{g.value&&g.value.updateStyle()},d=o=>{var a;(a=R.value)==null||a.showGuides(g.value),D()},L=o=>{Y(),R.value.hideGuides(),g.value=o,G(o.elRef.value);const a=Pe(o.elRef.value,_.value,0,D),c=Pe(o.elRef.value,l.value,1,D),v=Pe(o.elRef.value,K.value,2,D),e=Lt(o.elRef.value,n.value,!0,d);r.push(e,a,c,v),o.isNPage?r.push(kt(o.elRef.value,D)):r.push(Mt(o.elRef.value,n.value))},M=(o,a)=>{if(o.preventDefault(),o.stopPropagation(),!a)return;const c=a.parent,v=c.children.indexOf(a),e=c.children[v-1];e&&c.insert(a,e)},N=(o,a)=>{if(o.preventDefault(),o.stopPropagation(),!a)return;const c=a.parent,v=c.children.indexOf(a),e=c.children[v+1];e&&c.insert(a,e,"after")},k=E(""),I=(o,a)=>{if(o.preventDefault(),o.stopPropagation(),!a)return;const c=Z(a);k.value=c},P=(o,a)=>{if(o.preventDefault(),o.stopPropagation(),!a)return;const c=Z(a),v=ae(c);k.value=c,v.traverse(i=>i.uuid=we()),a.parent.insert(v,a,"after")},$=(o,a)=>{if(o.preventDefault(),o.stopPropagation(),!a||!k.value)return;const c=ae(k.value);c.traverse(v=>v.uuid=we()),a!=null&&a.isContainerNode?a.isNPage&&c.isNPage?(a.copy(c),[...c.children].forEach(v=>a.add(v))):c.isNPage||a.add(c):a.parent.add(c)},u=(o,a)=>{if(o.preventDefault(),o.stopPropagation(),!a||!k.value)return;const c=ae(k.value);c.traverse(v=>v.uuid=we()),a.copy(c)},T=(o,a)=>{if(o.preventDefault(),o.stopPropagation(),!a)return;Y();const c=a.parent;c==null||c.remove(a),h("removeNode")},V=o=>{const{copyNode:a,pasteNode:c,removeNode:v}=te;o.code==a.code&&o.shiftKey==a.shiftKey&&o.ctrlKey==a.ctrlKey&&o.altKey==a.altKey&&I(o,g.value),o.code==c.code&&o.shiftKey==c.shiftKey&&o.ctrlKey==c.ctrlKey&&o.altKey==c.altKey&&$(o,g.value),o.code==v.code&&o.shiftKey==v.shiftKey&&o.ctrlKey==v.ctrlKey&&o.altKey==v.altKey&&T(o,g.value)};ge(()=>{document.addEventListener("keydown",V)}),Ne(()=>{document.removeEventListener("keydown",V)}),m({control:L,clearControl:Y,moveBefore:M,moveAfter:N,copyNode:I,cloneNode:P,pasteNode:$,pasteNodeParams:u,removeNode:T});const F=E("#fff");return()=>{var o,a,c,v,e;return t("div",{ref:f,class:B.controls,style:w.value},[t("div",{ref:_,class:B["right-resize"]},null),t("div",{ref:l,class:B["bottom-resize"]},null),t("div",{ref:K,class:B["corner-resize"]},null),t("div",{ref:p,class:B["button-list"]},[t("div",{ref:n,class:B.button},[t(Xe,{style:`--el-text-color: ${F.value};`},{default:()=>{var i;return[(i=g.value)==null?void 0:i.name]}})]),t("div",{ref:n,class:B.button},[t(Q,{content:"拖拽",effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(Ge,null,null)]})]})]),t("div",{class:B.button,style:{display:(o=g.value)!=null&&o.isNPage?"none":"initial"},onPointerdown:i=>M(i,g.value)},[t(Q,{content:"上移",effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(Re,null,null)]})]})]),t("div",{class:B.button,style:{display:(a=g.value)!=null&&a.isNPage?"none":"initial"},onPointerdown:i=>N(i,g.value)},[t(Q,{content:"下移",effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(ze,null,null)]})]})]),t("div",{class:B.button,style:{display:(c=g.value)!=null&&c.isNPage?"none":"initial"},onPointerdown:i=>P(i,g.value)},[t(Q,{content:"克隆",effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(De,null,null)]})]})]),t("div",{class:B.button,style:{display:(v=g.value)!=null&&v.isNPage?"none":"initial"},onPointerdown:i=>u(i,g.value)},[t(Q,{content:"粘贴参数",effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(Se,null,null)]})]})]),t("div",{class:B.button,onPointerdown:i=>I(i,g.value)},[t(Q,{content:`复制 ${ie(te.copyNode)}`,effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(Te,null,null)]})]})]),t("div",{class:B.button,onPointerdown:i=>$(i,g.value)},[t(Q,{content:`粘贴 ${ie(te.pasteNode)}`,effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(Ae,null,null)]})]})]),t("div",{class:B.button,style:{display:(e=g.value)!=null&&e.isNPage?"none":"initial"},onPointerdown:i=>T(i,g.value)},[t(Q,{content:`删除 ${ie(te.removeNode)}`,effect:"light",teleported:!1},{default:()=>[t(O,{size:15,color:`${F.value}`},{default:()=>[t(Be,null,null)]})]})])]),t(Rt,{page:s.page,ref:R},null)])}},{props:{page:{type:Object}},emits:["removeNode"]}),Dt=re((s,{expose:b})=>{const h=E(),m=E(),f=E({pointerEvents:"none",position:"absolute",zIndex:"100",inset:"0",boxSizing:"border-box",border:"2px dashed var(--color-8)"}),p=()=>{m.value=null,h.value.remove()},n=l=>{l&&l.append(h.value)};return b({hover:l=>{p(),m.value=l,n(l.elRef.value)},clearHover:p}),()=>t("div",{ref:h,style:f.value},null)});function St(s,b){var h;b.isContainerNode?b.add(s):(h=b.parent)==null||h.insert(s,b,"after")}const qt=re((s,{emit:b,expose:h})=>{const m=E(),f=ue([]);f.value=Object.values(Qe).filter(e=>e.preview).map(e=>new e);const p=E([{title:"退出",handleClick:()=>{b("exit")}},{title:"全屏",handleClick:()=>{const e=m.value;e&&(document.fullscreenElement==e?document.exitFullscreen():e.requestFullscreen())}},{title:"编辑",children:[{title:`撤销 ${ie(te.undo)}`,handleClick:()=>{d()}},{title:`恢复 ${ie(te.redo)}`,handleClick:()=>{L()}}]},{title:"文件",children:[{title:"导出",children:[{title:"导出当前编辑页面vue",handleClick:()=>{l.value&&(l.value.resetStyle(),Ze(l.value).then(e=>{be(e,"Page.zip")}))}},{title:"导出当前编辑页面json",handleClick:()=>{if(!l.value)return;l.value.resetStyle();const e=Z(l.value);be(e,"page.json")}},{title:`导出所有页面json ${ie(te.save)}`,handleClick:()=>{G()}}]},{title:"导入json",handleClick:()=>{et(e=>{e.text().then(i=>{const S=ae(i);Array.isArray(S)?S.forEach(X=>y(X)):y(S)})})}}]}]),n=E(),_=E([]),l=E();let K=null;const R=ue(),g=new WeakMap,C=e=>{if(l.value=e,R.value=null,!e)return;K=e.component;const i=_.value.findIndex(S=>S.uuid==e.uuid);i!==-1&&_.value.splice(i,1,l.value)},y=e=>{g[e.uuid]=new ot,_.value.push(e),C(e)},w=e=>{const i=_.value.findIndex(S=>S.uuid==e.uuid);if(i!==-1&&_.value.splice(i,1),e.uuid==l.value.uuid){const S=_.value[i-1],X=_.value[i];C(X||S)}},r=e=>{if(_.value=[],!e)return y(new Me);const i=ae(e);Array.isArray(i)?i.forEach(S=>y(S)):y(i)},Y=e=>e?Z(_.value):Z(l.value);Je([l,_],()=>{if(b("change",Z(l.value),Z(_.value)),!D&&l.value){const e=g[l.value.uuid];e==null||e.push(Z(l.value))}else D=!1},{deep:!0,flush:"post"});const G=()=>{_.value.forEach(i=>i.resetStyle());const e=Z(_.value);be(e,"allPages.json")};let D=!1;const d=()=>{if(!l.value)return;const e=g[l.value.uuid];e==null||e.undo(i=>{C(ae(i)),D=!0})},L=()=>{if(!l.value)return;const e=g[l.value.uuid];e==null||e.redo(i=>{C(ae(i)),D=!0})},M=e=>{R.value=e,e.active=!0,Ye(()=>{n.value.control(e)})},N=e=>{l.value.traverse(i=>i.active=!1),M(e.targetNode)},k=ue(),I=E(),P=e=>{k.value=e.targetNode,I.value.hover(e.targetNode)},$=e=>{k.value=null,I.value.clearHover()},u=ue(),T=ue(),V=e=>{u.value=e.targetNode},F=200,o=lt(e=>{u.value&&(T.value=e.targetNode,St(u.value,T.value),M(u.value))},F),a=e=>{setTimeout(()=>u.value=T.value=null,F)},c=()=>{R.value=null},v=e=>{const{undo:i,redo:S,save:X}=te;e.preventDefault(),e.stopPropagation(),e.code==i.code&&e.shiftKey==i.shiftKey&&e.ctrlKey==i.ctrlKey&&e.altKey==i.altKey&&d(),e.code==S.code&&e.shiftKey==S.shiftKey&&e.ctrlKey==S.ctrlKey&&e.altKey==S.altKey&&L(),e.code==X.code&&e.shiftKey==X.shiftKey&&e.ctrlKey==X.ctrlKey&&e.altKey==X.altKey&&G()};return ge(()=>{document.addEventListener("keydown",v)}),Ne(()=>{document.removeEventListener("keydown",v)}),h({setData:r,getData:Y}),()=>ye("div",{ref:m,class:W.editor,onDragend:a,onDragNode:V},[t(dt,{data:p.value},null),t(_e,{width:"330px",direction:"ltr"},{header:()=>t("span",null,[le("组件视图")]),default:()=>t(tt,{class:W["views-tabs"],type:"border-card"},{default:()=>[t(Le,{label:"组件"},{default:()=>[t(mt,{viewNodes:f.value},null)]}),t(Le,{label:"视图结构"},{default:()=>[t(Ie,null,{default:()=>[l.value?t(xt,{page:l.value,hoveredNode:k.value,selectedNode:R.value,controls:n.value,onHoverNode:P,onSelectNode:N},null):null]})]})]})}),l.value?ye("div",{class:W.container,onMouseleave:$,onHoverNode:P,onSelectNode:N,onDragenterNode:o},t(K,null,null)):"",ye(_e,{width:"330px",onKeydown:e=>e.stopPropagation()},{header:()=>t("span",null,[le("参数")]),default:()=>R.value?ye(R.value.params):""}),t(_e,{width:"30px",direction:"ttb"},{default:()=>[..._.value.map(e=>{var i;return t(st,{color:e.uuid==((i=l.value)==null?void 0:i.uuid)?"var(--color-5)":"var(--color-1)",effect:"dark",style:"cursor: pointer",size:"small",closable:!0,onClick:()=>C(e),onClose:()=>w(e)},{default:()=>[e.props.name]})}),t(at,{size:"small",circle:!0,icon:"Plus",onClick:()=>y(new Me)},null)]}),t(zt,{ref:n,page:l.value,style:{display:R.value?"block":"none"},onRemoveNode:c},null),t(Dt,{ref:I,style:{display:k.value?"block":"none"}},null)])},{emits:["change","exit"]});export{qt as S};
