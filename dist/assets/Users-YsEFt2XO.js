import{d as G,r as s,o as H,C as J,g as o,c as K,e as Q,k as X,B as t,ag as C,w as n,aa as I,bW as Y,c6 as Z,aj as _,c3 as ee,bV as ae,aE as te,c7 as le,ai as oe}from"./index-BJnXyKVp.js";import{v as re}from"./el-loading-D3qADI_q.js";/* empty css                   *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import{a as se}from"./el-checkbox-Bk2i9P2Q.js";/* empty css                       *//* empty css                      */import{E as ne}from"./el-popover-1abEW1ha.js";/* empty css                  *//* empty css                 */import{h}from"./index-DIjjrsno.js";import{S as ie}from"./SytTable-D1uKAP1t.js";import{E as de}from"./index-XTd2ODOz.js";import{E as me}from"./index-BiJnfdqe.js";import{E as pe}from"./index-D3usf8bu.js";import{E as ue,a as ce}from"./index-ICkUlJyf.js";import{b as fe}from"./index-BR0Y44mj.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BixkNvtl.js";import"./index-4Fm7eXAf.js";import"./error-DShZK1re.js";import"./index-CSU0GQeE.js";import"./index-C7ZdmN6q.js";import"./castArray-BQHs20Uc.js";import"./scroll-Sz8zLlxi.js";import"./isEqual-DgoZLpwi.js";import"./_Uint8Array-DJuCLRja.js";import"./_baseIteratee-By9Ip0_B.js";import"./index-DuCQwYUO.js";import"./index-CwgBQ-kl.js";import"./_initCloneObject-Ctsa7_iQ.js";import"./_commonjsHelpers-BosuxZz1.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./_baseClone-Brygbwuc.js";import"./vnode-zmnWa8q4.js";const _e={"element-loading-text":"加载中..."},ve={class:"tools"},we=G({__name:"Users",setup(be){let P=s([{title:"用户名",dataIndex:"username"},{title:"角色",dataIndex:"rolesNames"},{title:"昵称",dataIndex:"nickname"},{title:"部门",dataIndex:"department"},{title:"职位",dataIndex:"position"}]),p=s(""),w=s([]),b=s(!0),V=s(1),y=s(10),U=s(0),d=s(!1),x=s(null),f=s("");const z=s({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],roles:[{required:!0,message:"请输入角色",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],department:[{required:!0,message:"请输入部门",trigger:"blur"}],position:[{required:!0,message:"请输入职位",trigger:"blur"}]}),E=s([]),k=s([]),B=async()=>{await ee().then(a=>{a.code==200&&(E.value=a.data,k.value=ae(a.data))})};let D=()=>({username:"",password:"",nickname:"",roles:[],department:"软件部",position:"职员"}),r=s(D());const F=async()=>{const a={currentPage:V.value,pageSize:y.value};p.value&&(a.username=p.value),await te(a).then(e=>{e.code===200&&(U.value=e.data.total,w.value=e.data.data.map(i=>(i.encrypedPassword=i.password,i.rolesNames=i.roles.map(c=>{var g;return(g=E.value.find(v=>v.id==c))==null?void 0:g.name}),i)))})},u=async()=>{await B(),await F(),b.value=!1},R=()=>{f.value="添加账号",d.value=!0,r.value=D()},T=a=>{f.value="编辑账号",d.value=!0,r.value=Y(a)},q=async()=>{let a=Object.assign({},r.value);a.password=await h(a.password),le(a).then(e=>{e.code==200&&(_({type:"success",message:"添加成功"}),u())})},N=async()=>{let a=Object.assign({},r.value);a.password!=a.encrypedPassword&&(a.password=await h(a.password)),Reflect.deleteProperty(a,"encrypedPassword"),oe(a).then(e=>{e.code==200&&(u(),_({type:"success",message:"编辑成功"}))})},S=a=>{a.id?Z({id:a.id}).then(e=>{e.code==200&&(u(),_({type:"success",message:"删除成功"}))}):_({type:"error",message:"不存在的id"})},j=a=>{a&&a.validate(e=>{e?(f.value==="添加账号"?q():N(),d.value=!1):console.log("验证失败!")})},O=(a,e)=>{V.value=a,y.value=e,u()};return H(()=>{u()}),(a,e)=>{const i=de,c=me,g=ne,v=pe,m=ue,M=se,$=ce,L=fe,W=re;return J((K(),Q("div",_e,[X("div",ve,[t(i,{modelValue:o(p),"onUpdate:modelValue":e[0]||(e[0]=l=>C(p)?p.value=l:p=l),placeholder:"输入用户名查询",class:"search",clearable:"",onBlur:u},null,8,["modelValue"]),t(c,{onClick:R},{default:n(()=>[I("添加账号")]),_:1})]),t(ie,{columns:o(P),data:o(w)},{operations:n(l=>[t(c,{size:"small",type:"primary",icon:"Edit",circle:"",onClick:A=>T(l.row)},null,8,["onClick"]),t(g,{title:`确定删除 ${l.row.username} 账号?`,"confirm-button-text":"确定","cancel-button-text":"取消",icon:"InfoFilled","icon-color":"var(--el-color-warning)",onConfirm:A=>S(l.row)},{reference:n(()=>[t(c,{size:"small",type:"danger",icon:"Delete",circle:""})]),_:2},1032,["title","onConfirm"])]),_:1},8,["columns","data"]),t(v,{layout:"total, sizes, prev, pager, next, jumper",total:o(U),"page-sizes":[10,20,30,40,50,100],class:"pagination",size:"small",background:"",onChange:O},null,8,["total"]),t(L,{modelValue:o(d),"onUpdate:modelValue":e[8]||(e[8]=l=>C(d)?d.value=l:d=l),title:o(f),width:"350px"},{default:n(()=>[t($,{ref_key:"ruleFormRef",ref:x,model:o(r),rules:z.value,size:"large",class:"w-full"},{default:n(()=>[t(m,{label:"账号",prop:"username"},{default:n(()=>[t(i,{modelValue:o(r).username,"onUpdate:modelValue":e[1]||(e[1]=l=>o(r).username=l),placeholder:"用户名","prefix-icon":"user",disabled:o(f)=="编辑账号"},null,8,["modelValue","disabled"])]),_:1}),t(m,{label:"密码",prop:"password"},{default:n(()=>[t(i,{modelValue:o(r).password,"onUpdate:modelValue":e[2]||(e[2]=l=>o(r).password=l),placeholder:"密码","prefix-icon":"lock",type:"password"},null,8,["modelValue"])]),_:1}),t(m,{label:"角色",prop:"roles"},{default:n(()=>[t(M,{modelValue:o(r).roles,"onUpdate:modelValue":e[3]||(e[3]=l=>o(r).roles=l),data:k.value,props:{label:"name",value:"id"},"check-strictly":"",multiple:"","render-after-expand":!1,style:{width:"240px"}},null,8,["modelValue","data"])]),_:1}),t(m,{label:"昵称",prop:"nickname"},{default:n(()=>[t(i,{modelValue:o(r).nickname,"onUpdate:modelValue":e[4]||(e[4]=l=>o(r).nickname=l),placeholder:"昵称"},null,8,["modelValue"])]),_:1}),t(m,{label:"部门",prop:"department"},{default:n(()=>[t(i,{modelValue:o(r).department,"onUpdate:modelValue":e[5]||(e[5]=l=>o(r).department=l),placeholder:"部门"},null,8,["modelValue"])]),_:1}),t(m,{label:"职位",prop:"position"},{default:n(()=>[t(i,{modelValue:o(r).position,"onUpdate:modelValue":e[6]||(e[6]=l=>o(r).position=l),placeholder:"职位"},null,8,["modelValue"])]),_:1}),t(m,null,{default:n(()=>[t(c,{class:"w-full",type:"primary",onClick:e[7]||(e[7]=l=>j(o(x)))},{default:n(()=>[I(" 保存 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])),[[W,o(b)]])}}}),ra=ge(we,[["__scopeId","data-v-8666c8fa"]]);export{ra as default};
