import{d as W,aC as fe,aD as he,c as ae,e as ie,D as o,w as Q,g as T,aE as ge,E as se,k as K,f as le,n as we,z as ye,aF as _e,r as w,y as ue,o as xe,ac as j,Y as be,aq as H,ay as $e,aA as Me,aG as Re,N as Ce,a3 as V,U as Le,ah as Ee,am as Ne,an as Pe}from"./index-Bsn8uhFR.js";import{E as Se}from"./el-card-P9uYmptO.js";import{a as ze}from"./index-li2vGeyt.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as A,m as Ye,N as de,t as Ie,d as Xe,a as ce,f as ke,E as Ae,b as te,e as oe,g as De,c as ve}from"./modules-ClEp93Bn.js";import{b as Ve}from"./index-CEJYwNXW.js";import"./index-f9LhncNo.js";import"./error-DyDUhvQa.js";import"./index-NV_0FHae.js";import"./index-B9r6-Uhw.js";import"./castArray-dThNn2ng.js";import"./index-DgBkyx5Q.js";import"./index-BW8njkrs.js";import"./index-DFENW1vO.js";import"./index-WB42fc2K.js";import"./_baseClone-BqSBTuLD.js";import"./index-qZKloEJB.js";import"./isEqual-DLLu8dhP.js";import"./index-C-Yt4Yjn.js";import"./index-Cc46_B1g.js";import"./index-C73im1hn.js";import"./index-C2ioxsOw.js";import"./index-j6jngLIj.js";import"./index-9zNjbeCL.js";import"./index-Cs2G8_c2.js";import"./dropdown-Biev14ov.js";import"./_commonjsHelpers-BosuxZz1.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./vnode-Ce9ES3ru.js";const je={class:"header"},Be={class:"content"},Fe=W({__name:"Drawer",props:fe({width:{type:String,default:"30%"},direction:{type:String,default:"rtl"}},{modelValue:{type:Boolean,default:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const v=a,d=he(a,"modelValue");return(s,c)=>(ae(),ie("div",{class:we(["drawer",[{hide:!d.value},v.direction]]),style:ye({width:v.width})},[o(T(se),{class:"switch",size:"15",onClick:c[0]||(c[0]=u=>d.value=!d.value)},{default:Q(()=>[o(T(ge))]),_:1}),K("div",je,[le(s.$slots,"header",{},void 0,!0)]),K("div",Be,[o(T(ze),null,{default:Q(()=>[le(s.$slots,"default",{},void 0,!0)]),_:3})])],6))}}),pe=re(Fe,[["__scopeId","data-v-99c100d8"]]),He={__name:"PieMenu",props:{data:{type:Array,default(){return[{title:"菜单1",handleClick:()=>{},children:[{title:"菜单1-1",handleClick:()=>{}},{title:"菜单1-2",handleClick:()=>{}}]},{title:"菜单2",handleClick:()=>{},children:[{title:"菜单2-1",handleClick:()=>{}},{title:"菜单2-2",handleClick:()=>{}}]}]}}},emits:["click"],setup(a,{emit:v}){_e(p=>({"651a891a":T(r)}));const d=a,s=v,c=2*Math.PI;let u=w(),n=w(),$=w(80),r=ue(()=>`${$.value}px`),y=ue(()=>$.value/2),h=w(70),E=w(c);const g=new WeakMap,x=p=>{const _=!g.get(p),{level:b,index:i,pIndex:m}=p.dataset,e=m.split("-");g.set(p,_),u.value.querySelectorAll("div[data-level]").forEach(l=>{e.includes(l.dataset.index)||p===l||(l.dataset.level>Number(b)&&l.classList.remove("show"),l.classList.remove("active"),g.set(l,!1))}),_?(p.classList.add("active"),u.value.querySelectorAll(`div[data-level='${+b+1}'][data-p-index*='${i}']`).forEach(t=>t.classList.add("show"))):p.classList.remove("active")},M=()=>Math.random().toString(16).replace(".","");let R=(p,_,b)=>{const i=E.value/p.length,m=i>=c?c-.001:i,e=p.length==1?1:0;for(let f=0,l=p;f<l.length;f++){let t=y.value+h.value*_,P=f*m,S=(f+1)*m,Y=t+Math.sin(P)*t,G=t-Math.cos(P)*t,O=t+Math.sin(S)*t,q=t-Math.cos(S)*t,C=document.createElement("div");C.classList.add("menu-item"),C.dataset.level=+_,C.dataset.index=M(),C.dataset.pIndex=b.dataset.pIndex?`${b.dataset.pIndex}-${b.dataset.index}`:`${b.dataset.index}`,C.style.setProperty("width",`${t*2}px`),C.style.setProperty("height",`${t*2}px`),C.style.setProperty("z-index",-_),C.style.setProperty("clip-path",`path("M ${t} ${t} L ${Y} ${G} A ${t} ${t} 0 ${e} 1 ${O} ${q} z")`);const X=document.createElement("div");X.className="item-bg",_%2==0?X.classList.add("bg-even"):X.classList.add("bg-odd"),S=(f+1)*m-.01,Y=t+Math.sin(P)*t,G=t-Math.cos(P)*t,O=t+Math.sin(S)*t,q=t-Math.cos(S)*t,X.style.setProperty("width",`${t*2}px`),X.style.setProperty("height",`${t*2}px`),X.style.setProperty("clip-path",`path("M ${t} ${t} L ${Y} ${G} A ${t} ${t} 0 ${e} 1 ${O} ${q} z")`),C.appendChild(X);let B=(f+1/2)*m,Z=t-h.value/2,k=document.createElement("div");k.style.left=t+Math.sin(B)*Z+"px",k.style.top=t-Math.cos(B)*Z+"px",k.style.setProperty("position","absolute"),k.style.whiteSpace="nowrap",k.style.transform=`translate(-50%, -50%) rotate(${-Math.PI/2+B}rad)`;let F=document.createElement("div"),U=B>Math.PI?Math.PI:0;F.style.transform=`rotateY(${U}rad) rotateX(${U}rad)`,F.innerText=l[f].title,k.appendChild(F),C.appendChild(k),C.addEventListener("pointerdown",()=>{var J,D;(D=(J=l[f]).handleClick)==null||D.call(J),s("click",l[f].title)}),C.addEventListener("pointerdown",()=>x(C)),u.value.insertAdjacentElement("afterbegin",C),l[f].children&&R(l[f].children,_+1,C)}};const N=(p,_)=>{let b={offsetX:0,offsetY:0};const i=m=>{const e=m.clientX,f=m.clientY,{offsetX:l,offsetY:t}=b,P=p.getBoundingClientRect(),S=P.left,Y=P.top,G=P.width,O=P.height,q=document.documentElement.clientWidth,C=document.documentElement.clientHeight,X=-S+l,B=-Y+t,Z=q-S-G+l,k=C-Y-O+t,F=J=>{let D=l+J.clientX-e,ee=t+J.clientY-f;D=Math.min(Math.max(D,X),Z),ee=Math.min(Math.max(ee,B),k),b={offsetX:D,offsetY:ee},p&&(p.style.transform=`translate(${D}px, ${ee}px)`)},U=()=>{document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",U)};document.addEventListener("mousemove",F),document.addEventListener("mouseup",U)};_.addEventListener("mousedown",i)},z=()=>{N(u.value,n.value);const p="0",_=M();n.value.dataset.level=p,n.value.dataset.index=_,n.value.dataset.pIndex="",R(d.data,+p+1,n.value),n.value.addEventListener("pointerdown",b=>x(n.value))};return xe(()=>{z()}),(p,_)=>(ae(),ie("div",{ref_key:"rongQi",ref:u,class:"rong-qi"},[K("div",{ref_key:"center",ref:n,class:"center",draggable:"false",onDblclick:_[0]||(_[0]=b=>s("click","center"))},[le(p.$slots,"center",{draggable:"false"},()=>[j("菜单")],!0)],544)],512))}},Te=re(He,[["__scopeId","data-v-605688ce"]]),We="_editor_i94p9_1",Ge="_container_i94p9_55",Oe="_views_i94p9_79",I={editor:We,container:Ge,views:Oe,"views-title":"_views-title_i94p9_87","views-container":"_views-container_i94p9_95"},qe="_controls_x16ja_1",Ue="_move_x16ja_37",Je="_button_x16ja_109",Qe="_guide_x16ja_143",L={controls:qe,move:Ue,"right-resize":"_right-resize_x16ja_55","bottom-resize":"_bottom-resize_x16ja_73","corner-resize":"_corner-resize_x16ja_91","button-list":"_button-list_x16ja_109",button:Je,guide:Qe,"guide-horizontal":"_guide-horizontal_x16ja_157","guide-vertical":"_guide-vertical_x16ja_171"};function Ke(a,v,d=!0,s){let c={offsetX:0,offsetY:0};const u=n=>{const $=window.getComputedStyle(a),r=Number.parseFloat($.getPropertyValue("left")),y=Number.parseFloat($.getPropertyValue("top"));if($.position!="absolute")return;c={offsetX:r,offsetY:y};const h=n.clientX,E=n.clientY,{offsetX:g,offsetY:x}=c,M=a.getBoundingClientRect(),R=M.left,N=M.top,z=M.width,p=M.height,_=document.documentElement.clientWidth,b=document.documentElement.clientHeight,i=-R+g,m=-N+x,e=_-R-z+g,f=b-N-p+x,l=P=>{let S=g+P.clientX-h,Y=x+P.clientY-E;d||(S=Math.min(Math.max(S,i),e),Y=Math.min(Math.max(Y,m),f)),c={offsetX:S,offsetY:Y},a&&(a.style.left=`${S}px`,a.style.top=`${Y}px`),s==null||s(P)},t=()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",t)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",t)};return v.addEventListener("mousedown",u),()=>{v.removeEventListener("mousedown",u)}}function Ze(a,v){const d=s=>{if(window.getComputedStyle(a).position=="absolute")return;a.setAttribute("draggable","true");const c=u=>{a.setAttribute("draggable","false"),document.removeEventListener("mouseup",c)};document.addEventListener("mouseup",c)};return v.addEventListener("mousedown",d),()=>{v.removeEventListener("mousedown",d)}}function ne(a,v,d,s){const c=u=>{const n=window.getComputedStyle(a),$=Number.parseFloat(n.getPropertyValue("width")),r=Number.parseFloat(n.getPropertyValue("height")),y=u.clientX,h=u.clientY,E=x=>{let M=x.clientX-y+$,R=x.clientY-h+r;a&&(d===0?a.style.width=`${M}px`:d===1?a.style.height=`${R}px`:(a.style.width=`${M}px`,a.style.height=`${R}px`)),s==null||s(x)},g=()=>{document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",g)};document.addEventListener("mousemove",E),document.addEventListener("mouseup",g)};return v.addEventListener("mousedown",c),()=>{v.removeEventListener("mousedown",c)}}function et(a,v){const d=s=>{s.preventDefault(),s.stopPropagation();const{deltaY:c}=s,u=5e-4,r=window.getComputedStyle(a).getPropertyValue("transform").match(/matrix\(([-\d\.]+), ([-\d\.]+), ([-\d\.]+), ([-\d\.]+), ([-\d\.]+), ([-\d\.]+)\)/);let y=+(r==null?void 0:r[1])||1;const h=+(r==null?void 0:r[2])||0,E=+(r==null?void 0:r[3])||0;let g=+(r==null?void 0:r[4])||1;const x=+(r==null?void 0:r[5])||0,M=+(r==null?void 0:r[6])||0;y+=-c*u,g+=-c*u,a.style.transform=`matrix(${y}, ${h}, ${E}, ${g}, ${x}, ${M})`,v==null||v(s)};return a.addEventListener("wheel",d),()=>{a.removeEventListener("wheel",d)}}const tt=W((a,{expose:v})=>{const d=w(),s=w(),c=w(),u=w(),n=5,$=()=>{d.value.style.visibility=s.value.style.visibility=c.value.style.visibility=u.value.style.visibility="hidden",d.value.style.left=s.value.style.left=c.value.style.top=u.value.style.top="0"};return v({hideGuides:$,showGuides:y=>{if(!(y&&d.value&&s.value&&c.value&&u.value))return;$();const h=y.elRef.value,E=a.page.getAllNodes().filter(p=>!p.isNPage&&p!==y).map(p=>p.elRef.value),{left:g,right:x,top:M,bottom:R,width:N,height:z}=h.getBoundingClientRect();for(let p=0,_=E.length;p<_;p++){const b=E[p];if(!b)continue;const{left:i,right:m,top:e,bottom:f}=b.getBoundingClientRect();let l,t=a.page.elRef.value;(l=Math.abs(i-g)<=n&&i||Math.abs(m-g)<=n&&m)&&(d.value.style.visibility="visible",A(d.value,l,"left",t),A(y.elRef.value,l,"left",t)),(l=Math.abs(i-x)<=n&&i||Math.abs(m-x)<=n&&m)&&(s.value.style.visibility="visible",A(s.value,l,"left",t),A(y.elRef.value,l-N,"left",t)),(l=Math.abs(e-M)<=n&&e||Math.abs(f-M)<=n&&f)&&(c.value.style.visibility="visible",A(c.value,l,"top",t),A(y.elRef.value,l,"top",t)),(l=Math.abs(e-R)<=n&&e||Math.abs(f-R)<=n&&f)&&(u.value.style.visibility="visible",A(u.value,l,"top",t),A(y.elRef.value,l-z,"top",t))}y.updateStyle()}}),()=>o(be,null,[o("div",{ref:d,class:`${L.guide} ${L["guide-vertical"]}`},null),o("div",{ref:s,class:`${L.guide} ${L["guide-vertical"]}`},null),o("div",{ref:c,class:`${L.guide} ${L["guide-horizontal"]}`},null),o("div",{ref:u,class:`${L.guide} ${L["guide-horizontal"]}`},null)])},{props:{page:{type:Object}}}),ot=W((a,{attrs:v,emit:d,expose:s})=>{const c=w(),u=w(),n=w(),$=w(),r=w(),y=w(),h=H(),E=w({...v.style}),g=[],x=()=>{h.value=null,c.value.remove(),g.forEach(i=>i())},M=i=>{i&&i.append(c.value)},R=()=>{h.value&&h.value.updateStyle()},N=i=>{var m;(m=y.value)==null||m.showGuides(h.value),R()},z=i=>{x(),y.value.hideGuides(),h.value=i,M(i.elRef.value);const m=ne(i.elRef.value,n.value,0,R),e=ne(i.elRef.value,$.value,1,R),f=ne(i.elRef.value,r.value,2,R),l=Ke(i.elRef.value,u.value,!0,N);g.push(l,m,e,f),i.isNPage?g.push(et(i.elRef.value,R)):g.push(Ze(i.elRef.value,u.value))},p=i=>{if(i.preventDefault(),i.stopPropagation(),!h.value)return;const m=h.value;x(),m.parent.remove(m),d("removeNode")},_=i=>{if(i.preventDefault(),i.stopPropagation(),!h.value)return;const m=h.value,e=m.parent,f=e.children.indexOf(m),l=e.children[f-1];l&&e.insert(m,l)},b=i=>{if(i.preventDefault(),i.stopPropagation(),!h.value)return;const m=h.value,e=m.parent,f=e.children.indexOf(m),l=e.children[f+1];l&&e.insert(m,l,"after")};return s({control:z,clearControl:x}),()=>o("div",{ref:c,class:L.controls,style:E.value},[o("div",{ref:u,class:L.move},null),o("div",{ref:n,class:L["right-resize"]},null),o("div",{ref:$,class:L["bottom-resize"]},null),o("div",{ref:r,class:L["corner-resize"]},null),h.value&&!h.value.isNPage&&o("div",{class:L["button-list"]},[o("div",{class:L.button,onPointerdown:_},[o(se,{size:15,color:"#fff"},{default:()=>[o($e,null,null)]})]),o("div",{class:L.button,onPointerdown:b},[o(se,{size:15,color:"#fff"},{default:()=>[o(Me,null,null)]})]),o("div",{class:L.button,onPointerdown:p},[o(se,{size:15,color:"#fff"},{default:()=>[o(Re,null,null)]})])]),o(tt,{page:a.page,ref:y},null)])},{props:{page:{type:Object}},emits:["removeNode"]}),st=W((a,{expose:v})=>{const d=w(),s=w(),c=w({pointerEvents:"none",position:"absolute",zIndex:"100",inset:"0",boxSizing:"border-box",border:"2px dashed var(--color-8)"}),u=()=>{s.value=null,d.value.remove()},n=r=>{r.append(d.value)};return v({hover:r=>{u(),s.value=r,n(r.elRef.value)},clearHover:u}),()=>o("div",{ref:d,style:c.value},null)});function nt(a,v){var d;v.isContainerNode?v.add(a):(d=v.parent)==null||d.insert(a,v)}const lt=W((a,{emit:v})=>{const d=w(),s=H([]);s.value=Object.values(Ye).map(e=>new e.default);const c=w([{title:"退出",handleClick:()=>{v("exit")}},{title:"全屏",handleClick:()=>{const e=d.value;e&&(document.fullscreenElement==e?document.exitFullscreen():e.requestFullscreen())}},{title:"清空",handleClick:()=>{n.value=new de,$=n.value.component}},{title:"导出",children:[{title:"导出.vue",handleClick:()=>{n.value.resetStyle(),Ie(n.value).then(e=>{Xe(e,"Page.zip")})}},{title:"导出.json",handleClick:()=>{n.value.resetStyle(),ce(n.value)}}]}]),u=w(),n=H(new de);let $=n.value.component;const r=H(),y=localStorage.getItem("SytPage");y&&(n.value=ke(y),$=n.value.component),Ce(n,()=>{localStorage.setItem("SytPage",ce(n.value))},{deep:!0});const h=e=>{r.value=e,e.active=!0,Le(()=>{u.value.control(e)})},E=e=>{n.value.traverse(f=>f.active=!1),h(e.targetNode)},g=w(),x=w(),M=e=>{g.value=e.targetNode,x.value.hover(e.targetNode)},R=e=>{g.value=null,x.value.clearHover()},N=H(),z=H(),p=e=>{N.value=e.targetNode},_=200,b=De(e=>{z.value=e.targetNode,nt(N.value,z.value),h(N.value)},_),i=e=>{setTimeout(()=>N.value=z.value=null,_)},m=()=>{r.value=null};return()=>V("div",{ref:d,class:I.editor,onDragend:i,onDragNode:p},[o(Te,{data:c.value},null),o(pe,{width:"300px",direction:"ltr"},{header:()=>o("span",null,[j("组件")]),default:()=>o(Ae,{modelValue:["1","2","3","4"],class:I.views},{default:()=>[o(te,{name:"1"},{title:()=>o(oe,{class:I["views-title"],tag:"b"},{default:()=>[j("布局")]}),default:()=>s.value.filter(e=>e.isLayoutNode).map(e=>V(e.view))}),o(te,{name:"2"},{title:()=>o(oe,{class:I["views-title"],tag:"b"},{default:()=>[j("表单")]}),default:()=>o("div",{class:I["views-container"]},{default:()=>s.value.filter(e=>e.isFormNode).map(e=>V(e.view))})}),o(te,{name:"3"},{title:()=>o(oe,{class:I["views-title"],tag:"b"},{default:()=>[j("图表")]}),default:()=>o("div",{class:I["views-container"]},{default:()=>s.value.filter(e=>e.isChartNode).map(e=>V(e.view))})}),o(te,{name:"4"},{title:()=>o(oe,{class:I["views-title"],tag:"b"},{default:()=>[j("数据展示")]}),default:()=>o("div",{class:I["views-container"]},{default:()=>s.value.filter(e=>e.isDataNode).map(e=>V(e.view))})})]})}),V("div",{class:I.container,onMouseleave:R,onHover:M,onNodeSelect:E,onDragenterNode:b},o($,null,null)),o(pe,{width:"300px"},{header:()=>o("span",null,[j("参数")]),default:()=>r.value?V(r.value.params):""}),o(ot,{ref:u,page:n.value,style:{display:r.value?"block":"none"},onRemoveNode:m},null),o(st,{ref:x,style:{display:g.value?"block":"none"}},null)])},{emits:["exit"]}),me=a=>(Ne("data-v-34ad4124"),a=a(),Pe(),a),at={class:"container"},it=me(()=>K("span",{class:"card-title"},"低代码页面编辑器",-1)),rt=me(()=>K("p",{class:"card-content"},"拖拽编辑页面",-1)),ut=W({__name:"PageEditor",setup(a){ve.baseUrl="http://localhost:8080",ve.token=Ee().token;const v=w(!1);return(d,s)=>{const c=Se;return ae(),ie("div",at,[o(c,{class:"card-button",onClick:s[0]||(s[0]=u=>v.value=!0)},{header:Q(()=>[it]),default:Q(()=>[rt]),_:1}),o(T(Ve),{modelValue:v.value,"onUpdate:modelValue":s[2]||(s[2]=u=>v.value=u),fullscreen:"","destroy-on-close":"","show-close":!1,class:"el-dialog"},{default:Q(()=>[o(T(lt),{onExit:s[1]||(s[1]=u=>v.value=!1)})]),_:1},8,["modelValue"])])}}}),Vt=re(ut,[["__scopeId","data-v-34ad4124"]]);export{Vt as default};
