import{d as z,r,o as A,N as R,c as G,e as H,k as J,B as a,w as l,aa as x,g as s,ag as K,bS as L,b_ as Q,aj as _,E as W,bP as X,bR as w,b$ as Y,c0 as Z,c1 as ee}from"./index-DIMNw_Zj.js";/* empty css                   *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import{a as te}from"./el-checkbox-D1rcqvlA.js";/* empty css                       *//* empty css                 */import{E as ae}from"./el-popover-DF5ri7S4.js";/* empty css                  */import{S as oe}from"./SytTable-Djb2R500.js";import{E as le}from"./index-XCTi-11Y.js";import{E as se}from"./index-CgNxFwXq.js";import{E as ne,a as re}from"./index-CT98zgnM.js";import{b as ie}from"./index-BRbOUH9G.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DXi_4jNA.js";import"./index-CtTxH7lL.js";import"./error-CA4BzyrB.js";import"./index-DDU8FhM7.js";import"./index-BORlPtjh.js";import"./castArray-BI0f9r0B.js";import"./scroll-BaQDGjHk.js";import"./isEqual-D4TRYkwQ.js";import"./_Uint8Array-CNXowefJ.js";import"./_baseIteratee-CsIwghsN.js";import"./index-Bdi75iBV.js";import"./index-pThFEOfU.js";import"./_initCloneObject-BKFhQqjC.js";import"./_baseClone-CkdOwu1U.js";import"./vnode-BwmuWjnw.js";const de={class:"container"},pe={class:"tools"},ue=z({__name:"Roles",setup(ce){const h=r([{title:"角色名",dataIndex:"name"},{title:"菜单",dataIndex:"menusNames"}]);let b=r([]),g=r([]),k=r(!0),i=r(!1),y=r(null),d=r("");const C=r({name:[{required:!0,message:"请输入角色名",trigger:"blur"}],menus:[{required:!0,message:"请选择菜单",trigger:"change"}]});let E=()=>({name:"",pid:"",menus:[]}),n=r(E());const V=r([]),T=async()=>{await X().then(t=>{t.code===200&&(b.value=t.data,V.value=w(t.data))})},B=async()=>{await Y().then(t=>{t.code===200&&(t.data.forEach(e=>{e.menusNames=e.menus.map(u=>{var c,m;return(m=(c=b.value.find(v=>u==v.id))==null?void 0:c.meta)==null?void 0:m.title})}),g.value=w(t.data))})},p=async()=>{await T(),await B(),k.value=!1},I=()=>{d.value="添加",i.value=!0,n.value=E()},F=t=>{d.value="编辑",i.value=!0,n.value=L(t)},N=async()=>{let t=Object.assign({},n.value);Z(t).then(e=>{e.code==200&&(_({type:"success",message:"添加成功"}),p())})},M=async()=>{let t=Object.assign({},n.value);ee(t).then(e=>{e.code==200&&(_({type:"success",message:"编辑成功"}),p())})},S=t=>{t.id?Q({id:t.id}).then(e=>{e.code==200&&(_({type:"success",message:"删除成功"}),p())}):_({type:"error",message:"不存在的id"})},U=t=>{t&&t.validate(e=>{e?(d.value==="添加"?N():M(),i.value=!1):console.log("验证失败!")})};return A(()=>{p()}),(t,e)=>{const u=le,c=R("Edit"),m=W,v=R("Delete"),j=ae,O=se,f=ne,D=te,$=re,q=ie;return G(),H("div",de,[J("div",pe,[a(u,{onClick:I},{default:l(()=>[x("添加角色")]),_:1})]),a(oe,{columns:h.value,data:s(g)},{operations:l(({row:o})=>[a(m,{class:"icon",color:"#0af",onClick:P=>F(o)},{default:l(()=>[a(c)]),_:2},1032,["onClick"]),a(j,{title:"确定删除?",onConfirm:P=>S(o)},{reference:l(()=>[a(m,{class:"icon",color:"#f00"},{default:l(()=>[a(v)]),_:1})]),_:2},1032,["onConfirm"])]),_:1},8,["columns","data"]),a(q,{modelValue:s(i),"onUpdate:modelValue":e[4]||(e[4]=o=>K(i)?i.value=o:i=o),title:s(d),width:"350px"},{default:l(()=>[a($,{ref_key:"ruleFormRef",ref:y,model:s(n),rules:C.value,size:"large",class:"w-full","label-width":"auto"},{default:l(()=>[a(f,{label:"角色名",prop:"name"},{default:l(()=>[a(O,{modelValue:s(n).name,"onUpdate:modelValue":e[0]||(e[0]=o=>s(n).name=o),placeholder:"角色名",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),a(f,{label:"权限菜单",prop:"menus"},{default:l(()=>[a(D,{modelValue:s(n).menus,"onUpdate:modelValue":e[1]||(e[1]=o=>s(n).menus=o),data:V.value,props:{label:o=>o.meta.title,value:"id"},"check-strictly":"",multiple:"","render-after-expand":!1,style:{width:"240px"}},null,8,["modelValue","data","props"])]),_:1}),a(f,{label:"上级角色"},{default:l(()=>[a(D,{modelValue:s(n).pid,"onUpdate:modelValue":e[2]||(e[2]=o=>s(n).pid=o),data:s(g),props:{label:"name",value:"id"},"check-strictly":"","render-after-expand":!1,clearable:"",style:{width:"240px"}},null,8,["modelValue","data"])]),_:1}),a(f,null,{default:l(()=>[a(u,{class:"w-full",type:"primary",onClick:e[3]||(e[3]=o=>U(s(y)))},{default:l(()=>[x(" 保存 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Ke=me(ue,[["__scopeId","data-v-c8352330"]]);export{Ke as default};
