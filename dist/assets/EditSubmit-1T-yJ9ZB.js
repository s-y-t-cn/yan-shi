import{d as W,ah as Y,r as k,N as $,y as q,c as h,l as I,w as p,D as v,k as b,t as x,g as c,e as V,ae as B,Y as C,ac as z,am as G,an as H}from"./index-CvzrRroh.js";import{E as K,S as M}from"./SytPreviewItem-DKMedW9x.js";/* empty css                  */import{E as Q,a as X}from"./el-timeline-item-DaWK3-QH.js";import{E as Z}from"./el-card-CeNxBv2S.js";/* empty css                     */import{h as ee,j as te}from"./examples-BN9ghPZ7.js";import{a as ae}from"./index-DOm-affa.js";import{E as oe}from"./index-qChH8gpH.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vnode-DVMq17-v.js";/* empty css                 *//* empty css                  *//* empty css               *//* empty css                    */import"./el-radio-Bnf4y1jI.js";/* empty css                  */import"./index-BmUq3rwC.js";import"./error-Br4eXv7y.js";import"./index-CRTUtFhj.js";import"./index-CR5Ieg7N.js";import"./index-Bbyyluvs.js";import"./index-Cbqz8tSS.js";import"./isEqual-Bw39J2LG.js";import"./index-BQjoHAmH.js";import"./index-Dhfn7e9K.js";import"./index-BpYBCOKL.js";import"./castArray-BGWFyrrn.js";import"./index-D3GcvVds.js";import"./_commonjsHelpers-BosuxZz1.js";import"./index-7gj8T3nu.js";import"./_baseClone-CuXz6tC2.js";import"./position-BvmUxjYd.js";const le=_=>(G("data-v-56e97eab"),_=_(),H(),_),ie=le(()=>b("span",null,"流程",-1)),ne=W({__name:"EditSubmit",props:{data:{type:Object,default(){return{name:"",formData:[],flowData:{nodesData:[],linesData:[]}}}}},emits:["submit"],setup(_,{emit:O}){const w=Y(),J=_,T=O;let s=k({name:"",formData:[],flowData:{nodesData:[],linesData:[]}});$(()=>JSON.parse(JSON.stringify(J.data)),t=>{s.value=t},{deep:!0,immediate:!0});const U=t=>{for(let a of s.value.formData)if(a.type==="layout"){for(let r of a.cols)for(let e of r.children)if(t===e.field)return e}else if(t===a.field)return a};let g=q(()=>j(s.value)),F=k({label:"部门主管",value:"部门主管"});ee().then(t=>{var a;F.value=(a=t.data.find(r=>r.value==w.department))==null?void 0:a.children.find(r=>r.label.includes("主管"))});const j=t=>{var u;let a=[],r={id:"",type:""},{nodesData:e,linesData:d}=t.flowData,n=r=e.find(o=>o.type==="start");if(!n)return[];for(n.color="#00aabb",a.push(n);d.find(o=>o.fromId===r.id);){let o={id:""},l=d.filter(i=>i.fromId===r.id);if(r.type=="condition"){let i=l.findIndex(D=>D.text==="是"),m=l.findIndex(D=>D.text==="否"),f=i,{field:R,comparison:A,value:S}=r.properties,y=U(R);if(y)switch(A){case"小于":y.value<S?f=i:f=m;break;case"等于":y.value===S?f=i:f=m;break;case"大于":y.value>S?f=i:f=m;break}o=e.find(D=>{var N;return D.id===((N=l[f])==null?void 0:N.toId)})}else o=e.find(i=>{var m;return i.id===((m=l[0])==null?void 0:m.toId)}),(o==null?void 0:o.type)=="handle"&&((u=o.properties)==null?void 0:u.value)=="部门主管"&&(o.properties=F.value);(o==null?void 0:o.type)!="condition"&&a.push(o),r=o}return a},E=k(),L=()=>{let t=new FormData;t.append("name",s.value.name),t.append("submitter",JSON.stringify({username:w.username,nickname:w.nickname}));let a={};s.value.formData.forEach(e=>{e.type==="img-upload"?e.value.forEach(d=>t.append(e.field,d)):e.type==="layout"?e.cols.forEach(d=>{d.children.forEach(n=>{n.type==="img-upload"?n.value.forEach(u=>t.append(n.field,u)):a[n.field]=n.value})}):a[e.field]=e.value}),t.append("formData",JSON.stringify(a));let r=g.value.filter(e=>e.type==="handle").map(e=>({id:e.id,type:e.text,label:e.properties.label,username:e.properties.value,status:"未处理"}));return t.append("flowData",JSON.stringify(r)),t},P=t=>{if(!t)return!1;t.validate(a=>{if(a)te(L()).then(()=>T("submit"));else return!1})};return(t,a)=>{const r=ae,e=Z,d=X,n=Q,u=oe,o=K;return h(),I(o,{direction:"vertical",fill:"",class:"submit-container"},{default:p(()=>[v(e,null,{header:p(()=>[b("h1",null,x(c(s).name),1)]),default:p(()=>[v(r,{ref_key:"ruleFormRef",ref:E,model:c(s).formData},{default:p(()=>[(h(!0),V(C,null,B(c(s).formData,(l,i)=>(h(),I(M,{key:l.field,modelValue:c(s).formData[i],"onUpdate:modelValue":m=>c(s).formData[i]=m,index:i.toString(),"rule-form-ref":E.value,onCascaderFetch:m=>l.options=m},null,8,["modelValue","onUpdate:modelValue","index","rule-form-ref","onCascaderFetch"]))),128))]),_:1},8,["model"])]),_:1}),v(e,null,{header:p(()=>[ie]),default:p(()=>[v(n,null,{default:p(()=>[(h(!0),V(C,null,B(c(g),l=>(h(),I(d,{key:l.id,icon:l.icon,color:l.color,timestamp:l.timestamp},{default:p(()=>{var i;return[b("div",null,x(l.text),1),b("div",null,x((i=l.properties)==null?void 0:i.label),1)]}),_:2},1032,["icon","color","timestamp"]))),128))]),_:1}),v(u,{type:"primary",onClick:a[0]||(a[0]=l=>P(E.value))},{default:p(()=>[z("提交")]),_:1})]),_:1})]),_:1})}}}),Ae=re(ne,[["__scopeId","data-v-56e97eab"]]);export{Ae as default};
