import{E as T,a as H,g as I,s as F}from"./index-qZKloEJB.js";import{_ as L}from"./index-9zNjbeCL.js";import{a as z,N as S,U as V,bB as q,y as k,d as U,q as $,b1 as D,j as G,aU as J,r as R,a2 as M,o as Q,a3 as p,_ as W}from"./index-Bsn8uhFR.js";import{p as A,U as x}from"./index-f9LhncNo.js";import{i as X}from"./isEqual-DLLu8dhP.js";const Y=(e,{attrs:s,emit:i},{select:o,tree:n,key:a})=>{const u=z("tree-select");return S(()=>e.data,()=>{e.filterable&&V(()=>{var t,h;(h=n.value)==null||h.filter((t=o.value)==null?void 0:t.states.inputValue)})},{flush:"post"}),{...A(q(e),Object.keys(T.props)),...s,"onUpdate:modelValue":t=>i(x,t),valueKey:a,popperClass:k(()=>{const t=[u.e("popper")];return e.popperClass&&t.push(e.popperClass),t.join(" ")}),filterMethod:(t="")=>{var h;e.filterMethod?e.filterMethod(t):e.remoteMethod?e.remoteMethod(t):(h=n.value)==null||h.filter(t)}}},Z=U({extends:H,setup(e,s){const i=H.setup(e,s);delete i.selectOptionClick;const o=$().proxy;return V(()=>{i.select.states.cachedOptions.get(o.value)||i.select.onOptionCreate(o)}),S(()=>s.attrs.visible,n=>{i.states.visible=n},{immediate:!0}),i},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function j(e){return e||e===0}function w(e){return Array.isArray(e)&&e.length}function b(e){return Array.isArray(e)?e:j(e)?[e]:[]}function E(e,s,i,o,n){for(let a=0;a<e.length;a++){const u=e[a];if(s(u,a,e,n))return o?o(u,a,e,n):u;{const C=i(u);if(w(C)){const t=E(C,s,i,o,u);if(t)return t}}}}function P(e,s,i,o){for(let n=0;n<e.length;n++){const a=e[n];s(a,n,e,o);const u=i(a);w(u)&&P(u,s,i,a)}}const ee=(e,{attrs:s,slots:i,emit:o},{select:n,tree:a,key:u})=>{S(()=>e.modelValue,()=>{e.showCheckbox&&V(()=>{const l=a.value;l&&!X(l.getCheckedKeys(),b(e.modelValue))&&l.setCheckedKeys(b(e.modelValue))})},{immediate:!0,deep:!0});const C=k(()=>({value:u.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),t=(l,c)=>{var d;const r=C.value[l];return D(r)?r(c,(d=a.value)==null?void 0:d.getNode(t("value",c))):c[r]},h=b(e.modelValue).map(l=>E(e.data||[],c=>t("value",c)===l,c=>t("children",c),(c,d,r,v)=>v&&t("value",v))).filter(l=>j(l)),g=k(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const l=[];return P(e.data.concat(e.cacheData),c=>{const d=t("value",c);l.push({value:d,currentLabel:t("label",c),isDisabled:t("disabled",c)})},c=>t("children",c)),l});return{...A(q(e),Object.keys(L.props)),...s,nodeKey:u,expandOnClickNode:k(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:k(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(h):h),renderContent:(l,{node:c,data:d,store:r})=>l(Z,{value:t("value",d),label:t("label",d),disabled:t("disabled",d),visible:c.visible},e.renderContent?()=>e.renderContent(l,{node:c,data:d,store:r}):i.default?()=>i.default({node:c,data:d,store:r}):void 0),filterNodeMethod:(l,c,d)=>e.filterNodeMethod?e.filterNodeMethod(l,c,d):l?new RegExp(I(l),"i").test(t("label",c)||""):!0,onNodeClick:(l,c,d)=>{var r,v,m,K;if((r=s.onNodeClick)==null||r.call(s,l,c,d),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||c.isLeaf)){if(!t("disabled",l)){const N=(v=n.value)==null?void 0:v.states.options.get(t("value",l));(m=n.value)==null||m.handleOptionSelect(N)}}else e.expandOnClickNode&&d.proxy.handleExpandIconClick();(K=n.value)==null||K.focus()}},onCheck:(l,c)=>{var d;if(!e.showCheckbox)return;const r=t("value",l),v={};P([a.value.store.root],f=>v[f.key]=f,f=>f.childNodes);const m=c.checkedKeys,K=e.multiple?b(e.modelValue).filter(f=>!(f in v)&&!m.includes(f)):[],N=K.concat(m);if(e.checkStrictly)o(x,e.multiple?N:N.includes(r)?r:void 0);else if(e.multiple)o(x,K.concat(a.value.getCheckedKeys(!0)));else{const f=E([l],y=>!w(t("children",y))&&!t("disabled",y),y=>t("children",y)),_=f?t("value",f):void 0,B=j(e.modelValue)&&!!E([l],y=>t("value",y)===e.modelValue,y=>t("children",y));o(x,_===e.modelValue||B?void 0:_)}V(()=>{var f;const _=b(e.modelValue);a.value.setCheckedKeys(_),(f=s.onCheck)==null||f.call(s,l,{checkedKeys:a.value.getCheckedKeys(),checkedNodes:a.value.getCheckedNodes(),halfCheckedKeys:a.value.getHalfCheckedKeys(),halfCheckedNodes:a.value.getHalfCheckedNodes()})}),(d=n.value)==null||d.focus()},cacheOptions:g}};var te=U({props:{data:{type:Array,default:()=>[]}},setup(e){const s=G(F);return S(()=>e.data,()=>{var i;e.data.forEach(n=>{s.states.cachedOptions.has(n.value)||s.states.cachedOptions.set(n.value,n)});const o=((i=s.selectRef)==null?void 0:i.querySelectorAll("input"))||[];J&&!Array.from(o).includes(document.activeElement)&&s.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const le=U({name:"ElTreeSelect",inheritAttrs:!1,props:{...T.props,...L.props,cacheData:{type:Array,default:()=>[]}},setup(e,s){const{slots:i,expose:o}=s,n=R(),a=R(),u=k(()=>e.nodeKey||e.valueKey||"value"),C=Y(e,s,{select:n,tree:a,key:u}),{cacheOptions:t,...h}=ee(e,s,{select:n,tree:a,key:u}),g=M({});return o(g),Q(()=>{Object.assign(g,{...A(a.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...A(n.value,["focus","blur"])})}),()=>p(T,M({...C,ref:l=>n.value=l}),{...i,default:()=>[p(te,{data:t.value}),p(L,M({...h,ref:l=>a.value=l}))]})}});var O=W(le,[["__file","tree-select.vue"]]);O.install=e=>{e.component(O.name,O)};const ne=O,oe=ne;export{oe as E};
