import{d as z,r,o as L,P as x,c as W,e as X,k as A,D as a,w as l,ac as R,g as s,ai as G,bO as H,bU as J,al as _,E as K,bL as Q,bN as w,bV as Y,bW as Z,bX as ee}from"./index-B_ZJlzGL.js";/* empty css                   *//* empty css                     *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                       *//* empty css                    */import{E as te}from"./el-popover-DFSGd_dy.js";/* empty css                  */import{S as ae}from"./SytTable-CtyyqNa7.js";import{E as oe}from"./index-BU1K9O-H.js";import{E as le}from"./index-BBE6lv8d.js";import{E as se,a as ne}from"./index-hpsKijdF.js";import{a as re}from"./index-5JyK2C3A.js";import{b as ie}from"./index-DMy1G94c.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-TXtwhKK1.js";import"./error-BJ0obFE8.js";import"./index-C8tJppOc.js";import"./index-ZFLvW_Yn.js";import"./index-DIP1PYhk.js";import"./isEqual-BBTZ5Qrx.js";import"./castArray-istU0CW9.js";import"./index-CT3RxB0d.js";import"./_baseClone-DJp4dWdX.js";import"./index-Df35gMDy.js";import"./vnode-BLYMqKVk.js";const de={class:"container"},ue={class:"tools"},pe=z({__name:"Roles",setup(ce){const h=r([{title:"角色名",dataIndex:"name"},{title:"菜单",dataIndex:"menusNames"}]);let b=r([]),v=r([]),k=r(!0),i=r(!1),y=r(null),d=r("");const C=r({name:[{required:!0,message:"请输入角色名",trigger:"blur"}],menus:[{required:!0,message:"请选择菜单",trigger:"change"}]});let E=()=>({name:"",pid:"",menus:[]}),n=r(E());const V=r([]),T=async()=>{await Q().then(t=>{t.code===200&&(b.value=t.data,V.value=w(t.data))})},I=async()=>{await Y().then(t=>{t.code===200&&(t.data.forEach(e=>{e.menusNames=e.menus.map(p=>{var c,m;return(m=(c=b.value.find(g=>p==g.id))==null?void 0:c.meta)==null?void 0:m.title})}),v.value=w(t.data))})},u=async()=>{await T(),await I(),k.value=!1},B=()=>{d.value="添加",i.value=!0,n.value=E()},F=t=>{d.value="编辑",i.value=!0,n.value=H(t)},N=async()=>{let t=Object.assign({},n.value);Z(t).then(e=>{e.code==200&&(_({type:"success",message:"添加成功"}),u())})},U=async()=>{let t=Object.assign({},n.value);ee(t).then(e=>{e.code==200&&(_({type:"success",message:"编辑成功"}),u())})},M=t=>{t.id?J({id:t.id}).then(e=>{e.code==200&&(_({type:"success",message:"删除成功"}),u())}):_({type:"error",message:"不存在的id"})},O=t=>{t&&t.validate(e=>{e?(d.value==="添加"?N():U(),i.value=!1):console.log("验证失败!")})};return L(()=>{u()}),(t,e)=>{const p=oe,c=x("Edit"),m=K,g=x("Delete"),S=te,j=le,f=se,D=re,q=ne,P=ie;return W(),X("div",de,[A("div",ue,[a(p,{onClick:B},{default:l(()=>[R("添加角色")]),_:1})]),a(ae,{columns:h.value,data:s(v)},{operations:l(({row:o})=>[a(m,{class:"icon",color:"#0af",onClick:$=>F(o)},{default:l(()=>[a(c)]),_:2},1032,["onClick"]),a(S,{title:"确定删除?",onConfirm:$=>M(o)},{reference:l(()=>[a(m,{class:"icon",color:"#f00"},{default:l(()=>[a(g)]),_:1})]),_:2},1032,["onConfirm"])]),_:1},8,["columns","data"]),a(P,{modelValue:s(i),"onUpdate:modelValue":e[4]||(e[4]=o=>G(i)?i.value=o:i=o),title:s(d),width:"350px"},{default:l(()=>[a(q,{ref_key:"ruleFormRef",ref:y,model:s(n),rules:C.value,size:"large",class:"w-full","label-width":"auto"},{default:l(()=>[a(f,{label:"角色名",prop:"name"},{default:l(()=>[a(j,{modelValue:s(n).name,"onUpdate:modelValue":e[0]||(e[0]=o=>s(n).name=o),placeholder:"角色名",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),a(f,{label:"权限菜单",prop:"menus"},{default:l(()=>[a(D,{modelValue:s(n).menus,"onUpdate:modelValue":e[1]||(e[1]=o=>s(n).menus=o),data:V.value,props:{label:o=>o.meta.title,value:"id"},"check-strictly":"",multiple:"","render-after-expand":!1,style:{width:"240px"}},null,8,["modelValue","data","props"])]),_:1}),a(f,{label:"上级角色"},{default:l(()=>[a(D,{modelValue:s(n).pid,"onUpdate:modelValue":e[2]||(e[2]=o=>s(n).pid=o),data:s(v),props:{label:"name",value:"id"},"check-strictly":"","render-after-expand":!1,clearable:"",style:{width:"240px"}},null,8,["modelValue","data"])]),_:1}),a(f,null,{default:l(()=>[a(p,{class:"w-full",type:"primary",onClick:e[3]||(e[3]=o=>O(s(y)))},{default:l(()=>[R(" 保存 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Le=me(pe,[["__scopeId","data-v-c8352330"]]);export{Le as default};
