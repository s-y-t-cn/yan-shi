import{d as P,r,o as A,X as R,c as G,e as H,M as a,w as l,O as w,g as s,a6 as J,ab as K,aX as x}from"./index-B2ff-rFN.js";/* empty css                   *//* empty css                     */import"./index-CDp5nt-z.js";import"./el-tag-5atBDTvJ.js";import"./el-checkbox-TOO-gUmm.js";import{E as L}from"./el-tree-select-Z4eI8kLg.js";import{E as Q}from"./el-popover-Jjy_ri4S.js";/* empty css                  */import{E as W}from"./el-divider-Ca7wRDPx.js";import{b as Y,f as Z,c as ee,e as te,g as ae}from"./permission-CAa-2GWk.js";import{S as oe}from"./SytTable-DNxFVgPQ.js";import{E as v}from"./index-Bfj94Vt0.js";import{f as le,E as se}from"./index-CvnddM-F.js";import{E as ne}from"./index-CQNAlFu8.js";import{E as re,a as ie}from"./index-BIK7ipUj.js";import{b as me}from"./index-CjBM1FRY.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BWwQj9eg.js";import"./plugin-vue_export-helper-CqGSI99y.js";import"./_Uint8Array-CLf01t9B.js";import"./typescript-PpV26QSH.js";import"./isEqual-B5Vhr8lN.js";import"./index-DxdYCs-v.js";import"./focus-trap-VkXHYWcf.js";import"./scroll-JHJnPUrU.js";import"./castArray-D7uxE5bV.js";import"./index-CJ4UhsCw.js";import"./el-tooltip-l0sNRNKZ.js";import"./_baseClone-CmqJW0qa.js";import"./vnode-CgXj8ZtL.js";const ue={class:"container"},pe=P({__name:"Roles",setup(ce){const C=r([{title:"角色名",dataIndex:"name"},{title:"菜单",dataIndex:"menusNames"}]);let E=r([]),g=r([]),T=r(!0),i=r(!1),y=r(null),m=r("");const k=r({name:[{required:!0,message:"请输入角色名",trigger:"blur"}],menus:[{required:!0,message:"请选择菜单",trigger:"change"}]});let b=()=>({name:"",pid:"",menus:[]}),n=r(b());const D=r([]),h=async()=>{await Z().then(t=>{t.code===200&&(E.value=t.data,D.value=x(t.data))})},I=async()=>{await ee().then(t=>{t.code===200&&(t.data.forEach(e=>{e.menusNames=e.menus.map(u=>{var p,c;return(c=(p=E.value.find(f=>u==f.id))==null?void 0:p.meta)==null?void 0:c.title})}),g.value=x(t.data))})},d=async()=>{await h(),await I(),T.value=!1},F=()=>{m.value="添加",i.value=!0,n.value=b()},B=t=>{m.value="编辑",i.value=!0,n.value=K(t)},M=async()=>{let t=Object.assign({},n.value);te(t).then(e=>{e.code==200&&(v({type:"success",message:"添加成功"}),d())})},N=async()=>{let t=Object.assign({},n.value);ae(t).then(e=>{e.code==200&&(v({type:"success",message:"编辑成功"}),d())})},O=t=>{t._id?Y({_id:t._id}).then(e=>{e.code==200&&(v({type:"success",message:"删除成功"}),d())}):v({type:"error",message:"不存在的_id"})},U=t=>{t&&t.validate(e=>{e?(m.value==="添加"?M():N(),i.value=!1):console.log("验证失败!")})};return A(()=>{d()}),(t,e)=>{const u=le,p=W,c=R("Edit"),f=se,S=R("Delete"),j=Q,q=ne,_=re,V=L,X=ie,$=me;return G(),H("div",ue,[a(u,{onClick:F},{default:l(()=>[w("添加角色")]),_:1}),a(p),a(oe,{columns:C.value,data:s(g)},{operations:l(({row:o})=>[a(f,{class:"icon",onClick:z=>B(o),color:"#0af"},{default:l(()=>[a(c)]),_:2},1032,["onClick"]),a(j,{title:"确定删除?",onConfirm:z=>O(o)},{reference:l(()=>[a(f,{class:"icon",color:"#f00"},{default:l(()=>[a(S)]),_:1})]),_:2},1032,["onConfirm"])]),_:1},8,["columns","data"]),a($,{modelValue:s(i),"onUpdate:modelValue":e[4]||(e[4]=o=>J(i)?i.value=o:i=o),title:s(m),width:"30vw"},{default:l(()=>[a(X,{ref_key:"ruleFormRef",ref:y,model:s(n),rules:k.value,size:"large",class:"w-full","label-width":"auto"},{default:l(()=>[a(_,{label:"角色名",prop:"name"},{default:l(()=>[a(q,{modelValue:s(n).name,"onUpdate:modelValue":e[0]||(e[0]=o=>s(n).name=o),placeholder:"角色名"},null,8,["modelValue"])]),_:1}),a(_,{label:"权限菜单",prop:"menus"},{default:l(()=>[a(V,{modelValue:s(n).menus,"onUpdate:modelValue":e[1]||(e[1]=o=>s(n).menus=o),data:D.value,props:{label:o=>o.meta.title,value:"id"},"check-strictly":"",multiple:"","render-after-expand":!1,style:{width:"240px"}},null,8,["modelValue","data","props"])]),_:1}),a(_,{label:"上级角色"},{default:l(()=>[a(V,{modelValue:s(n).pid,"onUpdate:modelValue":e[2]||(e[2]=o=>s(n).pid=o),data:s(g),props:{label:"name",value:"id"},"check-strictly":"","render-after-expand":!1,clearable:"",style:{width:"240px"}},null,8,["modelValue","data"])]),_:1}),a(_,null,{default:l(()=>[a(u,{class:"w-full",type:"primary",onClick:e[3]||(e[3]=o=>U(s(y)))},{default:l(()=>[w(" 保存 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Ge=de(pe,[["__scopeId","data-v-57040167"]]);export{Ge as default};
